(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function t(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(i){if(i.ep)return;i.ep=!0;const r=t(i);fetch(i.href,r)}})();const Go=()=>{};var gi={};const fr={NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"};const m=function(n,e){if(!n)throw Ot(e)},Ot=function(n){return new Error("Firebase Database ("+fr.SDK_VERSION+") INTERNAL ASSERT FAILED: "+n)};const pr=function(n){const e=[];let t=0;for(let s=0;s<n.length;s++){let i=n.charCodeAt(s);i<128?e[t++]=i:i<2048?(e[t++]=i>>6|192,e[t++]=i&63|128):(i&64512)===55296&&s+1<n.length&&(n.charCodeAt(s+1)&64512)===56320?(i=65536+((i&1023)<<10)+(n.charCodeAt(++s)&1023),e[t++]=i>>18|240,e[t++]=i>>12&63|128,e[t++]=i>>6&63|128,e[t++]=i&63|128):(e[t++]=i>>12|224,e[t++]=i>>6&63|128,e[t++]=i&63|128)}return e},qo=function(n){const e=[];let t=0,s=0;for(;t<n.length;){const i=n[t++];if(i<128)e[s++]=String.fromCharCode(i);else if(i>191&&i<224){const r=n[t++];e[s++]=String.fromCharCode((i&31)<<6|r&63)}else if(i>239&&i<365){const r=n[t++],o=n[t++],a=n[t++],c=((i&7)<<18|(r&63)<<12|(o&63)<<6|a&63)-65536;e[s++]=String.fromCharCode(55296+(c>>10)),e[s++]=String.fromCharCode(56320+(c&1023))}else{const r=n[t++],o=n[t++];e[s++]=String.fromCharCode((i&15)<<12|(r&63)<<6|o&63)}}return e.join("")},Ps={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,s=[];for(let i=0;i<n.length;i+=3){const r=n[i],o=i+1<n.length,a=o?n[i+1]:0,c=i+2<n.length,l=c?n[i+2]:0,f=r>>2,p=(r&3)<<4|a>>4;let d=(a&15)<<2|l>>6,g=l&63;c||(g=64,o||(d=64)),s.push(t[f],t[p],t[d],t[g])}return s.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(pr(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):qo(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,s=[];for(let i=0;i<n.length;){const r=t[n.charAt(i++)],a=i<n.length?t[n.charAt(i)]:0;++i;const l=i<n.length?t[n.charAt(i)]:64;++i;const p=i<n.length?t[n.charAt(i)]:64;if(++i,r==null||a==null||l==null||p==null)throw new Ko;const d=r<<2|a>>4;if(s.push(d),l!==64){const g=a<<4&240|l>>2;if(s.push(g),p!==64){const b=l<<6&192|p;s.push(b)}}}return s},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class Ko extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const _r=function(n){const e=pr(n);return Ps.encodeByteArray(e,!0)},bn=function(n){return _r(n).replace(/\./g,"")},ds=function(n){try{return Ps.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function Yo(n){return mr(void 0,n)}function mr(n,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:const t=e;return new Date(t.getTime());case Object:n===void 0&&(n={});break;case Array:n=[];break;default:return e}for(const t in e)!e.hasOwnProperty(t)||!Qo(t)||(n[t]=mr(n[t],e[t]));return n}function Qo(n){return n!=="__proto__"}function Xo(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}const Jo=()=>Xo().__FIREBASE_DEFAULTS__,Zo=()=>{if(typeof process>"u"||typeof gi>"u")return;const n=gi.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},ea=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&ds(n[1]);return e&&JSON.parse(e)},gr=()=>{try{return Go()||Jo()||Zo()||ea()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},ta=n=>gr()?.emulatorHosts?.[n],na=n=>{const e=ta(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const s=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),s]:[e.substring(0,t),s]},yr=()=>gr()?.config;class We{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,s)=>{t?this.reject(t):this.resolve(s),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,s))}}}function Ds(n){try{return(n.startsWith("http://")||n.startsWith("https://")?new URL(n).hostname:n).endsWith(".cloudworkstations.dev")}catch{return!1}}async function sa(n){return(await fetch(n,{credentials:"include"})).ok}function ia(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},s=e||"demo-project",i=n.iat||0,r=n.sub||n.user_id;if(!r)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o={iss:`https://securetoken.google.com/${s}`,aud:s,iat:i,exp:i+3600,auth_time:i,sub:r,user_id:r,firebase:{sign_in_provider:"custom",identities:{}},...n};return[bn(JSON.stringify(t)),bn(JSON.stringify(o)),""].join(".")}const qt={};function ra(){const n={prod:[],emulator:[]};for(const e of Object.keys(qt))qt[e]?n.emulator.push(e):n.prod.push(e);return n}function oa(n){let e=document.getElementById(n),t=!1;return e||(e=document.createElement("div"),e.setAttribute("id",n),t=!0),{created:t,element:e}}let yi=!1;function aa(n,e){if(typeof window>"u"||typeof document>"u"||!Ds(window.location.host)||qt[n]===e||qt[n]||yi)return;qt[n]=e;function t(d){return`__firebase__banner__${d}`}const s="__firebase__banner",r=ra().prod.length>0;function o(){const d=document.getElementById(s);d&&d.remove()}function a(d){d.style.display="flex",d.style.background="#7faaf0",d.style.position="fixed",d.style.bottom="5px",d.style.left="5px",d.style.padding=".5em",d.style.borderRadius="5px",d.style.alignItems="center"}function c(d,g){d.setAttribute("width","24"),d.setAttribute("id",g),d.setAttribute("height","24"),d.setAttribute("viewBox","0 0 24 24"),d.setAttribute("fill","none"),d.style.marginLeft="-6px"}function l(){const d=document.createElement("span");return d.style.cursor="pointer",d.style.marginLeft="16px",d.style.fontSize="24px",d.innerHTML=" &times;",d.onclick=()=>{yi=!0,o()},d}function f(d,g){d.setAttribute("id",g),d.innerText="Learn more",d.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",d.setAttribute("target","__blank"),d.style.paddingLeft="5px",d.style.textDecoration="underline"}function p(){const d=oa(s),g=t("text"),b=document.getElementById(g)||document.createElement("span"),R=t("learnmore"),V=document.getElementById(R)||document.createElement("a"),he=t("preprendIcon"),Ee=document.getElementById(he)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(d.created){const oe=d.element;a(oe),f(V,R);const Ve=l();c(Ee,he),oe.append(Ee,b,V,Ve),document.body.appendChild(oe)}r?(b.innerText="Preview backend disconnected.",Ee.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(Ee.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,b.innerText="Preview backend running in this workspace."),b.setAttribute("id",g)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",p):p()}function la(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function vr(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(la())}function ca(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function ha(){return fr.NODE_ADMIN===!0}function ua(){try{return typeof indexedDB=="object"}catch{return!1}}function da(){return new Promise((n,e)=>{try{let t=!0;const s="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(s);i.onsuccess=()=>{i.result.close(),t||self.indexedDB.deleteDatabase(s),n(!0)},i.onupgradeneeded=()=>{t=!1},i.onerror=()=>{e(i.error?.message||"")}}catch(t){e(t)}})}const fa="FirebaseError";class hn extends Error{constructor(e,t,s){super(t),this.code=e,this.customData=s,this.name=fa,Object.setPrototypeOf(this,hn.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Er.prototype.create)}}class Er{constructor(e,t,s){this.service=e,this.serviceName=t,this.errors=s}create(e,...t){const s=t[0]||{},i=`${this.service}/${e}`,r=this.errors[e],o=r?pa(r,s):"Error",a=`${this.serviceName}: ${o} (${i}).`;return new hn(i,a,s)}}function pa(n,e){return n.replace(_a,(t,s)=>{const i=e[s];return i!=null?String(i):`<${s}?>`})}const _a=/\{\$([^}]+)}/g;function Zt(n){return JSON.parse(n)}function ce(n){return JSON.stringify(n)}const Cr=function(n){let e={},t={},s={},i="";try{const r=n.split(".");e=Zt(ds(r[0])||""),t=Zt(ds(r[1])||""),i=r[2],s=t.d||{},delete t.d}catch{}return{header:e,claims:t,data:s,signature:i}},ma=function(n){const e=Cr(n),t=e.claims;return!!t&&typeof t=="object"&&t.hasOwnProperty("iat")},ga=function(n){const e=Cr(n).claims;return typeof e=="object"&&e.admin===!0};function Ue(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function Tt(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]}function fs(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function wn(n,e,t){const s={};for(const i in n)Object.prototype.hasOwnProperty.call(n,i)&&(s[i]=e.call(t,n[i],i,n));return s}function In(n,e){if(n===e)return!0;const t=Object.keys(n),s=Object.keys(e);for(const i of t){if(!s.includes(i))return!1;const r=n[i],o=e[i];if(vi(r)&&vi(o)){if(!In(r,o))return!1}else if(r!==o)return!1}for(const i of s)if(!t.includes(i))return!1;return!0}function vi(n){return n!==null&&typeof n=="object"}function ya(n){const e=[];for(const[t,s]of Object.entries(n))Array.isArray(s)?s.forEach(i=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(i))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(s));return e.length?"&"+e.join("&"):""}class va{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=512/8,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(e,t){t||(t=0);const s=this.W_;if(typeof e=="string")for(let p=0;p<16;p++)s[p]=e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|e.charCodeAt(t+3),t+=4;else for(let p=0;p<16;p++)s[p]=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4;for(let p=16;p<80;p++){const d=s[p-3]^s[p-8]^s[p-14]^s[p-16];s[p]=(d<<1|d>>>31)&4294967295}let i=this.chain_[0],r=this.chain_[1],o=this.chain_[2],a=this.chain_[3],c=this.chain_[4],l,f;for(let p=0;p<80;p++){p<40?p<20?(l=a^r&(o^a),f=1518500249):(l=r^o^a,f=1859775393):p<60?(l=r&o|a&(r|o),f=2400959708):(l=r^o^a,f=3395469782);const d=(i<<5|i>>>27)+l+c+f+s[p]&4294967295;c=a,a=o,o=(r<<30|r>>>2)&4294967295,r=i,i=d}this.chain_[0]=this.chain_[0]+i&4294967295,this.chain_[1]=this.chain_[1]+r&4294967295,this.chain_[2]=this.chain_[2]+o&4294967295,this.chain_[3]=this.chain_[3]+a&4294967295,this.chain_[4]=this.chain_[4]+c&4294967295}update(e,t){if(e==null)return;t===void 0&&(t=e.length);const s=t-this.blockSize;let i=0;const r=this.buf_;let o=this.inbuf_;for(;i<t;){if(o===0)for(;i<=s;)this.compress_(e,i),i+=this.blockSize;if(typeof e=="string"){for(;i<t;)if(r[o]=e.charCodeAt(i),++o,++i,o===this.blockSize){this.compress_(r),o=0;break}}else for(;i<t;)if(r[o]=e[i],++o,++i,o===this.blockSize){this.compress_(r),o=0;break}}this.inbuf_=o,this.total_+=t}digest(){const e=[];let t=this.total_*8;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let i=this.blockSize-1;i>=56;i--)this.buf_[i]=t&255,t/=256;this.compress_(this.buf_);let s=0;for(let i=0;i<5;i++)for(let r=24;r>=0;r-=8)e[s]=this.chain_[i]>>r&255,++s;return e}}function St(n,e){return`${n} failed: ${e} argument `}const Ea=function(n){const e=[];let t=0;for(let s=0;s<n.length;s++){let i=n.charCodeAt(s);if(i>=55296&&i<=56319){const r=i-55296;s++,m(s<n.length,"Surrogate pair missing trail surrogate.");const o=n.charCodeAt(s)-56320;i=65536+(r<<10)+o}i<128?e[t++]=i:i<2048?(e[t++]=i>>6|192,e[t++]=i&63|128):i<65536?(e[t++]=i>>12|224,e[t++]=i>>6&63|128,e[t++]=i&63|128):(e[t++]=i>>18|240,e[t++]=i>>12&63|128,e[t++]=i>>6&63|128,e[t++]=i&63|128)}return e},Un=function(n){let e=0;for(let t=0;t<n.length;t++){const s=n.charCodeAt(t);s<128?e++:s<2048?e+=2:s>=55296&&s<=56319?(e+=4,t++):e+=3}return e};function rt(n){return n&&n._delegate?n._delegate:n}class en{constructor(e,t,s){this.name=e,this.instanceFactory=t,this.type=s,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const ot="[DEFAULT]";class Ca{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const s=new We;if(this.instancesDeferred.set(t,s),this.isInitialized(t)||this.shouldAutoInitialize())try{const i=this.getOrInitializeService({instanceIdentifier:t});i&&s.resolve(i)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){const t=this.normalizeInstanceIdentifier(e?.identifier),s=e?.optional??!1;if(this.isInitialized(t)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:t})}catch(i){if(s)return null;throw i}else{if(s)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(wa(e))try{this.getOrInitializeService({instanceIdentifier:ot})}catch{}for(const[t,s]of this.instancesDeferred.entries()){const i=this.normalizeInstanceIdentifier(t);try{const r=this.getOrInitializeService({instanceIdentifier:i});s.resolve(r)}catch{}}}}clearInstance(e=ot){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=ot){return this.instances.has(e)}getOptions(e=ot){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,s=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(s))throw Error(`${this.name}(${s}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const i=this.getOrInitializeService({instanceIdentifier:s,options:t});for(const[r,o]of this.instancesDeferred.entries()){const a=this.normalizeInstanceIdentifier(r);s===a&&o.resolve(i)}return i}onInit(e,t){const s=this.normalizeInstanceIdentifier(t),i=this.onInitCallbacks.get(s)??new Set;i.add(e),this.onInitCallbacks.set(s,i);const r=this.instances.get(s);return r&&e(r,s),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){const s=this.onInitCallbacks.get(t);if(s)for(const i of s)try{i(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let s=this.instances.get(e);if(!s&&this.component&&(s=this.component.instanceFactory(this.container,{instanceIdentifier:ba(e),options:t}),this.instances.set(e,s),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(s,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,s)}catch{}return s||null}normalizeInstanceIdentifier(e=ot){return this.component?this.component.multipleInstances?e:ot:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function ba(n){return n===ot?void 0:n}function wa(n){return n.instantiationMode==="EAGER"}class Ia{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new Ca(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}var Q;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(Q||(Q={}));const Ta={debug:Q.DEBUG,verbose:Q.VERBOSE,info:Q.INFO,warn:Q.WARN,error:Q.ERROR,silent:Q.SILENT},Sa=Q.INFO,ka={[Q.DEBUG]:"log",[Q.VERBOSE]:"log",[Q.INFO]:"info",[Q.WARN]:"warn",[Q.ERROR]:"error"},Ra=(n,e,...t)=>{if(e<n.logLevel)return;const s=new Date().toISOString(),i=ka[e];if(i)console[i](`[${s}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class br{constructor(e){this.name=e,this._logLevel=Sa,this._logHandler=Ra,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in Q))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?Ta[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,Q.DEBUG,...e),this._logHandler(this,Q.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,Q.VERBOSE,...e),this._logHandler(this,Q.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,Q.INFO,...e),this._logHandler(this,Q.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,Q.WARN,...e),this._logHandler(this,Q.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,Q.ERROR,...e),this._logHandler(this,Q.ERROR,...e)}}const Na=(n,e)=>e.some(t=>n instanceof t);let Ei,Ci;function Aa(){return Ei||(Ei=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function xa(){return Ci||(Ci=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const wr=new WeakMap,ps=new WeakMap,Ir=new WeakMap,ts=new WeakMap,Os=new WeakMap;function Pa(n){const e=new Promise((t,s)=>{const i=()=>{n.removeEventListener("success",r),n.removeEventListener("error",o)},r=()=>{t(Xe(n.result)),i()},o=()=>{s(n.error),i()};n.addEventListener("success",r),n.addEventListener("error",o)});return e.then(t=>{t instanceof IDBCursor&&wr.set(t,n)}).catch(()=>{}),Os.set(e,n),e}function Da(n){if(ps.has(n))return;const e=new Promise((t,s)=>{const i=()=>{n.removeEventListener("complete",r),n.removeEventListener("error",o),n.removeEventListener("abort",o)},r=()=>{t(),i()},o=()=>{s(n.error||new DOMException("AbortError","AbortError")),i()};n.addEventListener("complete",r),n.addEventListener("error",o),n.addEventListener("abort",o)});ps.set(n,e)}let _s={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return ps.get(n);if(e==="objectStoreNames")return n.objectStoreNames||Ir.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return Xe(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function Oa(n){_s=n(_s)}function La(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const s=n.call(ns(this),e,...t);return Ir.set(s,e.sort?e.sort():[e]),Xe(s)}:xa().includes(n)?function(...e){return n.apply(ns(this),e),Xe(wr.get(this))}:function(...e){return Xe(n.apply(ns(this),e))}}function Ma(n){return typeof n=="function"?La(n):(n instanceof IDBTransaction&&Da(n),Na(n,Aa())?new Proxy(n,_s):n)}function Xe(n){if(n instanceof IDBRequest)return Pa(n);if(ts.has(n))return ts.get(n);const e=Ma(n);return e!==n&&(ts.set(n,e),Os.set(e,n)),e}const ns=n=>Os.get(n);function Fa(n,e,{blocked:t,upgrade:s,blocking:i,terminated:r}={}){const o=indexedDB.open(n,e),a=Xe(o);return s&&o.addEventListener("upgradeneeded",c=>{s(Xe(o.result),c.oldVersion,c.newVersion,Xe(o.transaction),c)}),t&&o.addEventListener("blocked",c=>t(c.oldVersion,c.newVersion,c)),a.then(c=>{r&&c.addEventListener("close",()=>r()),i&&c.addEventListener("versionchange",l=>i(l.oldVersion,l.newVersion,l))}).catch(()=>{}),a}const Ba=["get","getKey","getAll","getAllKeys","count"],$a=["put","add","delete","clear"],ss=new Map;function bi(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(ss.get(e))return ss.get(e);const t=e.replace(/FromIndex$/,""),s=e!==t,i=$a.includes(t);if(!(t in(s?IDBIndex:IDBObjectStore).prototype)||!(i||Ba.includes(t)))return;const r=async function(o,...a){const c=this.transaction(o,i?"readwrite":"readonly");let l=c.store;return s&&(l=l.index(a.shift())),(await Promise.all([l[t](...a),i&&c.done]))[0]};return ss.set(e,r),r}Oa(n=>({...n,get:(e,t,s)=>bi(e,t)||n.get(e,t,s),has:(e,t)=>!!bi(e,t)||n.has(e,t)}));class Wa{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(Ua(t)){const s=t.getImmediate();return`${s.library}/${s.version}`}else return null}).filter(t=>t).join(" ")}}function Ua(n){return n.getComponent()?.type==="VERSION"}const ms="@firebase/app",wi="0.14.8";const qe=new br("@firebase/app"),Ha="@firebase/app-compat",Va="@firebase/analytics-compat",za="@firebase/analytics",ja="@firebase/app-check-compat",Ga="@firebase/app-check",qa="@firebase/auth",Ka="@firebase/auth-compat",Ya="@firebase/database",Qa="@firebase/data-connect",Xa="@firebase/database-compat",Ja="@firebase/functions",Za="@firebase/functions-compat",el="@firebase/installations",tl="@firebase/installations-compat",nl="@firebase/messaging",sl="@firebase/messaging-compat",il="@firebase/performance",rl="@firebase/performance-compat",ol="@firebase/remote-config",al="@firebase/remote-config-compat",ll="@firebase/storage",cl="@firebase/storage-compat",hl="@firebase/firestore",ul="@firebase/ai",dl="@firebase/firestore-compat",fl="firebase",pl="12.9.0";const gs="[DEFAULT]",_l={[ms]:"fire-core",[Ha]:"fire-core-compat",[za]:"fire-analytics",[Va]:"fire-analytics-compat",[Ga]:"fire-app-check",[ja]:"fire-app-check-compat",[qa]:"fire-auth",[Ka]:"fire-auth-compat",[Ya]:"fire-rtdb",[Qa]:"fire-data-connect",[Xa]:"fire-rtdb-compat",[Ja]:"fire-fn",[Za]:"fire-fn-compat",[el]:"fire-iid",[tl]:"fire-iid-compat",[nl]:"fire-fcm",[sl]:"fire-fcm-compat",[il]:"fire-perf",[rl]:"fire-perf-compat",[ol]:"fire-rc",[al]:"fire-rc-compat",[ll]:"fire-gcs",[cl]:"fire-gcs-compat",[hl]:"fire-fst",[dl]:"fire-fst-compat",[ul]:"fire-vertex","fire-js":"fire-js",[fl]:"fire-js-all"};const Tn=new Map,ml=new Map,ys=new Map;function Ii(n,e){try{n.container.addComponent(e)}catch(t){qe.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function Sn(n){const e=n.name;if(ys.has(e))return qe.debug(`There were multiple attempts to register component ${e}.`),!1;ys.set(e,n);for(const t of Tn.values())Ii(t,n);for(const t of ml.values())Ii(t,n);return!0}function gl(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function yl(n){return n==null?!1:n.settings!==void 0}const vl={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Je=new Er("app","Firebase",vl);class El{constructor(e,t,s){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=s,this.container.addComponent(new en("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Je.create("app-deleted",{appName:this._name})}}const Cl=pl;function Tr(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const s={name:gs,automaticDataCollectionEnabled:!0,...e},i=s.name;if(typeof i!="string"||!i)throw Je.create("bad-app-name",{appName:String(i)});if(t||(t=yr()),!t)throw Je.create("no-options");const r=Tn.get(i);if(r){if(In(t,r.options)&&In(s,r.config))return r;throw Je.create("duplicate-app",{appName:i})}const o=new Ia(i);for(const c of ys.values())o.addComponent(c);const a=new El(t,s,o);return Tn.set(i,a),a}function bl(n=gs){const e=Tn.get(n);if(!e&&n===gs&&yr())return Tr();if(!e)throw Je.create("no-app",{appName:n});return e}function bt(n,e,t){let s=_l[n]??n;t&&(s+=`-${t}`);const i=s.match(/\s|\//),r=e.match(/\s|\//);if(i||r){const o=[`Unable to register library "${s}" with version "${e}":`];i&&o.push(`library name "${s}" contains illegal characters (whitespace or "/")`),i&&r&&o.push("and"),r&&o.push(`version name "${e}" contains illegal characters (whitespace or "/")`),qe.warn(o.join(" "));return}Sn(new en(`${s}-version`,()=>({library:s,version:e}),"VERSION"))}const wl="firebase-heartbeat-database",Il=1,tn="firebase-heartbeat-store";let is=null;function Sr(){return is||(is=Fa(wl,Il,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(tn)}catch(t){console.warn(t)}}}}).catch(n=>{throw Je.create("idb-open",{originalErrorMessage:n.message})})),is}async function Tl(n){try{const t=(await Sr()).transaction(tn),s=await t.objectStore(tn).get(kr(n));return await t.done,s}catch(e){if(e instanceof hn)qe.warn(e.message);else{const t=Je.create("idb-get",{originalErrorMessage:e?.message});qe.warn(t.message)}}}async function Ti(n,e){try{const s=(await Sr()).transaction(tn,"readwrite");await s.objectStore(tn).put(e,kr(n)),await s.done}catch(t){if(t instanceof hn)qe.warn(t.message);else{const s=Je.create("idb-set",{originalErrorMessage:t?.message});qe.warn(s.message)}}}function kr(n){return`${n.name}!${n.options.appId}`}const Sl=1024,kl=30;class Rl{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new Al(t),this._heartbeatsCachePromise=this._storage.read().then(s=>(this._heartbeatsCache=s,s))}async triggerHeartbeat(){try{const t=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),s=Si();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===s||this._heartbeatsCache.heartbeats.some(i=>i.date===s))return;if(this._heartbeatsCache.heartbeats.push({date:s,agent:t}),this._heartbeatsCache.heartbeats.length>kl){const i=xl(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(i,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){qe.warn(e)}}async getHeartbeatsHeader(){try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||this._heartbeatsCache.heartbeats.length===0)return"";const e=Si(),{heartbeatsToSend:t,unsentEntries:s}=Nl(this._heartbeatsCache.heartbeats),i=bn(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,s.length>0?(this._heartbeatsCache.heartbeats=s,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(e){return qe.warn(e),""}}}function Si(){return new Date().toISOString().substring(0,10)}function Nl(n,e=Sl){const t=[];let s=n.slice();for(const i of n){const r=t.find(o=>o.agent===i.agent);if(r){if(r.dates.push(i.date),ki(t)>e){r.dates.pop();break}}else if(t.push({agent:i.agent,dates:[i.date]}),ki(t)>e){t.pop();break}s=s.slice(1)}return{heartbeatsToSend:t,unsentEntries:s}}class Al{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return ua()?da().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await Tl(this.app);return t?.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const s=await this.read();return Ti(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??s.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const s=await this.read();return Ti(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??s.lastSentHeartbeatDate,heartbeats:[...s.heartbeats,...e.heartbeats]})}else return}}function ki(n){return bn(JSON.stringify({version:2,heartbeats:n})).length}function xl(n){if(n.length===0)return-1;let e=0,t=n[0].date;for(let s=1;s<n.length;s++)n[s].date<t&&(t=n[s].date,e=s);return e}function Pl(n){Sn(new en("platform-logger",e=>new Wa(e),"PRIVATE")),Sn(new en("heartbeat",e=>new Rl(e),"PRIVATE")),bt(ms,wi,n),bt(ms,wi,"esm2020"),bt("fire-js","")}Pl("");var Dl="firebase",Ol="12.9.0";bt(Dl,Ol,"app");var Ri={};const Ni="@firebase/database",Ai="1.1.0";let Rr="";function Ll(n){Rr=n}class Ml{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){t==null?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),ce(t))}get(e){const t=this.domStorage_.getItem(this.prefixedName_(e));return t==null?null:Zt(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}class Fl{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){t==null?delete this.cache_[e]:this.cache_[e]=t}get(e){return Ue(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}const Nr=function(n){try{if(typeof window<"u"&&typeof window[n]<"u"){const e=window[n];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new Ml(e)}}catch{}return new Fl},ct=Nr("localStorage"),Bl=Nr("sessionStorage");const wt=new br("@firebase/database"),$l=(function(){let n=1;return function(){return n++}})(),Ar=function(n){const e=Ea(n),t=new va;t.update(e);const s=t.digest();return Ps.encodeByteArray(s)},un=function(...n){let e="";for(let t=0;t<n.length;t++){const s=n[t];Array.isArray(s)||s&&typeof s=="object"&&typeof s.length=="number"?e+=un.apply(null,s):typeof s=="object"?e+=ce(s):e+=s,e+=" "}return e};let Kt=null,xi=!0;const Wl=function(n,e){m(!0,"Can't turn on custom loggers persistently."),wt.logLevel=Q.VERBOSE,Kt=wt.log.bind(wt)},ge=function(...n){if(xi===!0&&(xi=!1,Kt===null&&Bl.get("logging_enabled")===!0&&Wl()),Kt){const e=un.apply(null,n);Kt(e)}},dn=function(n){return function(...e){ge(n,...e)}},vs=function(...n){const e="FIREBASE INTERNAL ERROR: "+un(...n);wt.error(e)},Ke=function(...n){const e=`FIREBASE FATAL ERROR: ${un(...n)}`;throw wt.error(e),new Error(e)},Se=function(...n){const e="FIREBASE WARNING: "+un(...n);wt.warn(e)},Ul=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&Se("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},Hn=function(n){return typeof n=="number"&&(n!==n||n===Number.POSITIVE_INFINITY||n===Number.NEGATIVE_INFINITY)},Hl=function(n){if(document.readyState==="complete")n();else{let e=!1;const t=function(){if(!document.body){setTimeout(t,Math.floor(10));return}e||(e=!0,n())};document.addEventListener?(document.addEventListener("DOMContentLoaded",t,!1),window.addEventListener("load",t,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&t()}),window.attachEvent("onload",t))}},kt="[MIN_NAME]",ht="[MAX_NAME]",ft=function(n,e){if(n===e)return 0;if(n===kt||e===ht)return-1;if(e===kt||n===ht)return 1;{const t=Pi(n),s=Pi(e);return t!==null?s!==null?t-s===0?n.length-e.length:t-s:-1:s!==null?1:n<e?-1:1}},Vl=function(n,e){return n===e?0:n<e?-1:1},Ht=function(n,e){if(e&&n in e)return e[n];throw new Error("Missing required key ("+n+") in object: "+ce(e))},Ls=function(n){if(typeof n!="object"||n===null)return ce(n);const e=[];for(const s in n)e.push(s);e.sort();let t="{";for(let s=0;s<e.length;s++)s!==0&&(t+=","),t+=ce(e[s]),t+=":",t+=Ls(n[e[s]]);return t+="}",t},xr=function(n,e){const t=n.length;if(t<=e)return[n];const s=[];for(let i=0;i<t;i+=e)i+e>t?s.push(n.substring(i,t)):s.push(n.substring(i,i+e));return s};function ye(n,e){for(const t in n)n.hasOwnProperty(t)&&e(t,n[t])}const Pr=function(n){m(!Hn(n),"Invalid JSON number");const e=11,t=52,s=(1<<e-1)-1;let i,r,o,a,c;n===0?(r=0,o=0,i=1/n===-1/0?1:0):(i=n<0,n=Math.abs(n),n>=Math.pow(2,1-s)?(a=Math.min(Math.floor(Math.log(n)/Math.LN2),s),r=a+s,o=Math.round(n*Math.pow(2,t-a)-Math.pow(2,t))):(r=0,o=Math.round(n/Math.pow(2,1-s-t))));const l=[];for(c=t;c;c-=1)l.push(o%2?1:0),o=Math.floor(o/2);for(c=e;c;c-=1)l.push(r%2?1:0),r=Math.floor(r/2);l.push(i?1:0),l.reverse();const f=l.join("");let p="";for(c=0;c<64;c+=8){let d=parseInt(f.substr(c,8),2).toString(16);d.length===1&&(d="0"+d),p=p+d}return p.toLowerCase()},zl=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},jl=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"};function Gl(n,e){let t="Unknown Error";n==="too_big"?t="The data requested exceeds the maximum size that can be accessed with a single request.":n==="permission_denied"?t="Client doesn't have permission to access the desired data.":n==="unavailable"&&(t="The service is unavailable");const s=new Error(n+" at "+e._path.toString()+": "+t);return s.code=n.toUpperCase(),s}const ql=new RegExp("^-?(0*)\\d{1,10}$"),Kl=-2147483648,Yl=2147483647,Pi=function(n){if(ql.test(n)){const e=Number(n);if(e>=Kl&&e<=Yl)return e}return null},Lt=function(n){try{n()}catch(e){setTimeout(()=>{const t=e.stack||"";throw Se("Exception was thrown by user callback.",t),e},Math.floor(0))}},Ql=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},Yt=function(n,e){const t=setTimeout(n,e);return typeof t=="number"&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(t):typeof t=="object"&&t.unref&&t.unref(),t};class Xl{constructor(e,t){this.appCheckProvider=t,this.appName=e.name,yl(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken),this.appCheck=t?.getImmediate({optional:!0}),this.appCheck||t?.get().then(s=>this.appCheck=s)}getToken(e){if(this.serverAppAppCheckToken){if(e)throw new Error("Attempted reuse of `FirebaseServerApp.appCheckToken` after previous usage failed.");return Promise.resolve({token:this.serverAppAppCheckToken})}return this.appCheck?this.appCheck.getToken(e):new Promise((t,s)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(t,s):t(null)},0)})}addTokenChangeListener(e){this.appCheckProvider?.get().then(t=>t.addTokenListener(e))}notifyForInvalidToken(){Se(`Provided AppCheck credentials for the app named "${this.appName}" are invalid. This usually indicates your app was not initialized correctly.`)}}class Jl{constructor(e,t,s){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=s,this.auth_=null,this.auth_=s.getImmediate({optional:!0}),this.auth_||s.onInit(i=>this.auth_=i)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(t=>t&&t.code==="auth/token-not-initialized"?(ge("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(t)):new Promise((t,s)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(t,s):t(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(t=>t.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(t=>t.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',Se(e)}}class En{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}En.OWNER="owner";const Ms="5",Dr="v",Or="s",Lr="r",Mr="f",Fr=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,Br="ls",$r="p",Es="ac",Wr="websocket",Ur="long_polling";class Hr{constructor(e,t,s,i,r=!1,o="",a=!1,c=!1,l=null){this.secure=t,this.namespace=s,this.webSocketOnly=i,this.nodeAdmin=r,this.persistenceKey=o,this.includeNamespaceInQueryParams=a,this.isUsingEmulator=c,this.emulatorOptions=l,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=ct.get("host:"+e)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&ct.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){const e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}}function Zl(n){return n.host!==n.internalHost||n.isCustomHost()||n.includeNamespaceInQueryParams}function Vr(n,e,t){m(typeof e=="string","typeof type must == string"),m(typeof t=="object","typeof params must == object");let s;if(e===Wr)s=(n.secure?"wss://":"ws://")+n.internalHost+"/.ws?";else if(e===Ur)s=(n.secure?"https://":"http://")+n.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+e);Zl(n)&&(t.ns=n.namespace);const i=[];return ye(t,(r,o)=>{i.push(r+"="+o)}),s+i.join("&")}class ec{constructor(){this.counters_={}}incrementCounter(e,t=1){Ue(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return Yo(this.counters_)}}const rs={},os={};function Fs(n){const e=n.toString();return rs[e]||(rs[e]=new ec),rs[e]}function tc(n,e){const t=n.toString();return os[t]||(os[t]=e()),os[t]}class nc{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){const s=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let i=0;i<s.length;++i)s[i]&&Lt(()=>{this.onMessage_(s[i])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}const Di="start",sc="close",ic="pLPCommand",rc="pRTLPCB",zr="id",jr="pw",Gr="ser",oc="cb",ac="seg",lc="ts",cc="d",hc="dframe",qr=1870,Kr=30,uc=qr-Kr,dc=25e3,fc=3e4;class Et{constructor(e,t,s,i,r,o,a){this.connId=e,this.repoInfo=t,this.applicationId=s,this.appCheckToken=i,this.authToken=r,this.transportSessionId=o,this.lastSessionId=a,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=dn(e),this.stats_=Fs(t),this.urlFn=c=>(this.appCheckToken&&(c[Es]=this.appCheckToken),Vr(t,Ur,c))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new nc(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(fc)),Hl(()=>{if(this.isClosed_)return;this.scriptTagHolder=new Bs((...r)=>{const[o,a,c,l,f]=r;if(this.incrementIncomingBytes_(r),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,o===Di)this.id=a,this.password=c;else if(o===sc)a?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(a,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+o)},(...r)=>{const[o,a]=r;this.incrementIncomingBytes_(r),this.myPacketOrderer.handleResponse(o,a)},()=>{this.onClosed_()},this.urlFn);const s={};s[Di]="t",s[Gr]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(s[oc]=this.scriptTagHolder.uniqueCallbackIdentifier),s[Dr]=Ms,this.transportSessionId&&(s[Or]=this.transportSessionId),this.lastSessionId&&(s[Br]=this.lastSessionId),this.applicationId&&(s[$r]=this.applicationId),this.appCheckToken&&(s[Es]=this.appCheckToken),typeof location<"u"&&location.hostname&&Fr.test(location.hostname)&&(s[Lr]=Mr);const i=this.urlFn(s);this.log_("Connecting via long-poll to "+i),this.scriptTagHolder.addTag(i,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){Et.forceAllow_=!0}static forceDisallow(){Et.forceDisallow_=!0}static isAvailable(){return Et.forceAllow_?!0:!Et.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!zl()&&!jl()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){const t=ce(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const s=_r(t),i=xr(s,uc);for(let r=0;r<i.length;r++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,i.length,i[r]),this.curSegmentNum++}addDisconnectPingFrame(e,t){this.myDisconnFrame=document.createElement("iframe");const s={};s[hc]="t",s[zr]=e,s[jr]=t,this.myDisconnFrame.src=this.urlFn(s),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){const t=ce(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}}class Bs{constructor(e,t,s,i){this.onDisconnect=s,this.urlFn=i,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0;{this.uniqueCallbackIdentifier=$l(),window[ic+this.uniqueCallbackIdentifier]=e,window[rc+this.uniqueCallbackIdentifier]=t,this.myIFrame=Bs.createIFrame_();let r="";this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"&&(r='<script>document.domain="'+document.domain+'";<\/script>');const o="<html><body>"+r+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(o),this.myIFrame.doc.close()}catch(a){ge("frame writing exception"),a.stack&&ge(a.stack),ge(a)}}}static createIFrame_(){const e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||ge("No IE domain setting required")}catch{const s=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+s+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const e={};e[zr]=this.myID,e[jr]=this.myPW,e[Gr]=this.currentSerial;let t=this.urlFn(e),s="",i=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+Kr+s.length<=qr;){const o=this.pendingSegs.shift();s=s+"&"+ac+i+"="+o.seg+"&"+lc+i+"="+o.ts+"&"+cc+i+"="+o.d,i++}return t=t+s,this.addLongPollTag_(t,this.currentSerial),!0}else return!1}enqueueSegment(e,t,s){this.pendingSegs.push({seg:e,ts:t,d:s}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);const s=()=>{this.outstandingRequests.delete(t),this.newRequest_()},i=setTimeout(s,Math.floor(dc)),r=()=>{clearTimeout(i),s()};this.addTag(e,r)}addTag(e,t){setTimeout(()=>{try{if(!this.sendNewPolls)return;const s=this.myIFrame.doc.createElement("script");s.type="text/javascript",s.async=!0,s.src=e,s.onload=s.onreadystatechange=function(){const i=s.readyState;(!i||i==="loaded"||i==="complete")&&(s.onload=s.onreadystatechange=null,s.parentNode&&s.parentNode.removeChild(s),t())},s.onerror=()=>{ge("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(s)}catch{}},Math.floor(1))}}const pc=16384,_c=45e3;let kn=null;typeof MozWebSocket<"u"?kn=MozWebSocket:typeof WebSocket<"u"&&(kn=WebSocket);class Oe{constructor(e,t,s,i,r,o,a){this.connId=e,this.applicationId=s,this.appCheckToken=i,this.authToken=r,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=dn(this.connId),this.stats_=Fs(t),this.connURL=Oe.connectionURL_(t,o,a,i,s),this.nodeAdmin=t.nodeAdmin}static connectionURL_(e,t,s,i,r){const o={};return o[Dr]=Ms,typeof location<"u"&&location.hostname&&Fr.test(location.hostname)&&(o[Lr]=Mr),t&&(o[Or]=t),s&&(o[Br]=s),i&&(o[Es]=i),r&&(o[$r]=r),Vr(e,Wr,o)}open(e,t){this.onDisconnect=t,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,ct.set("previous_websocket_failure",!0);try{let s;ha(),this.mySock=new kn(this.connURL,[],s)}catch(s){this.log_("Error instantiating WebSocket.");const i=s.message||s.data;i&&this.log_(i),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=s=>{this.handleIncomingFrame(s)},this.mySock.onerror=s=>{this.log_("WebSocket error.  Closing connection.");const i=s.message||s.data;i&&this.log_(i),this.onClosed_()}}start(){}static forceDisallow(){Oe.forceDisallow_=!0}static isAvailable(){let e=!1;if(typeof navigator<"u"&&navigator.userAgent){const t=/Android ([0-9]{0,}\.[0-9]{0,})/,s=navigator.userAgent.match(t);s&&s.length>1&&parseFloat(s[1])<4.4&&(e=!0)}return!e&&kn!==null&&!Oe.forceDisallow_}static previouslyFailed(){return ct.isInMemoryStorage||ct.get("previous_websocket_failure")===!0}markConnectionHealthy(){ct.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){const t=this.frames.join("");this.frames=null;const s=Zt(t);this.onMessage(s)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(m(this.frames===null,"We already have a frame buffer"),e.length<=6){const t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(this.mySock===null)return;const t=e.data;if(this.bytesReceived+=t.length,this.stats_.incrementCounter("bytes_received",t.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(t);else{const s=this.extractFrameCount_(t);s!==null&&this.appendFrame_(s)}}send(e){this.resetKeepAlive();const t=ce(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const s=xr(t,pc);s.length>1&&this.sendString_(String(s.length));for(let i=0;i<s.length;i++)this.sendString_(s[i])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(_c))}sendString_(e){try{this.mySock.send(e)}catch(t){this.log_("Exception thrown from WebSocket.send():",t.message||t.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}Oe.responsesRequiredToBeHealthy=2;Oe.healthyTimeout=3e4;class nn{static get ALL_TRANSPORTS(){return[Et,Oe]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}constructor(e){this.initTransports_(e)}initTransports_(e){const t=Oe&&Oe.isAvailable();let s=t&&!Oe.previouslyFailed();if(e.webSocketOnly&&(t||Se("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),s=!0),s)this.transports_=[Oe];else{const i=this.transports_=[];for(const r of nn.ALL_TRANSPORTS)r&&r.isAvailable()&&i.push(r);nn.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}nn.globalTransportInitialized_=!1;const mc=6e4,gc=5e3,yc=10*1024,vc=100*1024,as="t",Oi="d",Ec="s",Li="r",Cc="e",Mi="o",Fi="a",Bi="n",$i="p",bc="h";class wc{constructor(e,t,s,i,r,o,a,c,l,f){this.id=e,this.repoInfo_=t,this.applicationId_=s,this.appCheckToken_=i,this.authToken_=r,this.onMessage_=o,this.onReady_=a,this.onDisconnect_=c,this.onKill_=l,this.lastSessionId=f,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=dn("c:"+this.id+":"),this.transportManager_=new nn(t),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.conn_),s=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,s)},Math.floor(0));const i=e.healthyTimeout||0;i>0&&(this.healthyTimeout_=Yt(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>vc?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>yc?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(i)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{this.state_!==2&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){const t={t:"d",d:e};this.sendData_(t)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if(as in e){const t=e[as];t===Fi?this.upgradeIfSecondaryHealthy_():t===Li?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):t===Mi&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){const t=Ht("t",e),s=Ht("d",e);if(t==="c")this.onSecondaryControl_(s);else if(t==="d")this.pendingDataMessages.push(s);else throw new Error("Unknown protocol layer: "+t)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:$i,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:Fi,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:Bi,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){const t=Ht("t",e),s=Ht("d",e);t==="c"?this.onControl_(s):t==="d"&&this.onDataMessage_(s)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){const t=Ht(as,e);if(Oi in e){const s=e[Oi];if(t===bc){const i={...s};this.repoInfo_.isUsingEmulator&&(i.h=this.repoInfo_.host),this.onHandshake_(i)}else if(t===Bi){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let i=0;i<this.pendingDataMessages.length;++i)this.onDataMessage_(this.pendingDataMessages[i]);this.pendingDataMessages=[],this.tryCleanupConnection()}else t===Ec?this.onConnectionShutdown_(s):t===Li?this.onReset_(s):t===Cc?vs("Server Error: "+s):t===Mi?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):vs("Unknown control packet command: "+t)}}onHandshake_(e){const t=e.ts,s=e.v,i=e.h;this.sessionId=e.s,this.repoInfo_.host=i,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),Ms!==s&&Se("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.secondaryConn_),s=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,s),Yt(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(mc))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):Yt(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(gc))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:$i,d:{}}}))}onSecondaryConnectionLost_(){const e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,!e&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(ct.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(e)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}class Yr{put(e,t,s,i){}merge(e,t,s,i){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,s){}onDisconnectMerge(e,t,s){}onDisconnectCancel(e,t){}reportStats(e){}}class Qr{constructor(e){this.allowedEvents_=e,this.listeners_={},m(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){const s=[...this.listeners_[e]];for(let i=0;i<s.length;i++)s[i].callback.apply(s[i].context,t)}}on(e,t,s){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:s});const i=this.getInitialEvent(e);i&&t.apply(s,i)}off(e,t,s){this.validateEventType_(e);const i=this.listeners_[e]||[];for(let r=0;r<i.length;r++)if(i[r].callback===t&&(!s||s===i[r].context)){i.splice(r,1);return}}validateEventType_(e){m(this.allowedEvents_.find(t=>t===e),"Unknown event: "+e)}}class Rn extends Qr{static getInstance(){return new Rn}constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!vr()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}getInitialEvent(e){return m(e==="online","Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}const Wi=32,Ui=768;class G{constructor(e,t){if(t===void 0){this.pieces_=e.split("/");let s=0;for(let i=0;i<this.pieces_.length;i++)this.pieces_[i].length>0&&(this.pieces_[s]=this.pieces_[i],s++);this.pieces_.length=s,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)this.pieces_[t]!==""&&(e+="/"+this.pieces_[t]);return e||"/"}}function U(){return new G("")}function x(n){return n.pieceNum_>=n.pieces_.length?null:n.pieces_[n.pieceNum_]}function tt(n){return n.pieces_.length-n.pieceNum_}function K(n){let e=n.pieceNum_;return e<n.pieces_.length&&e++,new G(n.pieces_,e)}function $s(n){return n.pieceNum_<n.pieces_.length?n.pieces_[n.pieces_.length-1]:null}function Ic(n){let e="";for(let t=n.pieceNum_;t<n.pieces_.length;t++)n.pieces_[t]!==""&&(e+="/"+encodeURIComponent(String(n.pieces_[t])));return e||"/"}function sn(n,e=0){return n.pieces_.slice(n.pieceNum_+e)}function Xr(n){if(n.pieceNum_>=n.pieces_.length)return null;const e=[];for(let t=n.pieceNum_;t<n.pieces_.length-1;t++)e.push(n.pieces_[t]);return new G(e,0)}function te(n,e){const t=[];for(let s=n.pieceNum_;s<n.pieces_.length;s++)t.push(n.pieces_[s]);if(e instanceof G)for(let s=e.pieceNum_;s<e.pieces_.length;s++)t.push(e.pieces_[s]);else{const s=e.split("/");for(let i=0;i<s.length;i++)s[i].length>0&&t.push(s[i])}return new G(t,0)}function P(n){return n.pieceNum_>=n.pieces_.length}function Te(n,e){const t=x(n),s=x(e);if(t===null)return e;if(t===s)return Te(K(n),K(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+n+")")}function Tc(n,e){const t=sn(n,0),s=sn(e,0);for(let i=0;i<t.length&&i<s.length;i++){const r=ft(t[i],s[i]);if(r!==0)return r}return t.length===s.length?0:t.length<s.length?-1:1}function Ws(n,e){if(tt(n)!==tt(e))return!1;for(let t=n.pieceNum_,s=e.pieceNum_;t<=n.pieces_.length;t++,s++)if(n.pieces_[t]!==e.pieces_[s])return!1;return!0}function Pe(n,e){let t=n.pieceNum_,s=e.pieceNum_;if(tt(n)>tt(e))return!1;for(;t<n.pieces_.length;){if(n.pieces_[t]!==e.pieces_[s])return!1;++t,++s}return!0}class Sc{constructor(e,t){this.errorPrefix_=t,this.parts_=sn(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let s=0;s<this.parts_.length;s++)this.byteLength_+=Un(this.parts_[s]);Jr(this)}}function kc(n,e){n.parts_.length>0&&(n.byteLength_+=1),n.parts_.push(e),n.byteLength_+=Un(e),Jr(n)}function Rc(n){const e=n.parts_.pop();n.byteLength_-=Un(e),n.parts_.length>0&&(n.byteLength_-=1)}function Jr(n){if(n.byteLength_>Ui)throw new Error(n.errorPrefix_+"has a key path longer than "+Ui+" bytes ("+n.byteLength_+").");if(n.parts_.length>Wi)throw new Error(n.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+Wi+") or object contains a cycle "+at(n))}function at(n){return n.parts_.length===0?"":"in property '"+n.parts_.join(".")+"'"}class Us extends Qr{static getInstance(){return new Us}constructor(){super(["visible"]);let e,t;typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(t="visibilitychange",e="hidden"):typeof document.mozHidden<"u"?(t="mozvisibilitychange",e="mozHidden"):typeof document.msHidden<"u"?(t="msvisibilitychange",e="msHidden"):typeof document.webkitHidden<"u"&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,()=>{const s=!document[e];s!==this.visible_&&(this.visible_=s,this.trigger("visible",s))},!1)}getInitialEvent(e){return m(e==="visible","Unknown event type: "+e),[this.visible_]}}const Vt=1e3,Nc=300*1e3,Hi=30*1e3,Ac=1.3,xc=3e4,Pc="server_kill",Vi=3;class Ge extends Yr{constructor(e,t,s,i,r,o,a,c){if(super(),this.repoInfo_=e,this.applicationId_=t,this.onDataUpdate_=s,this.onConnectStatus_=i,this.onServerInfoUpdate_=r,this.authTokenProvider_=o,this.appCheckTokenProvider_=a,this.authOverride_=c,this.id=Ge.nextPersistentConnectionId_++,this.log_=dn("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=Vt,this.maxReconnectDelay_=Nc,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,c)throw new Error("Auth override specified in options, but not supported on non Node.js platforms");Us.getInstance().on("visible",this.onVisible_,this),e.host.indexOf("fblocal")===-1&&Rn.getInstance().on("online",this.onOnline_,this)}sendRequest(e,t,s){const i=++this.requestNumber_,r={r:i,a:e,b:t};this.log_(ce(r)),m(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(r),s&&(this.requestCBHash_[i]=s)}get(e){this.initConnection_();const t=new We,i={action:"g",request:{p:e._path.toString(),q:e._queryObject},onComplete:o=>{const a=o.d;o.s==="ok"?t.resolve(a):t.reject(a)}};this.outstandingGets_.push(i),this.outstandingGetCount_++;const r=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(r),t.promise}listen(e,t,s,i){this.initConnection_();const r=e._queryIdentifier,o=e._path.toString();this.log_("Listen called for "+o+" "+r),this.listens.has(o)||this.listens.set(o,new Map),m(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),m(!this.listens.get(o).has(r),"listen() called twice for same path/queryId.");const a={onComplete:i,hashFn:t,query:e,tag:s};this.listens.get(o).set(r,a),this.connected_&&this.sendListen_(a)}sendGet_(e){const t=this.outstandingGets_[e];this.sendRequest("g",t.request,s=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),t.onComplete&&t.onComplete(s)})}sendListen_(e){const t=e.query,s=t._path.toString(),i=t._queryIdentifier;this.log_("Listen on "+s+" for "+i);const r={p:s},o="q";e.tag&&(r.q=t._queryObject,r.t=e.tag),r.h=e.hashFn(),this.sendRequest(o,r,a=>{const c=a.d,l=a.s;Ge.warnOnListenWarnings_(c,t),(this.listens.get(s)&&this.listens.get(s).get(i))===e&&(this.log_("listen response",a),l!=="ok"&&this.removeListen_(s,i),e.onComplete&&e.onComplete(l,c))})}static warnOnListenWarnings_(e,t){if(e&&typeof e=="object"&&Ue(e,"w")){const s=Tt(e,"w");if(Array.isArray(s)&&~s.indexOf("no_index")){const i='".indexOn": "'+t._queryParams.getIndex().toString()+'"',r=t._path.toString();Se(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${i} at ${r} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&e.length===40||ga(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=Hi)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const e=this.authToken_,t=ma(e)?"auth":"gauth",s={cred:e};this.authOverride_===null?s.noauth=!0:typeof this.authOverride_=="object"&&(s.authvar=this.authOverride_),this.sendRequest(t,s,i=>{const r=i.s,o=i.d||"error";this.authToken_===e&&(r==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(r,o))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{const t=e.s,s=e.d||"error";t==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(t,s)})}unlisten(e,t){const s=e._path.toString(),i=e._queryIdentifier;this.log_("Unlisten called for "+s+" "+i),m(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(s,i)&&this.connected_&&this.sendUnlisten_(s,i,e._queryObject,t)}sendUnlisten_(e,t,s,i){this.log_("Unlisten on "+e+" for "+t);const r={p:e},o="n";i&&(r.q=s,r.t=i),this.sendRequest(o,r)}onDisconnectPut(e,t,s){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,t,s):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:s})}onDisconnectMerge(e,t,s){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,t,s):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:s})}onDisconnectCancel(e,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})}sendOnDisconnect_(e,t,s,i){const r={p:t,d:s};this.log_("onDisconnect "+e,r),this.sendRequest(e,r,o=>{i&&setTimeout(()=>{i(o.s,o.d)},Math.floor(0))})}put(e,t,s,i){this.putInternal("p",e,t,s,i)}merge(e,t,s,i){this.putInternal("m",e,t,s,i)}putInternal(e,t,s,i,r){this.initConnection_();const o={p:t,d:s};r!==void 0&&(o.h=r),this.outstandingPuts_.push({action:e,request:o,onComplete:i}),this.outstandingPutCount_++;const a=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(a):this.log_("Buffering put: "+t)}sendPut_(e){const t=this.outstandingPuts_[e].action,s=this.outstandingPuts_[e].request,i=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(t,s,r=>{this.log_(t+" response",r),delete this.outstandingPuts_[e],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),i&&i(r.s,r.d)})}reportStats(e){if(this.connected_){const t={c:e};this.log_("reportStats",t),this.sendRequest("s",t,s=>{if(s.s!=="ok"){const r=s.d;this.log_("reportStats","Error sending stats: "+r)}})}}onDataMessage_(e){if("r"in e){this.log_("from server: "+ce(e));const t=e.r,s=this.requestCBHash_[t];s&&(delete this.requestCBHash_[t],s(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,t){this.log_("handleServerMessage",e,t),e==="d"?this.onDataUpdate_(t.p,t.d,!1,t.t):e==="m"?this.onDataUpdate_(t.p,t.d,!0,t.t):e==="c"?this.onListenRevoked_(t.p,t.q):e==="ac"?this.onAuthRevoked_(t.s,t.d):e==="apc"?this.onAppCheckRevoked_(t.s,t.d):e==="sd"?this.onSecurityDebugPacket_(t):vs("Unrecognized action received from server: "+ce(e)+`
Are you using the latest client?`)}onReady_(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){m(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=Vt,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=Vt,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>xc&&(this.reconnectDelay_=Vt),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());const e=Math.max(0,new Date().getTime()-this.lastConnectionAttemptTime_);let t=Math.max(0,this.reconnectDelay_-e);t=Math.random()*t,this.log_("Trying to reconnect in "+t+"ms"),this.scheduleConnect_(t),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*Ac)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;const e=this.onDataMessage_.bind(this),t=this.onReady_.bind(this),s=this.onRealtimeDisconnect_.bind(this),i=this.id+":"+Ge.nextConnectionId_++,r=this.lastSessionId;let o=!1,a=null;const c=function(){a?a.close():(o=!0,s())},l=function(p){m(a,"sendRequest call when we're not connected not allowed."),a.sendRequest(p)};this.realtime_={close:c,sendRequest:l};const f=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[p,d]=await Promise.all([this.authTokenProvider_.getToken(f),this.appCheckTokenProvider_.getToken(f)]);o?ge("getToken() completed but was canceled"):(ge("getToken() completed. Creating connection."),this.authToken_=p&&p.accessToken,this.appCheckToken_=d&&d.token,a=new wc(i,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,t,s,g=>{Se(g+" ("+this.repoInfo_.toString()+")"),this.interrupt(Pc)},r))}catch(p){this.log_("Failed to get token: "+p),o||(this.repoInfo_.nodeAdmin&&Se(p),c())}}}interrupt(e){ge("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){ge("Resuming connection for reason: "+e),delete this.interruptReasons_[e],fs(this.interruptReasons_)&&(this.reconnectDelay_=Vt,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){const t=e-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:t})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){const t=this.outstandingPuts_[e];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(e,t){let s;t?s=t.map(r=>Ls(r)).join("$"):s="default";const i=this.removeListen_(e,s);i&&i.onComplete&&i.onComplete("permission_denied")}removeListen_(e,t){const s=new G(e).toString();let i;if(this.listens.has(s)){const r=this.listens.get(s);i=r.get(t),r.delete(t),r.size===0&&this.listens.delete(s)}else i=void 0;return i}onAuthRevoked_(e,t){ge("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(e==="invalid_token"||e==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=Vi&&(this.reconnectDelay_=Hi,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,t){ge("App check token revoked: "+e+"/"+t),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(e==="invalid_token"||e==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=Vi&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const e of this.listens.values())for(const t of e.values())this.sendListen_(t);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){const e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){const e={};let t="js";e["sdk."+t+"."+Rr.replace(/\./g,"-")]=1,vr()?e["framework.cordova"]=1:ca()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){const e=Rn.getInstance().currentlyOnline();return fs(this.interruptReasons_)&&e}}Ge.nextPersistentConnectionId_=0;Ge.nextConnectionId_=0;class D{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new D(e,t)}}class Vn{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){const s=new D(kt,e),i=new D(kt,t);return this.compare(s,i)!==0}minPost(){return D.MIN}}let gn;class Zr extends Vn{static get __EMPTY_NODE(){return gn}static set __EMPTY_NODE(e){gn=e}compare(e,t){return ft(e.name,t.name)}isDefinedOn(e){throw Ot("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return D.MIN}maxPost(){return new D(ht,gn)}makePost(e,t){return m(typeof e=="string","KeyIndex indexValue must always be a string."),new D(e,gn)}toString(){return".key"}}const It=new Zr;class yn{constructor(e,t,s,i,r=null){this.isReverse_=i,this.resultGenerator_=r,this.nodeStack_=[];let o=1;for(;!e.isEmpty();)if(e=e,o=t?s(e.key,t):1,i&&(o*=-1),o<0)this.isReverse_?e=e.left:e=e.right;else if(o===0){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),this.isReverse_?e=e.right:e=e.left}getNext(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_.pop(),t;if(this.resultGenerator_?t=this.resultGenerator_(e.key,e.value):t={key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;const e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}class me{constructor(e,t,s,i,r){this.key=e,this.value=t,this.color=s??me.RED,this.left=i??Ne.EMPTY_NODE,this.right=r??Ne.EMPTY_NODE}copy(e,t,s,i,r){return new me(e??this.key,t??this.value,s??this.color,i??this.left,r??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,s){let i=this;const r=s(e,i.key);return r<0?i=i.copy(null,null,null,i.left.insert(e,t,s),null):r===0?i=i.copy(null,t,null,null,null):i=i.copy(null,null,null,null,i.right.insert(e,t,s)),i.fixUp_()}removeMin_(){if(this.left.isEmpty())return Ne.EMPTY_NODE;let e=this;return!e.left.isRed_()&&!e.left.left.isRed_()&&(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,t){let s,i;if(s=this,t(e,s.key)<0)!s.left.isEmpty()&&!s.left.isRed_()&&!s.left.left.isRed_()&&(s=s.moveRedLeft_()),s=s.copy(null,null,null,s.left.remove(e,t),null);else{if(s.left.isRed_()&&(s=s.rotateRight_()),!s.right.isEmpty()&&!s.right.isRed_()&&!s.right.left.isRed_()&&(s=s.moveRedRight_()),t(e,s.key)===0){if(s.right.isEmpty())return Ne.EMPTY_NODE;i=s.right.min_(),s=s.copy(i.key,i.value,null,null,s.right.removeMin_())}s=s.copy(null,null,null,null,s.right.remove(e,t))}return s.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){const e=this.copy(null,null,me.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){const e=this.copy(null,null,me.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth_(){const e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}}me.RED=!0;me.BLACK=!1;class Dc{copy(e,t,s,i,r){return this}insert(e,t,s){return new me(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}}class Ne{constructor(e,t=Ne.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new Ne(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,me.BLACK,null,null))}remove(e){return new Ne(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,me.BLACK,null,null))}get(e){let t,s=this.root_;for(;!s.isEmpty();){if(t=this.comparator_(e,s.key),t===0)return s.value;t<0?s=s.left:t>0&&(s=s.right)}return null}getPredecessorKey(e){let t,s=this.root_,i=null;for(;!s.isEmpty();)if(t=this.comparator_(e,s.key),t===0){if(s.left.isEmpty())return i?i.key:null;for(s=s.left;!s.right.isEmpty();)s=s.right;return s.key}else t<0?s=s.left:t>0&&(i=s,s=s.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new yn(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new yn(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new yn(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new yn(this.root_,null,this.comparator_,!0,e)}}Ne.EMPTY_NODE=new Dc;function Oc(n,e){return ft(n.name,e.name)}function Hs(n,e){return ft(n,e)}let Cs;function Lc(n){Cs=n}const eo=function(n){return typeof n=="number"?"number:"+Pr(n):"string:"+n},to=function(n){if(n.isLeafNode()){const e=n.val();m(typeof e=="string"||typeof e=="number"||typeof e=="object"&&Ue(e,".sv"),"Priority must be a string or number.")}else m(n===Cs||n.isEmpty(),"priority of unexpected type.");m(n===Cs||n.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};let zi;class _e{static set __childrenNodeConstructor(e){zi=e}static get __childrenNodeConstructor(){return zi}constructor(e,t=_e.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=t,this.lazyHash_=null,m(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),to(this.priorityNode_)}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new _e(this.value_,e)}getImmediateChild(e){return e===".priority"?this.priorityNode_:_e.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return P(e)?this:x(e)===".priority"?this.priorityNode_:_e.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,t){return null}updateImmediateChild(e,t){return e===".priority"?this.updatePriority(t):t.isEmpty()&&e!==".priority"?this:_e.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,t).updatePriority(this.priorityNode_)}updateChild(e,t){const s=x(e);return s===null?t:t.isEmpty()&&s!==".priority"?this:(m(s!==".priority"||tt(e)===1,".priority must be the last token in a path"),this.updateImmediateChild(s,_e.__childrenNodeConstructor.EMPTY_NODE.updateChild(K(e),t)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,t){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+eo(this.priorityNode_.val())+":");const t=typeof this.value_;e+=t+":",t==="number"?e+=Pr(this.value_):e+=this.value_,this.lazyHash_=Ar(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===_e.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof _e.__childrenNodeConstructor?-1:(m(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){const t=typeof e.value_,s=typeof this.value_,i=_e.VALUE_TYPE_ORDER.indexOf(t),r=_e.VALUE_TYPE_ORDER.indexOf(s);return m(i>=0,"Unknown leaf type: "+t),m(r>=0,"Unknown leaf type: "+s),i===r?s==="object"?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:r-i}withIndex(){return this}isIndexed(){return!0}equals(e){if(e===this)return!0;if(e.isLeafNode()){const t=e;return this.value_===t.value_&&this.priorityNode_.equals(t.priorityNode_)}else return!1}}_e.VALUE_TYPE_ORDER=["object","boolean","number","string"];let no,so;function Mc(n){no=n}function Fc(n){so=n}class Bc extends Vn{compare(e,t){const s=e.node.getPriority(),i=t.node.getPriority(),r=s.compareTo(i);return r===0?ft(e.name,t.name):r}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return D.MIN}maxPost(){return new D(ht,new _e("[PRIORITY-POST]",so))}makePost(e,t){const s=no(e);return new D(t,new _e("[PRIORITY-POST]",s))}toString(){return".priority"}}const ne=new Bc;const $c=Math.log(2);class Wc{constructor(e){const t=r=>parseInt(Math.log(r)/$c,10),s=r=>parseInt(Array(r+1).join("1"),2);this.count=t(e+1),this.current_=this.count-1;const i=s(this.count);this.bits_=e+1&i}nextBitIsOne(){const e=!(this.bits_&1<<this.current_);return this.current_--,e}}const Nn=function(n,e,t,s){n.sort(e);const i=function(c,l){const f=l-c;let p,d;if(f===0)return null;if(f===1)return p=n[c],d=t?t(p):p,new me(d,p.node,me.BLACK,null,null);{const g=parseInt(f/2,10)+c,b=i(c,g),R=i(g+1,l);return p=n[g],d=t?t(p):p,new me(d,p.node,me.BLACK,b,R)}},r=function(c){let l=null,f=null,p=n.length;const d=function(b,R){const V=p-b,he=p;p-=b;const Ee=i(V+1,he),oe=n[V],Ve=t?t(oe):oe;g(new me(Ve,oe.node,R,null,Ee))},g=function(b){l?(l.left=b,l=b):(f=b,l=b)};for(let b=0;b<c.count;++b){const R=c.nextBitIsOne(),V=Math.pow(2,c.count-(b+1));R?d(V,me.BLACK):(d(V,me.BLACK),d(V,me.RED))}return f},o=new Wc(n.length),a=r(o);return new Ne(s||e,a)};let ls;const gt={};class je{static get Default(){return m(gt&&ne,"ChildrenNode.ts has not been loaded"),ls=ls||new je({".priority":gt},{".priority":ne}),ls}constructor(e,t){this.indexes_=e,this.indexSet_=t}get(e){const t=Tt(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof Ne?t:null}hasIndex(e){return Ue(this.indexSet_,e.toString())}addIndex(e,t){m(e!==It,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const s=[];let i=!1;const r=t.getIterator(D.Wrap);let o=r.getNext();for(;o;)i=i||e.isDefinedOn(o.node),s.push(o),o=r.getNext();let a;i?a=Nn(s,e.getCompare()):a=gt;const c=e.toString(),l={...this.indexSet_};l[c]=e;const f={...this.indexes_};return f[c]=a,new je(f,l)}addToIndexes(e,t){const s=wn(this.indexes_,(i,r)=>{const o=Tt(this.indexSet_,r);if(m(o,"Missing index implementation for "+r),i===gt)if(o.isDefinedOn(e.node)){const a=[],c=t.getIterator(D.Wrap);let l=c.getNext();for(;l;)l.name!==e.name&&a.push(l),l=c.getNext();return a.push(e),Nn(a,o.getCompare())}else return gt;else{const a=t.get(e.name);let c=i;return a&&(c=c.remove(new D(e.name,a))),c.insert(e,e.node)}});return new je(s,this.indexSet_)}removeFromIndexes(e,t){const s=wn(this.indexes_,i=>{if(i===gt)return i;{const r=t.get(e.name);return r?i.remove(new D(e.name,r)):i}});return new je(s,this.indexSet_)}}let zt;class T{static get EMPTY_NODE(){return zt||(zt=new T(new Ne(Hs),null,je.Default))}constructor(e,t,s){this.children_=e,this.priorityNode_=t,this.indexMap_=s,this.lazyHash_=null,this.priorityNode_&&to(this.priorityNode_),this.children_.isEmpty()&&m(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}isLeafNode(){return!1}getPriority(){return this.priorityNode_||zt}updatePriority(e){return this.children_.isEmpty()?this:new T(this.children_,e,this.indexMap_)}getImmediateChild(e){if(e===".priority")return this.getPriority();{const t=this.children_.get(e);return t===null?zt:t}}getChild(e){const t=x(e);return t===null?this:this.getImmediateChild(t).getChild(K(e))}hasChild(e){return this.children_.get(e)!==null}updateImmediateChild(e,t){if(m(t,"We should always be passing snapshot nodes"),e===".priority")return this.updatePriority(t);{const s=new D(e,t);let i,r;t.isEmpty()?(i=this.children_.remove(e),r=this.indexMap_.removeFromIndexes(s,this.children_)):(i=this.children_.insert(e,t),r=this.indexMap_.addToIndexes(s,this.children_));const o=i.isEmpty()?zt:this.priorityNode_;return new T(i,o,r)}}updateChild(e,t){const s=x(e);if(s===null)return t;{m(x(e)!==".priority"||tt(e)===1,".priority must be the last token in a path");const i=this.getImmediateChild(s).updateChild(K(e),t);return this.updateImmediateChild(s,i)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;const t={};let s=0,i=0,r=!0;if(this.forEachChild(ne,(o,a)=>{t[o]=a.val(e),s++,r&&T.INTEGER_REGEXP_.test(o)?i=Math.max(i,Number(o)):r=!1}),!e&&r&&i<2*s){const o=[];for(const a in t)o[a]=t[a];return o}else return e&&!this.getPriority().isEmpty()&&(t[".priority"]=this.getPriority().val()),t}hash(){if(this.lazyHash_===null){let e="";this.getPriority().isEmpty()||(e+="priority:"+eo(this.getPriority().val())+":"),this.forEachChild(ne,(t,s)=>{const i=s.hash();i!==""&&(e+=":"+t+":"+i)}),this.lazyHash_=e===""?"":Ar(e)}return this.lazyHash_}getPredecessorChildName(e,t,s){const i=this.resolveIndex_(s);if(i){const r=i.getPredecessorKey(new D(e,t));return r?r.name:null}else return this.children_.getPredecessorKey(e)}getFirstChildName(e){const t=this.resolveIndex_(e);if(t){const s=t.minKey();return s&&s.name}else return this.children_.minKey()}getFirstChild(e){const t=this.getFirstChildName(e);return t?new D(t,this.children_.get(t)):null}getLastChildName(e){const t=this.resolveIndex_(e);if(t){const s=t.maxKey();return s&&s.name}else return this.children_.maxKey()}getLastChild(e){const t=this.getLastChildName(e);return t?new D(t,this.children_.get(t)):null}forEachChild(e,t){const s=this.resolveIndex_(e);return s?s.inorderTraversal(i=>t(i.name,i.node)):this.children_.inorderTraversal(t)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,t){const s=this.resolveIndex_(t);if(s)return s.getIteratorFrom(e,i=>i);{const i=this.children_.getIteratorFrom(e.name,D.Wrap);let r=i.peek();for(;r!=null&&t.compare(r,e)<0;)i.getNext(),r=i.peek();return i}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,t){const s=this.resolveIndex_(t);if(s)return s.getReverseIteratorFrom(e,i=>i);{const i=this.children_.getReverseIteratorFrom(e.name,D.Wrap);let r=i.peek();for(;r!=null&&t.compare(r,e)>0;)i.getNext(),r=i.peek();return i}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===fn?-1:0}withIndex(e){if(e===It||this.indexMap_.hasIndex(e))return this;{const t=this.indexMap_.addIndex(e,this.children_);return new T(this.children_,this.priorityNode_,t)}}isIndexed(e){return e===It||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const t=e;if(this.getPriority().equals(t.getPriority()))if(this.children_.count()===t.children_.count()){const s=this.getIterator(ne),i=t.getIterator(ne);let r=s.getNext(),o=i.getNext();for(;r&&o;){if(r.name!==o.name||!r.node.equals(o.node))return!1;r=s.getNext(),o=i.getNext()}return r===null&&o===null}else return!1;else return!1}}resolveIndex_(e){return e===It?null:this.indexMap_.get(e.toString())}}T.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;class Uc extends T{constructor(){super(new Ne(Hs),T.EMPTY_NODE,je.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return T.EMPTY_NODE}isEmpty(){return!1}}const fn=new Uc;Object.defineProperties(D,{MIN:{value:new D(kt,T.EMPTY_NODE)},MAX:{value:new D(ht,fn)}});Zr.__EMPTY_NODE=T.EMPTY_NODE;_e.__childrenNodeConstructor=T;Lc(fn);Fc(fn);const Hc=!0;function ie(n,e=null){if(n===null)return T.EMPTY_NODE;if(typeof n=="object"&&".priority"in n&&(e=n[".priority"]),m(e===null||typeof e=="string"||typeof e=="number"||typeof e=="object"&&".sv"in e,"Invalid priority type found: "+typeof e),typeof n=="object"&&".value"in n&&n[".value"]!==null&&(n=n[".value"]),typeof n!="object"||".sv"in n){const t=n;return new _e(t,ie(e))}if(!(n instanceof Array)&&Hc){const t=[];let s=!1;if(ye(n,(o,a)=>{if(o.substring(0,1)!=="."){const c=ie(a);c.isEmpty()||(s=s||!c.getPriority().isEmpty(),t.push(new D(o,c)))}}),t.length===0)return T.EMPTY_NODE;const r=Nn(t,Oc,o=>o.name,Hs);if(s){const o=Nn(t,ne.getCompare());return new T(r,ie(e),new je({".priority":o},{".priority":ne}))}else return new T(r,ie(e),je.Default)}else{let t=T.EMPTY_NODE;return ye(n,(s,i)=>{if(Ue(n,s)&&s.substring(0,1)!=="."){const r=ie(i);(r.isLeafNode()||!r.isEmpty())&&(t=t.updateImmediateChild(s,r))}}),t.updatePriority(ie(e))}}Mc(ie);class Vc extends Vn{constructor(e){super(),this.indexPath_=e,m(!P(e)&&x(e)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){const s=this.extractChild(e.node),i=this.extractChild(t.node),r=s.compareTo(i);return r===0?ft(e.name,t.name):r}makePost(e,t){const s=ie(e),i=T.EMPTY_NODE.updateChild(this.indexPath_,s);return new D(t,i)}maxPost(){const e=T.EMPTY_NODE.updateChild(this.indexPath_,fn);return new D(ht,e)}toString(){return sn(this.indexPath_,0).join("/")}}class zc extends Vn{compare(e,t){const s=e.node.compareTo(t.node);return s===0?ft(e.name,t.name):s}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return D.MIN}maxPost(){return D.MAX}makePost(e,t){const s=ie(e);return new D(t,s)}toString(){return".value"}}const jc=new zc;function io(n){return{type:"value",snapshotNode:n}}function Rt(n,e){return{type:"child_added",snapshotNode:e,childName:n}}function rn(n,e){return{type:"child_removed",snapshotNode:e,childName:n}}function on(n,e,t){return{type:"child_changed",snapshotNode:e,childName:n,oldSnap:t}}function Gc(n,e){return{type:"child_moved",snapshotNode:e,childName:n}}class Vs{constructor(e){this.index_=e}updateChild(e,t,s,i,r,o){m(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");const a=e.getImmediateChild(t);return a.getChild(i).equals(s.getChild(i))&&a.isEmpty()===s.isEmpty()||(o!=null&&(s.isEmpty()?e.hasChild(t)?o.trackChildChange(rn(t,a)):m(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):a.isEmpty()?o.trackChildChange(Rt(t,s)):o.trackChildChange(on(t,s,a))),e.isLeafNode()&&s.isEmpty())?e:e.updateImmediateChild(t,s).withIndex(this.index_)}updateFullNode(e,t,s){return s!=null&&(e.isLeafNode()||e.forEachChild(ne,(i,r)=>{t.hasChild(i)||s.trackChildChange(rn(i,r))}),t.isLeafNode()||t.forEachChild(ne,(i,r)=>{if(e.hasChild(i)){const o=e.getImmediateChild(i);o.equals(r)||s.trackChildChange(on(i,r,o))}else s.trackChildChange(Rt(i,r))})),t.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?T.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}class an{constructor(e){this.indexedFilter_=new Vs(e.getIndex()),this.index_=e.getIndex(),this.startPost_=an.getStartPost_(e),this.endPost_=an.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){const t=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,s=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return t&&s}updateChild(e,t,s,i,r,o){return this.matches(new D(t,s))||(s=T.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,s,i,r,o)}updateFullNode(e,t,s){t.isLeafNode()&&(t=T.EMPTY_NODE);let i=t.withIndex(this.index_);i=i.updatePriority(T.EMPTY_NODE);const r=this;return t.forEachChild(ne,(o,a)=>{r.matches(new D(o,a))||(i=i.updateImmediateChild(o,T.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,i,s)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){const t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}else return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){const t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}else return e.getIndex().maxPost()}}class qc{constructor(e){this.withinDirectionalStart=t=>this.reverse_?this.withinEndPost(t):this.withinStartPost(t),this.withinDirectionalEnd=t=>this.reverse_?this.withinStartPost(t):this.withinEndPost(t),this.withinStartPost=t=>{const s=this.index_.compare(this.rangedFilter_.getStartPost(),t);return this.startIsInclusive_?s<=0:s<0},this.withinEndPost=t=>{const s=this.index_.compare(t,this.rangedFilter_.getEndPost());return this.endIsInclusive_?s<=0:s<0},this.rangedFilter_=new an(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,t,s,i,r,o){return this.rangedFilter_.matches(new D(t,s))||(s=T.EMPTY_NODE),e.getImmediateChild(t).equals(s)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,s,i,r,o):this.fullLimitUpdateChild_(e,t,s,r,o)}updateFullNode(e,t,s){let i;if(t.isLeafNode()||t.isEmpty())i=T.EMPTY_NODE.withIndex(this.index_);else if(this.limit_*2<t.numChildren()&&t.isIndexed(this.index_)){i=T.EMPTY_NODE.withIndex(this.index_);let r;this.reverse_?r=t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):r=t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let o=0;for(;r.hasNext()&&o<this.limit_;){const a=r.getNext();if(this.withinDirectionalStart(a))if(this.withinDirectionalEnd(a))i=i.updateImmediateChild(a.name,a.node),o++;else break;else continue}}else{i=t.withIndex(this.index_),i=i.updatePriority(T.EMPTY_NODE);let r;this.reverse_?r=i.getReverseIterator(this.index_):r=i.getIterator(this.index_);let o=0;for(;r.hasNext();){const a=r.getNext();o<this.limit_&&this.withinDirectionalStart(a)&&this.withinDirectionalEnd(a)?o++:i=i.updateImmediateChild(a.name,T.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,i,s)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,t,s,i,r){let o;if(this.reverse_){const p=this.index_.getCompare();o=(d,g)=>p(g,d)}else o=this.index_.getCompare();const a=e;m(a.numChildren()===this.limit_,"");const c=new D(t,s),l=this.reverse_?a.getFirstChild(this.index_):a.getLastChild(this.index_),f=this.rangedFilter_.matches(c);if(a.hasChild(t)){const p=a.getImmediateChild(t);let d=i.getChildAfterChild(this.index_,l,this.reverse_);for(;d!=null&&(d.name===t||a.hasChild(d.name));)d=i.getChildAfterChild(this.index_,d,this.reverse_);const g=d==null?1:o(d,c);if(f&&!s.isEmpty()&&g>=0)return r?.trackChildChange(on(t,s,p)),a.updateImmediateChild(t,s);{r?.trackChildChange(rn(t,p));const R=a.updateImmediateChild(t,T.EMPTY_NODE);return d!=null&&this.rangedFilter_.matches(d)?(r?.trackChildChange(Rt(d.name,d.node)),R.updateImmediateChild(d.name,d.node)):R}}else return s.isEmpty()?e:f&&o(l,c)>=0?(r!=null&&(r.trackChildChange(rn(l.name,l.node)),r.trackChildChange(Rt(t,s))),a.updateImmediateChild(t,s).updateImmediateChild(l.name,T.EMPTY_NODE)):e}}class zs{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=ne}hasStart(){return this.startSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return m(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return m(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:kt}hasEnd(){return this.endSet_}getIndexEndValue(){return m(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return m(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:ht}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return m(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===ne}copy(){const e=new zs;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function Kc(n){return n.loadsAllData()?new Vs(n.getIndex()):n.hasLimit()?new qc(n):new an(n)}function ji(n){const e={};if(n.isDefault())return e;let t;if(n.index_===ne?t="$priority":n.index_===jc?t="$value":n.index_===It?t="$key":(m(n.index_ instanceof Vc,"Unrecognized index type!"),t=n.index_.toString()),e.orderBy=ce(t),n.startSet_){const s=n.startAfterSet_?"startAfter":"startAt";e[s]=ce(n.indexStartValue_),n.startNameSet_&&(e[s]+=","+ce(n.indexStartName_))}if(n.endSet_){const s=n.endBeforeSet_?"endBefore":"endAt";e[s]=ce(n.indexEndValue_),n.endNameSet_&&(e[s]+=","+ce(n.indexEndName_))}return n.limitSet_&&(n.isViewFromLeft()?e.limitToFirst=n.limit_:e.limitToLast=n.limit_),e}function Gi(n){const e={};if(n.startSet_&&(e.sp=n.indexStartValue_,n.startNameSet_&&(e.sn=n.indexStartName_),e.sin=!n.startAfterSet_),n.endSet_&&(e.ep=n.indexEndValue_,n.endNameSet_&&(e.en=n.indexEndName_),e.ein=!n.endBeforeSet_),n.limitSet_){e.l=n.limit_;let t=n.viewFrom_;t===""&&(n.isViewFromLeft()?t="l":t="r"),e.vf=t}return n.index_!==ne&&(e.i=n.index_.toString()),e}class An extends Yr{reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return t!==void 0?"tag$"+t:(m(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}constructor(e,t,s,i){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=s,this.appCheckTokenProvider_=i,this.log_=dn("p:rest:"),this.listens_={}}listen(e,t,s,i){const r=e._path.toString();this.log_("Listen called for "+r+" "+e._queryIdentifier);const o=An.getListenId_(e,s),a={};this.listens_[o]=a;const c=ji(e._queryParams);this.restRequest_(r+".json",c,(l,f)=>{let p=f;if(l===404&&(p=null,l=null),l===null&&this.onDataUpdate_(r,p,!1,s),Tt(this.listens_,o)===a){let d;l?l===401?d="permission_denied":d="rest_error:"+l:d="ok",i(d,null)}})}unlisten(e,t){const s=An.getListenId_(e,t);delete this.listens_[s]}get(e){const t=ji(e._queryParams),s=e._path.toString(),i=new We;return this.restRequest_(s+".json",t,(r,o)=>{let a=o;r===404&&(a=null,r=null),r===null?(this.onDataUpdate_(s,a,!1,null),i.resolve(a)):i.reject(new Error(a))}),i.promise}refreshAuthToken(e){}restRequest_(e,t={},s){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([i,r])=>{i&&i.accessToken&&(t.auth=i.accessToken),r&&r.token&&(t.ac=r.token);const o=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+ya(t);this.log_("Sending REST request for "+o);const a=new XMLHttpRequest;a.onreadystatechange=()=>{if(s&&a.readyState===4){this.log_("REST Response for "+o+" received. status:",a.status,"response:",a.responseText);let c=null;if(a.status>=200&&a.status<300){try{c=Zt(a.responseText)}catch{Se("Failed to parse JSON response for "+o+": "+a.responseText)}s(null,c)}else a.status!==401&&a.status!==404&&Se("Got unsuccessful REST response for "+o+" Status: "+a.status),s(a.status);s=null}},a.open("GET",o,!0),a.send()})}}class Yc{constructor(){this.rootNode_=T.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}}function xn(){return{value:null,children:new Map}}function Mt(n,e,t){if(P(e))n.value=t,n.children.clear();else if(n.value!==null)n.value=n.value.updateChild(e,t);else{const s=x(e);n.children.has(s)||n.children.set(s,xn());const i=n.children.get(s);e=K(e),Mt(i,e,t)}}function bs(n,e){if(P(e))return n.value=null,n.children.clear(),!0;if(n.value!==null){if(n.value.isLeafNode())return!1;{const t=n.value;return n.value=null,t.forEachChild(ne,(s,i)=>{Mt(n,new G(s),i)}),bs(n,e)}}else if(n.children.size>0){const t=x(e);return e=K(e),n.children.has(t)&&bs(n.children.get(t),e)&&n.children.delete(t),n.children.size===0}else return!0}function ws(n,e,t){n.value!==null?t(e,n.value):Qc(n,(s,i)=>{const r=new G(e.toString()+"/"+s);ws(i,r,t)})}function Qc(n,e){n.children.forEach((t,s)=>{e(s,t)})}class Xc{constructor(e){this.collection_=e,this.last_=null}get(){const e=this.collection_.get(),t={...e};return this.last_&&ye(this.last_,(s,i)=>{t[s]=t[s]-i}),this.last_=e,t}}const qi=10*1e3,Jc=30*1e3,Zc=300*1e3;class eh{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new Xc(e);const s=qi+(Jc-qi)*Math.random();Yt(this.reportStats_.bind(this),Math.floor(s))}reportStats_(){const e=this.statsListener_.get(),t={};let s=!1;ye(e,(i,r)=>{r>0&&Ue(this.statsToReport_,i)&&(t[i]=r,s=!0)}),s&&this.server_.reportStats(t),Yt(this.reportStats_.bind(this),Math.floor(Math.random()*2*Zc))}}var Le;(function(n){n[n.OVERWRITE=0]="OVERWRITE",n[n.MERGE=1]="MERGE",n[n.ACK_USER_WRITE=2]="ACK_USER_WRITE",n[n.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"})(Le||(Le={}));function js(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function Gs(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function qs(n){return{fromUser:!1,fromServer:!0,queryId:n,tagged:!0}}class Pn{constructor(e,t,s){this.path=e,this.affectedTree=t,this.revert=s,this.type=Le.ACK_USER_WRITE,this.source=js()}operationForChild(e){if(P(this.path)){if(this.affectedTree.value!=null)return m(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const t=this.affectedTree.subtree(new G(e));return new Pn(U(),t,this.revert)}}else return m(x(this.path)===e,"operationForChild called for unrelated child."),new Pn(K(this.path),this.affectedTree,this.revert)}}class ln{constructor(e,t){this.source=e,this.path=t,this.type=Le.LISTEN_COMPLETE}operationForChild(e){return P(this.path)?new ln(this.source,U()):new ln(this.source,K(this.path))}}class ut{constructor(e,t,s){this.source=e,this.path=t,this.snap=s,this.type=Le.OVERWRITE}operationForChild(e){return P(this.path)?new ut(this.source,U(),this.snap.getImmediateChild(e)):new ut(this.source,K(this.path),this.snap)}}class Nt{constructor(e,t,s){this.source=e,this.path=t,this.children=s,this.type=Le.MERGE}operationForChild(e){if(P(this.path)){const t=this.children.subtree(new G(e));return t.isEmpty()?null:t.value?new ut(this.source,U(),t.value):new Nt(this.source,U(),t)}else return m(x(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new Nt(this.source,K(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}class nt{constructor(e,t,s){this.node_=e,this.fullyInitialized_=t,this.filtered_=s}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(P(e))return this.isFullyInitialized()&&!this.filtered_;const t=x(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}class th{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function nh(n,e,t,s){const i=[],r=[];return e.forEach(o=>{o.type==="child_changed"&&n.index_.indexedValueChanged(o.oldSnap,o.snapshotNode)&&r.push(Gc(o.childName,o.snapshotNode))}),jt(n,i,"child_removed",e,s,t),jt(n,i,"child_added",e,s,t),jt(n,i,"child_moved",r,s,t),jt(n,i,"child_changed",e,s,t),jt(n,i,"value",e,s,t),i}function jt(n,e,t,s,i,r){const o=s.filter(a=>a.type===t);o.sort((a,c)=>ih(n,a,c)),o.forEach(a=>{const c=sh(n,a,r);i.forEach(l=>{l.respondsTo(a.type)&&e.push(l.createEvent(c,n.query_))})})}function sh(n,e,t){return e.type==="value"||e.type==="child_removed"||(e.prevName=t.getPredecessorChildName(e.childName,e.snapshotNode,n.index_)),e}function ih(n,e,t){if(e.childName==null||t.childName==null)throw Ot("Should only compare child_ events.");const s=new D(e.childName,e.snapshotNode),i=new D(t.childName,t.snapshotNode);return n.index_.compare(s,i)}function zn(n,e){return{eventCache:n,serverCache:e}}function Qt(n,e,t,s){return zn(new nt(e,t,s),n.serverCache)}function ro(n,e,t,s){return zn(n.eventCache,new nt(e,t,s))}function Dn(n){return n.eventCache.isFullyInitialized()?n.eventCache.getNode():null}function dt(n){return n.serverCache.isFullyInitialized()?n.serverCache.getNode():null}let cs;const rh=()=>(cs||(cs=new Ne(Vl)),cs);class Y{static fromObject(e){let t=new Y(null);return ye(e,(s,i)=>{t=t.set(new G(s),i)}),t}constructor(e,t=rh()){this.value=e,this.children=t}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(this.value!=null&&t(this.value))return{path:U(),value:this.value};if(P(e))return null;{const s=x(e),i=this.children.get(s);if(i!==null){const r=i.findRootMostMatchingPathAndValue(K(e),t);return r!=null?{path:te(new G(s),r.path),value:r.value}:null}else return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(P(e))return this;{const t=x(e),s=this.children.get(t);return s!==null?s.subtree(K(e)):new Y(null)}}set(e,t){if(P(e))return new Y(t,this.children);{const s=x(e),r=(this.children.get(s)||new Y(null)).set(K(e),t),o=this.children.insert(s,r);return new Y(this.value,o)}}remove(e){if(P(e))return this.children.isEmpty()?new Y(null):new Y(null,this.children);{const t=x(e),s=this.children.get(t);if(s){const i=s.remove(K(e));let r;return i.isEmpty()?r=this.children.remove(t):r=this.children.insert(t,i),this.value===null&&r.isEmpty()?new Y(null):new Y(this.value,r)}else return this}}get(e){if(P(e))return this.value;{const t=x(e),s=this.children.get(t);return s?s.get(K(e)):null}}setTree(e,t){if(P(e))return t;{const s=x(e),r=(this.children.get(s)||new Y(null)).setTree(K(e),t);let o;return r.isEmpty()?o=this.children.remove(s):o=this.children.insert(s,r),new Y(this.value,o)}}fold(e){return this.fold_(U(),e)}fold_(e,t){const s={};return this.children.inorderTraversal((i,r)=>{s[i]=r.fold_(te(e,i),t)}),t(e,this.value,s)}findOnPath(e,t){return this.findOnPath_(e,U(),t)}findOnPath_(e,t,s){const i=this.value?s(t,this.value):!1;if(i)return i;if(P(e))return null;{const r=x(e),o=this.children.get(r);return o?o.findOnPath_(K(e),te(t,r),s):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,U(),t)}foreachOnPath_(e,t,s){if(P(e))return this;{this.value&&s(t,this.value);const i=x(e),r=this.children.get(i);return r?r.foreachOnPath_(K(e),te(t,i),s):new Y(null)}}foreach(e){this.foreach_(U(),e)}foreach_(e,t){this.children.inorderTraversal((s,i)=>{i.foreach_(te(e,s),t)}),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal((t,s)=>{s.value&&e(t,s.value)})}}class Me{constructor(e){this.writeTree_=e}static empty(){return new Me(new Y(null))}}function Xt(n,e,t){if(P(e))return new Me(new Y(t));{const s=n.writeTree_.findRootMostValueAndPath(e);if(s!=null){const i=s.path;let r=s.value;const o=Te(i,e);return r=r.updateChild(o,t),new Me(n.writeTree_.set(i,r))}else{const i=new Y(t),r=n.writeTree_.setTree(e,i);return new Me(r)}}}function Is(n,e,t){let s=n;return ye(t,(i,r)=>{s=Xt(s,te(e,i),r)}),s}function Ki(n,e){if(P(e))return Me.empty();{const t=n.writeTree_.setTree(e,new Y(null));return new Me(t)}}function Ts(n,e){return pt(n,e)!=null}function pt(n,e){const t=n.writeTree_.findRootMostValueAndPath(e);return t!=null?n.writeTree_.get(t.path).getChild(Te(t.path,e)):null}function Yi(n){const e=[],t=n.writeTree_.value;return t!=null?t.isLeafNode()||t.forEachChild(ne,(s,i)=>{e.push(new D(s,i))}):n.writeTree_.children.inorderTraversal((s,i)=>{i.value!=null&&e.push(new D(s,i.value))}),e}function Ze(n,e){if(P(e))return n;{const t=pt(n,e);return t!=null?new Me(new Y(t)):new Me(n.writeTree_.subtree(e))}}function Ss(n){return n.writeTree_.isEmpty()}function At(n,e){return oo(U(),n.writeTree_,e)}function oo(n,e,t){if(e.value!=null)return t.updateChild(n,e.value);{let s=null;return e.children.inorderTraversal((i,r)=>{i===".priority"?(m(r.value!==null,"Priority writes must always be leaf nodes"),s=r.value):t=oo(te(n,i),r,t)}),!t.getChild(n).isEmpty()&&s!==null&&(t=t.updateChild(te(n,".priority"),s)),t}}function jn(n,e){return ho(e,n)}function oh(n,e,t,s,i){m(s>n.lastWriteId,"Stacking an older write on top of newer ones"),i===void 0&&(i=!0),n.allWrites.push({path:e,snap:t,writeId:s,visible:i}),i&&(n.visibleWrites=Xt(n.visibleWrites,e,t)),n.lastWriteId=s}function ah(n,e,t,s){m(s>n.lastWriteId,"Stacking an older merge on top of newer ones"),n.allWrites.push({path:e,children:t,writeId:s,visible:!0}),n.visibleWrites=Is(n.visibleWrites,e,t),n.lastWriteId=s}function lh(n,e){for(let t=0;t<n.allWrites.length;t++){const s=n.allWrites[t];if(s.writeId===e)return s}return null}function ch(n,e){const t=n.allWrites.findIndex(a=>a.writeId===e);m(t>=0,"removeWrite called with nonexistent writeId.");const s=n.allWrites[t];n.allWrites.splice(t,1);let i=s.visible,r=!1,o=n.allWrites.length-1;for(;i&&o>=0;){const a=n.allWrites[o];a.visible&&(o>=t&&hh(a,s.path)?i=!1:Pe(s.path,a.path)&&(r=!0)),o--}if(i){if(r)return uh(n),!0;if(s.snap)n.visibleWrites=Ki(n.visibleWrites,s.path);else{const a=s.children;ye(a,c=>{n.visibleWrites=Ki(n.visibleWrites,te(s.path,c))})}return!0}else return!1}function hh(n,e){if(n.snap)return Pe(n.path,e);for(const t in n.children)if(n.children.hasOwnProperty(t)&&Pe(te(n.path,t),e))return!0;return!1}function uh(n){n.visibleWrites=ao(n.allWrites,dh,U()),n.allWrites.length>0?n.lastWriteId=n.allWrites[n.allWrites.length-1].writeId:n.lastWriteId=-1}function dh(n){return n.visible}function ao(n,e,t){let s=Me.empty();for(let i=0;i<n.length;++i){const r=n[i];if(e(r)){const o=r.path;let a;if(r.snap)Pe(t,o)?(a=Te(t,o),s=Xt(s,a,r.snap)):Pe(o,t)&&(a=Te(o,t),s=Xt(s,U(),r.snap.getChild(a)));else if(r.children){if(Pe(t,o))a=Te(t,o),s=Is(s,a,r.children);else if(Pe(o,t))if(a=Te(o,t),P(a))s=Is(s,U(),r.children);else{const c=Tt(r.children,x(a));if(c){const l=c.getChild(K(a));s=Xt(s,U(),l)}}}else throw Ot("WriteRecord should have .snap or .children")}}return s}function lo(n,e,t,s,i){if(!s&&!i){const r=pt(n.visibleWrites,e);if(r!=null)return r;{const o=Ze(n.visibleWrites,e);if(Ss(o))return t;if(t==null&&!Ts(o,U()))return null;{const a=t||T.EMPTY_NODE;return At(o,a)}}}else{const r=Ze(n.visibleWrites,e);if(!i&&Ss(r))return t;if(!i&&t==null&&!Ts(r,U()))return null;{const o=function(l){return(l.visible||i)&&(!s||!~s.indexOf(l.writeId))&&(Pe(l.path,e)||Pe(e,l.path))},a=ao(n.allWrites,o,e),c=t||T.EMPTY_NODE;return At(a,c)}}}function fh(n,e,t){let s=T.EMPTY_NODE;const i=pt(n.visibleWrites,e);if(i)return i.isLeafNode()||i.forEachChild(ne,(r,o)=>{s=s.updateImmediateChild(r,o)}),s;if(t){const r=Ze(n.visibleWrites,e);return t.forEachChild(ne,(o,a)=>{const c=At(Ze(r,new G(o)),a);s=s.updateImmediateChild(o,c)}),Yi(r).forEach(o=>{s=s.updateImmediateChild(o.name,o.node)}),s}else{const r=Ze(n.visibleWrites,e);return Yi(r).forEach(o=>{s=s.updateImmediateChild(o.name,o.node)}),s}}function ph(n,e,t,s,i){m(s||i,"Either existingEventSnap or existingServerSnap must exist");const r=te(e,t);if(Ts(n.visibleWrites,r))return null;{const o=Ze(n.visibleWrites,r);return Ss(o)?i.getChild(t):At(o,i.getChild(t))}}function _h(n,e,t,s){const i=te(e,t),r=pt(n.visibleWrites,i);if(r!=null)return r;if(s.isCompleteForChild(t)){const o=Ze(n.visibleWrites,i);return At(o,s.getNode().getImmediateChild(t))}else return null}function mh(n,e){return pt(n.visibleWrites,e)}function gh(n,e,t,s,i,r,o){let a;const c=Ze(n.visibleWrites,e),l=pt(c,U());if(l!=null)a=l;else if(t!=null)a=At(c,t);else return[];if(a=a.withIndex(o),!a.isEmpty()&&!a.isLeafNode()){const f=[],p=o.getCompare(),d=r?a.getReverseIteratorFrom(s,o):a.getIteratorFrom(s,o);let g=d.getNext();for(;g&&f.length<i;)p(g,s)!==0&&f.push(g),g=d.getNext();return f}else return[]}function yh(){return{visibleWrites:Me.empty(),allWrites:[],lastWriteId:-1}}function On(n,e,t,s){return lo(n.writeTree,n.treePath,e,t,s)}function Ks(n,e){return fh(n.writeTree,n.treePath,e)}function Qi(n,e,t,s){return ph(n.writeTree,n.treePath,e,t,s)}function Ln(n,e){return mh(n.writeTree,te(n.treePath,e))}function vh(n,e,t,s,i,r){return gh(n.writeTree,n.treePath,e,t,s,i,r)}function Ys(n,e,t){return _h(n.writeTree,n.treePath,e,t)}function co(n,e){return ho(te(n.treePath,e),n.writeTree)}function ho(n,e){return{treePath:n,writeTree:e}}class Eh{constructor(){this.changeMap=new Map}trackChildChange(e){const t=e.type,s=e.childName;m(t==="child_added"||t==="child_changed"||t==="child_removed","Only child changes supported for tracking"),m(s!==".priority","Only non-priority child changes can be tracked.");const i=this.changeMap.get(s);if(i){const r=i.type;if(t==="child_added"&&r==="child_removed")this.changeMap.set(s,on(s,e.snapshotNode,i.snapshotNode));else if(t==="child_removed"&&r==="child_added")this.changeMap.delete(s);else if(t==="child_removed"&&r==="child_changed")this.changeMap.set(s,rn(s,i.oldSnap));else if(t==="child_changed"&&r==="child_added")this.changeMap.set(s,Rt(s,e.snapshotNode));else if(t==="child_changed"&&r==="child_changed")this.changeMap.set(s,on(s,e.snapshotNode,i.oldSnap));else throw Ot("Illegal combination of changes: "+e+" occurred after "+i)}else this.changeMap.set(s,e)}getChanges(){return Array.from(this.changeMap.values())}}class Ch{getCompleteChild(e){return null}getChildAfterChild(e,t,s){return null}}const uo=new Ch;class Qs{constructor(e,t,s=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=s}getCompleteChild(e){const t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{const s=this.optCompleteServerCache_!=null?new nt(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return Ys(this.writes_,e,s)}}getChildAfterChild(e,t,s){const i=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:dt(this.viewCache_),r=vh(this.writes_,i,t,1,s,e);return r.length===0?null:r[0]}}function bh(n){return{filter:n}}function wh(n,e){m(e.eventCache.getNode().isIndexed(n.filter.getIndex()),"Event snap not indexed"),m(e.serverCache.getNode().isIndexed(n.filter.getIndex()),"Server snap not indexed")}function Ih(n,e,t,s,i){const r=new Eh;let o,a;if(t.type===Le.OVERWRITE){const l=t;l.source.fromUser?o=ks(n,e,l.path,l.snap,s,i,r):(m(l.source.fromServer,"Unknown source."),a=l.source.tagged||e.serverCache.isFiltered()&&!P(l.path),o=Mn(n,e,l.path,l.snap,s,i,a,r))}else if(t.type===Le.MERGE){const l=t;l.source.fromUser?o=Sh(n,e,l.path,l.children,s,i,r):(m(l.source.fromServer,"Unknown source."),a=l.source.tagged||e.serverCache.isFiltered(),o=Rs(n,e,l.path,l.children,s,i,a,r))}else if(t.type===Le.ACK_USER_WRITE){const l=t;l.revert?o=Nh(n,e,l.path,s,i,r):o=kh(n,e,l.path,l.affectedTree,s,i,r)}else if(t.type===Le.LISTEN_COMPLETE)o=Rh(n,e,t.path,s,r);else throw Ot("Unknown operation type: "+t.type);const c=r.getChanges();return Th(e,o,c),{viewCache:o,changes:c}}function Th(n,e,t){const s=e.eventCache;if(s.isFullyInitialized()){const i=s.getNode().isLeafNode()||s.getNode().isEmpty(),r=Dn(n);(t.length>0||!n.eventCache.isFullyInitialized()||i&&!s.getNode().equals(r)||!s.getNode().getPriority().equals(r.getPriority()))&&t.push(io(Dn(e)))}}function fo(n,e,t,s,i,r){const o=e.eventCache;if(Ln(s,t)!=null)return e;{let a,c;if(P(t))if(m(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){const l=dt(e),f=l instanceof T?l:T.EMPTY_NODE,p=Ks(s,f);a=n.filter.updateFullNode(e.eventCache.getNode(),p,r)}else{const l=On(s,dt(e));a=n.filter.updateFullNode(e.eventCache.getNode(),l,r)}else{const l=x(t);if(l===".priority"){m(tt(t)===1,"Can't have a priority with additional path components");const f=o.getNode();c=e.serverCache.getNode();const p=Qi(s,t,f,c);p!=null?a=n.filter.updatePriority(f,p):a=o.getNode()}else{const f=K(t);let p;if(o.isCompleteForChild(l)){c=e.serverCache.getNode();const d=Qi(s,t,o.getNode(),c);d!=null?p=o.getNode().getImmediateChild(l).updateChild(f,d):p=o.getNode().getImmediateChild(l)}else p=Ys(s,l,e.serverCache);p!=null?a=n.filter.updateChild(o.getNode(),l,p,f,i,r):a=o.getNode()}}return Qt(e,a,o.isFullyInitialized()||P(t),n.filter.filtersNodes())}}function Mn(n,e,t,s,i,r,o,a){const c=e.serverCache;let l;const f=o?n.filter:n.filter.getIndexedFilter();if(P(t))l=f.updateFullNode(c.getNode(),s,null);else if(f.filtersNodes()&&!c.isFiltered()){const g=c.getNode().updateChild(t,s);l=f.updateFullNode(c.getNode(),g,null)}else{const g=x(t);if(!c.isCompleteForPath(t)&&tt(t)>1)return e;const b=K(t),V=c.getNode().getImmediateChild(g).updateChild(b,s);g===".priority"?l=f.updatePriority(c.getNode(),V):l=f.updateChild(c.getNode(),g,V,b,uo,null)}const p=ro(e,l,c.isFullyInitialized()||P(t),f.filtersNodes()),d=new Qs(i,p,r);return fo(n,p,t,i,d,a)}function ks(n,e,t,s,i,r,o){const a=e.eventCache;let c,l;const f=new Qs(i,e,r);if(P(t))l=n.filter.updateFullNode(e.eventCache.getNode(),s,o),c=Qt(e,l,!0,n.filter.filtersNodes());else{const p=x(t);if(p===".priority")l=n.filter.updatePriority(e.eventCache.getNode(),s),c=Qt(e,l,a.isFullyInitialized(),a.isFiltered());else{const d=K(t),g=a.getNode().getImmediateChild(p);let b;if(P(d))b=s;else{const R=f.getCompleteChild(p);R!=null?$s(d)===".priority"&&R.getChild(Xr(d)).isEmpty()?b=R:b=R.updateChild(d,s):b=T.EMPTY_NODE}if(g.equals(b))c=e;else{const R=n.filter.updateChild(a.getNode(),p,b,d,f,o);c=Qt(e,R,a.isFullyInitialized(),n.filter.filtersNodes())}}}return c}function Xi(n,e){return n.eventCache.isCompleteForChild(e)}function Sh(n,e,t,s,i,r,o){let a=e;return s.foreach((c,l)=>{const f=te(t,c);Xi(e,x(f))&&(a=ks(n,a,f,l,i,r,o))}),s.foreach((c,l)=>{const f=te(t,c);Xi(e,x(f))||(a=ks(n,a,f,l,i,r,o))}),a}function Ji(n,e,t){return t.foreach((s,i)=>{e=e.updateChild(s,i)}),e}function Rs(n,e,t,s,i,r,o,a){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let c=e,l;P(t)?l=s:l=new Y(null).setTree(t,s);const f=e.serverCache.getNode();return l.children.inorderTraversal((p,d)=>{if(f.hasChild(p)){const g=e.serverCache.getNode().getImmediateChild(p),b=Ji(n,g,d);c=Mn(n,c,new G(p),b,i,r,o,a)}}),l.children.inorderTraversal((p,d)=>{const g=!e.serverCache.isCompleteForChild(p)&&d.value===null;if(!f.hasChild(p)&&!g){const b=e.serverCache.getNode().getImmediateChild(p),R=Ji(n,b,d);c=Mn(n,c,new G(p),R,i,r,o,a)}}),c}function kh(n,e,t,s,i,r,o){if(Ln(i,t)!=null)return e;const a=e.serverCache.isFiltered(),c=e.serverCache;if(s.value!=null){if(P(t)&&c.isFullyInitialized()||c.isCompleteForPath(t))return Mn(n,e,t,c.getNode().getChild(t),i,r,a,o);if(P(t)){let l=new Y(null);return c.getNode().forEachChild(It,(f,p)=>{l=l.set(new G(f),p)}),Rs(n,e,t,l,i,r,a,o)}else return e}else{let l=new Y(null);return s.foreach((f,p)=>{const d=te(t,f);c.isCompleteForPath(d)&&(l=l.set(f,c.getNode().getChild(d)))}),Rs(n,e,t,l,i,r,a,o)}}function Rh(n,e,t,s,i){const r=e.serverCache,o=ro(e,r.getNode(),r.isFullyInitialized()||P(t),r.isFiltered());return fo(n,o,t,s,uo,i)}function Nh(n,e,t,s,i,r){let o;if(Ln(s,t)!=null)return e;{const a=new Qs(s,e,i),c=e.eventCache.getNode();let l;if(P(t)||x(t)===".priority"){let f;if(e.serverCache.isFullyInitialized())f=On(s,dt(e));else{const p=e.serverCache.getNode();m(p instanceof T,"serverChildren would be complete if leaf node"),f=Ks(s,p)}f=f,l=n.filter.updateFullNode(c,f,r)}else{const f=x(t);let p=Ys(s,f,e.serverCache);p==null&&e.serverCache.isCompleteForChild(f)&&(p=c.getImmediateChild(f)),p!=null?l=n.filter.updateChild(c,f,p,K(t),a,r):e.eventCache.getNode().hasChild(f)?l=n.filter.updateChild(c,f,T.EMPTY_NODE,K(t),a,r):l=c,l.isEmpty()&&e.serverCache.isFullyInitialized()&&(o=On(s,dt(e)),o.isLeafNode()&&(l=n.filter.updateFullNode(l,o,r)))}return o=e.serverCache.isFullyInitialized()||Ln(s,U())!=null,Qt(e,l,o,n.filter.filtersNodes())}}class Ah{constructor(e,t){this.query_=e,this.eventRegistrations_=[];const s=this.query_._queryParams,i=new Vs(s.getIndex()),r=Kc(s);this.processor_=bh(r);const o=t.serverCache,a=t.eventCache,c=i.updateFullNode(T.EMPTY_NODE,o.getNode(),null),l=r.updateFullNode(T.EMPTY_NODE,a.getNode(),null),f=new nt(c,o.isFullyInitialized(),i.filtersNodes()),p=new nt(l,a.isFullyInitialized(),r.filtersNodes());this.viewCache_=zn(p,f),this.eventGenerator_=new th(this.query_)}get query(){return this.query_}}function xh(n){return n.viewCache_.serverCache.getNode()}function Ph(n){return Dn(n.viewCache_)}function Dh(n,e){const t=dt(n.viewCache_);return t&&(n.query._queryParams.loadsAllData()||!P(e)&&!t.getImmediateChild(x(e)).isEmpty())?t.getChild(e):null}function Zi(n){return n.eventRegistrations_.length===0}function Oh(n,e){n.eventRegistrations_.push(e)}function er(n,e,t){const s=[];if(t){m(e==null,"A cancel should cancel all event registrations.");const i=n.query._path;n.eventRegistrations_.forEach(r=>{const o=r.createCancelEvent(t,i);o&&s.push(o)})}if(e){let i=[];for(let r=0;r<n.eventRegistrations_.length;++r){const o=n.eventRegistrations_[r];if(!o.matches(e))i.push(o);else if(e.hasAnyCallback()){i=i.concat(n.eventRegistrations_.slice(r+1));break}}n.eventRegistrations_=i}else n.eventRegistrations_=[];return s}function tr(n,e,t,s){e.type===Le.MERGE&&e.source.queryId!==null&&(m(dt(n.viewCache_),"We should always have a full cache before handling merges"),m(Dn(n.viewCache_),"Missing event cache, even though we have a server cache"));const i=n.viewCache_,r=Ih(n.processor_,i,e,t,s);return wh(n.processor_,r.viewCache),m(r.viewCache.serverCache.isFullyInitialized()||!i.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),n.viewCache_=r.viewCache,po(n,r.changes,r.viewCache.eventCache.getNode(),null)}function Lh(n,e){const t=n.viewCache_.eventCache,s=[];return t.getNode().isLeafNode()||t.getNode().forEachChild(ne,(r,o)=>{s.push(Rt(r,o))}),t.isFullyInitialized()&&s.push(io(t.getNode())),po(n,s,t.getNode(),e)}function po(n,e,t,s){const i=s?[s]:n.eventRegistrations_;return nh(n.eventGenerator_,e,t,i)}let Fn;class _o{constructor(){this.views=new Map}}function Mh(n){m(!Fn,"__referenceConstructor has already been defined"),Fn=n}function Fh(){return m(Fn,"Reference.ts has not been loaded"),Fn}function Bh(n){return n.views.size===0}function Xs(n,e,t,s){const i=e.source.queryId;if(i!==null){const r=n.views.get(i);return m(r!=null,"SyncTree gave us an op for an invalid query."),tr(r,e,t,s)}else{let r=[];for(const o of n.views.values())r=r.concat(tr(o,e,t,s));return r}}function mo(n,e,t,s,i){const r=e._queryIdentifier,o=n.views.get(r);if(!o){let a=On(t,i?s:null),c=!1;a?c=!0:s instanceof T?(a=Ks(t,s),c=!1):(a=T.EMPTY_NODE,c=!1);const l=zn(new nt(a,c,!1),new nt(s,i,!1));return new Ah(e,l)}return o}function $h(n,e,t,s,i,r){const o=mo(n,e,s,i,r);return n.views.has(e._queryIdentifier)||n.views.set(e._queryIdentifier,o),Oh(o,t),Lh(o,t)}function Wh(n,e,t,s){const i=e._queryIdentifier,r=[];let o=[];const a=st(n);if(i==="default")for(const[c,l]of n.views.entries())o=o.concat(er(l,t,s)),Zi(l)&&(n.views.delete(c),l.query._queryParams.loadsAllData()||r.push(l.query));else{const c=n.views.get(i);c&&(o=o.concat(er(c,t,s)),Zi(c)&&(n.views.delete(i),c.query._queryParams.loadsAllData()||r.push(c.query)))}return a&&!st(n)&&r.push(new(Fh())(e._repo,e._path)),{removed:r,events:o}}function go(n){const e=[];for(const t of n.views.values())t.query._queryParams.loadsAllData()||e.push(t);return e}function et(n,e){let t=null;for(const s of n.views.values())t=t||Dh(s,e);return t}function yo(n,e){if(e._queryParams.loadsAllData())return Gn(n);{const s=e._queryIdentifier;return n.views.get(s)}}function vo(n,e){return yo(n,e)!=null}function st(n){return Gn(n)!=null}function Gn(n){for(const e of n.views.values())if(e.query._queryParams.loadsAllData())return e;return null}let Bn;function Uh(n){m(!Bn,"__referenceConstructor has already been defined"),Bn=n}function Hh(){return m(Bn,"Reference.ts has not been loaded"),Bn}let Vh=1;class nr{constructor(e){this.listenProvider_=e,this.syncPointTree_=new Y(null),this.pendingWriteTree_=yh(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function Eo(n,e,t,s,i){return oh(n.pendingWriteTree_,e,t,s,i),i?Ft(n,new ut(js(),e,t)):[]}function zh(n,e,t,s){ah(n.pendingWriteTree_,e,t,s);const i=Y.fromObject(t);return Ft(n,new Nt(js(),e,i))}function Qe(n,e,t=!1){const s=lh(n.pendingWriteTree_,e);if(ch(n.pendingWriteTree_,e)){let r=new Y(null);return s.snap!=null?r=r.set(U(),!0):ye(s.children,o=>{r=r.set(new G(o),!0)}),Ft(n,new Pn(s.path,r,t))}else return[]}function pn(n,e,t){return Ft(n,new ut(Gs(),e,t))}function jh(n,e,t){const s=Y.fromObject(t);return Ft(n,new Nt(Gs(),e,s))}function Gh(n,e){return Ft(n,new ln(Gs(),e))}function qh(n,e,t){const s=Zs(n,t);if(s){const i=ei(s),r=i.path,o=i.queryId,a=Te(r,e),c=new ln(qs(o),a);return ti(n,r,c)}else return[]}function $n(n,e,t,s,i=!1){const r=e._path,o=n.syncPointTree_.get(r);let a=[];if(o&&(e._queryIdentifier==="default"||vo(o,e))){const c=Wh(o,e,t,s);Bh(o)&&(n.syncPointTree_=n.syncPointTree_.remove(r));const l=c.removed;if(a=c.events,!i){const f=l.findIndex(d=>d._queryParams.loadsAllData())!==-1,p=n.syncPointTree_.findOnPath(r,(d,g)=>st(g));if(f&&!p){const d=n.syncPointTree_.subtree(r);if(!d.isEmpty()){const g=Qh(d);for(let b=0;b<g.length;++b){const R=g[b],V=R.query,he=Io(n,R);n.listenProvider_.startListening(Jt(V),cn(n,V),he.hashFn,he.onComplete)}}}!p&&l.length>0&&!s&&(f?n.listenProvider_.stopListening(Jt(e),null):l.forEach(d=>{const g=n.queryToTagMap.get(qn(d));n.listenProvider_.stopListening(Jt(d),g)}))}Xh(n,l)}return a}function Co(n,e,t,s){const i=Zs(n,s);if(i!=null){const r=ei(i),o=r.path,a=r.queryId,c=Te(o,e),l=new ut(qs(a),c,t);return ti(n,o,l)}else return[]}function Kh(n,e,t,s){const i=Zs(n,s);if(i){const r=ei(i),o=r.path,a=r.queryId,c=Te(o,e),l=Y.fromObject(t),f=new Nt(qs(a),c,l);return ti(n,o,f)}else return[]}function Ns(n,e,t,s=!1){const i=e._path;let r=null,o=!1;n.syncPointTree_.foreachOnPath(i,(d,g)=>{const b=Te(d,i);r=r||et(g,b),o=o||st(g)});let a=n.syncPointTree_.get(i);a?(o=o||st(a),r=r||et(a,U())):(a=new _o,n.syncPointTree_=n.syncPointTree_.set(i,a));let c;r!=null?c=!0:(c=!1,r=T.EMPTY_NODE,n.syncPointTree_.subtree(i).foreachChild((g,b)=>{const R=et(b,U());R&&(r=r.updateImmediateChild(g,R))}));const l=vo(a,e);if(!l&&!e._queryParams.loadsAllData()){const d=qn(e);m(!n.queryToTagMap.has(d),"View does not exist, but we have a tag");const g=Jh();n.queryToTagMap.set(d,g),n.tagToQueryMap.set(g,d)}const f=jn(n.pendingWriteTree_,i);let p=$h(a,e,t,f,r,c);if(!l&&!o&&!s){const d=yo(a,e);p=p.concat(Zh(n,e,d))}return p}function Js(n,e,t){const i=n.pendingWriteTree_,r=n.syncPointTree_.findOnPath(e,(o,a)=>{const c=Te(o,e),l=et(a,c);if(l)return l});return lo(i,e,r,t,!0)}function Yh(n,e){const t=e._path;let s=null;n.syncPointTree_.foreachOnPath(t,(l,f)=>{const p=Te(l,t);s=s||et(f,p)});let i=n.syncPointTree_.get(t);i?s=s||et(i,U()):(i=new _o,n.syncPointTree_=n.syncPointTree_.set(t,i));const r=s!=null,o=r?new nt(s,!0,!1):null,a=jn(n.pendingWriteTree_,e._path),c=mo(i,e,a,r?o.getNode():T.EMPTY_NODE,r);return Ph(c)}function Ft(n,e){return bo(e,n.syncPointTree_,null,jn(n.pendingWriteTree_,U()))}function bo(n,e,t,s){if(P(n.path))return wo(n,e,t,s);{const i=e.get(U());t==null&&i!=null&&(t=et(i,U()));let r=[];const o=x(n.path),a=n.operationForChild(o),c=e.children.get(o);if(c&&a){const l=t?t.getImmediateChild(o):null,f=co(s,o);r=r.concat(bo(a,c,l,f))}return i&&(r=r.concat(Xs(i,n,s,t))),r}}function wo(n,e,t,s){const i=e.get(U());t==null&&i!=null&&(t=et(i,U()));let r=[];return e.children.inorderTraversal((o,a)=>{const c=t?t.getImmediateChild(o):null,l=co(s,o),f=n.operationForChild(o);f&&(r=r.concat(wo(f,a,c,l)))}),i&&(r=r.concat(Xs(i,n,s,t))),r}function Io(n,e){const t=e.query,s=cn(n,t);return{hashFn:()=>(xh(e)||T.EMPTY_NODE).hash(),onComplete:i=>{if(i==="ok")return s?qh(n,t._path,s):Gh(n,t._path);{const r=Gl(i,t);return $n(n,t,null,r)}}}}function cn(n,e){const t=qn(e);return n.queryToTagMap.get(t)}function qn(n){return n._path.toString()+"$"+n._queryIdentifier}function Zs(n,e){return n.tagToQueryMap.get(e)}function ei(n){const e=n.indexOf("$");return m(e!==-1&&e<n.length-1,"Bad queryKey."),{queryId:n.substr(e+1),path:new G(n.substr(0,e))}}function ti(n,e,t){const s=n.syncPointTree_.get(e);m(s,"Missing sync point for query tag that we're tracking");const i=jn(n.pendingWriteTree_,e);return Xs(s,t,i,null)}function Qh(n){return n.fold((e,t,s)=>{if(t&&st(t))return[Gn(t)];{let i=[];return t&&(i=go(t)),ye(s,(r,o)=>{i=i.concat(o)}),i}})}function Jt(n){return n._queryParams.loadsAllData()&&!n._queryParams.isDefault()?new(Hh())(n._repo,n._path):n}function Xh(n,e){for(let t=0;t<e.length;++t){const s=e[t];if(!s._queryParams.loadsAllData()){const i=qn(s),r=n.queryToTagMap.get(i);n.queryToTagMap.delete(i),n.tagToQueryMap.delete(r)}}}function Jh(){return Vh++}function Zh(n,e,t){const s=e._path,i=cn(n,e),r=Io(n,t),o=n.listenProvider_.startListening(Jt(e),i,r.hashFn,r.onComplete),a=n.syncPointTree_.subtree(s);if(i)m(!st(a.value),"If we're adding a query, it shouldn't be shadowed");else{const c=a.fold((l,f,p)=>{if(!P(l)&&f&&st(f))return[Gn(f).query];{let d=[];return f&&(d=d.concat(go(f).map(g=>g.query))),ye(p,(g,b)=>{d=d.concat(b)}),d}});for(let l=0;l<c.length;++l){const f=c[l];n.listenProvider_.stopListening(Jt(f),cn(n,f))}}return o}class ni{constructor(e){this.node_=e}getImmediateChild(e){const t=this.node_.getImmediateChild(e);return new ni(t)}node(){return this.node_}}class si{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){const t=te(this.path_,e);return new si(this.syncTree_,t)}node(){return Js(this.syncTree_,this.path_)}}const eu=function(n){return n=n||{},n.timestamp=n.timestamp||new Date().getTime(),n},sr=function(n,e,t){if(!n||typeof n!="object")return n;if(m(".sv"in n,"Unexpected leaf node or priority contents"),typeof n[".sv"]=="string")return tu(n[".sv"],e,t);if(typeof n[".sv"]=="object")return nu(n[".sv"],e);m(!1,"Unexpected server value: "+JSON.stringify(n,null,2))},tu=function(n,e,t){if(n==="timestamp")return t.timestamp;m(!1,"Unexpected server value: "+n)},nu=function(n,e,t){n.hasOwnProperty("increment")||m(!1,"Unexpected server value: "+JSON.stringify(n,null,2));const s=n.increment;typeof s!="number"&&m(!1,"Unexpected increment value: "+s);const i=e.node();if(m(i!==null&&typeof i<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!i.isLeafNode())return s;const o=i.getValue();return typeof o!="number"?s:o+s},To=function(n,e,t,s){return ii(e,new si(t,n),s)},So=function(n,e,t){return ii(n,new ni(e),t)};function ii(n,e,t){const s=n.getPriority().val(),i=sr(s,e.getImmediateChild(".priority"),t);let r;if(n.isLeafNode()){const o=n,a=sr(o.getValue(),e,t);return a!==o.getValue()||i!==o.getPriority().val()?new _e(a,ie(i)):n}else{const o=n;return r=o,i!==o.getPriority().val()&&(r=r.updatePriority(new _e(i))),o.forEachChild(ne,(a,c)=>{const l=ii(c,e.getImmediateChild(a),t);l!==c&&(r=r.updateImmediateChild(a,l))}),r}}class ri{constructor(e="",t=null,s={children:{},childCount:0}){this.name=e,this.parent=t,this.node=s}}function oi(n,e){let t=e instanceof G?e:new G(e),s=n,i=x(t);for(;i!==null;){const r=Tt(s.node.children,i)||{children:{},childCount:0};s=new ri(i,s,r),t=K(t),i=x(t)}return s}function Bt(n){return n.node.value}function ko(n,e){n.node.value=e,As(n)}function Ro(n){return n.node.childCount>0}function su(n){return Bt(n)===void 0&&!Ro(n)}function Kn(n,e){ye(n.node.children,(t,s)=>{e(new ri(t,n,s))})}function No(n,e,t,s){t&&e(n),Kn(n,i=>{No(i,e,!0)})}function iu(n,e,t){let s=n.parent;for(;s!==null;){if(e(s))return!0;s=s.parent}return!1}function _n(n){return new G(n.parent===null?n.name:_n(n.parent)+"/"+n.name)}function As(n){n.parent!==null&&ru(n.parent,n.name,n)}function ru(n,e,t){const s=su(t),i=Ue(n.node.children,e);s&&i?(delete n.node.children[e],n.node.childCount--,As(n)):!s&&!i&&(n.node.children[e]=t.node,n.node.childCount++,As(n))}const ou=/[\[\].#$\/\u0000-\u001F\u007F]/,au=/[\[\].#$\u0000-\u001F\u007F]/,hs=10*1024*1024,ai=function(n){return typeof n=="string"&&n.length!==0&&!ou.test(n)},Ao=function(n){return typeof n=="string"&&n.length!==0&&!au.test(n)},lu=function(n){return n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),Ao(n)},xo=function(n){return n===null||typeof n=="string"||typeof n=="number"&&!Hn(n)||n&&typeof n=="object"&&Ue(n,".sv")},Wn=function(n,e,t,s){s&&e===void 0||Yn(St(n,"value"),e,t)},Yn=function(n,e,t){const s=t instanceof G?new Sc(t,n):t;if(e===void 0)throw new Error(n+"contains undefined "+at(s));if(typeof e=="function")throw new Error(n+"contains a function "+at(s)+" with contents = "+e.toString());if(Hn(e))throw new Error(n+"contains "+e.toString()+" "+at(s));if(typeof e=="string"&&e.length>hs/3&&Un(e)>hs)throw new Error(n+"contains a string greater than "+hs+" utf8 bytes "+at(s)+" ('"+e.substring(0,50)+"...')");if(e&&typeof e=="object"){let i=!1,r=!1;if(ye(e,(o,a)=>{if(o===".value")i=!0;else if(o!==".priority"&&o!==".sv"&&(r=!0,!ai(o)))throw new Error(n+" contains an invalid key ("+o+") "+at(s)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);kc(s,o),Yn(n,a,s),Rc(s)}),i&&r)throw new Error(n+' contains ".value" child '+at(s)+" in addition to actual children.")}},cu=function(n,e){let t,s;for(t=0;t<e.length;t++){s=e[t];const r=sn(s);for(let o=0;o<r.length;o++)if(!(r[o]===".priority"&&o===r.length-1)){if(!ai(r[o]))throw new Error(n+"contains an invalid key ("+r[o]+") in path "+s.toString()+`. Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`)}}e.sort(Tc);let i=null;for(t=0;t<e.length;t++){if(s=e[t],i!==null&&Pe(i,s))throw new Error(n+"contains a path "+i.toString()+" that is ancestor of another path "+s.toString());i=s}},Po=function(n,e,t,s){const i=St(n,"values");if(!(e&&typeof e=="object")||Array.isArray(e))throw new Error(i+" must be an object containing the children to replace.");const r=[];ye(e,(o,a)=>{const c=new G(o);if(Yn(i,a,te(t,c)),$s(c)===".priority"&&!xo(a))throw new Error(i+"contains an invalid value for '"+c.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");r.push(c)}),cu(i,r)},hu=function(n,e,t){if(Hn(e))throw new Error(St(n,"priority")+"is "+e.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!xo(e))throw new Error(St(n,"priority")+"must be a valid Firebase priority (a string, finite number, server value, or null).")},Do=function(n,e,t,s){if(!Ao(t))throw new Error(St(n,e)+'was an invalid path = "'+t+`". Paths must be non-empty strings and can't contain ".", "#", "$", "[", or "]"`)},uu=function(n,e,t,s){t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),Do(n,e,t)},Ct=function(n,e){if(x(e)===".info")throw new Error(n+" failed = Can't modify data under /.info/")},du=function(n,e){const t=e.path.toString();if(typeof e.repoInfo.host!="string"||e.repoInfo.host.length===0||!ai(e.repoInfo.namespace)&&e.repoInfo.host.split(":")[0]!=="localhost"||t.length!==0&&!lu(t))throw new Error(St(n,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};class fu{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function Qn(n,e){let t=null;for(let s=0;s<e.length;s++){const i=e[s],r=i.getPath();t!==null&&!Ws(r,t.path)&&(n.eventLists_.push(t),t=null),t===null&&(t={events:[],path:r}),t.events.push(i)}t&&n.eventLists_.push(t)}function Oo(n,e,t){Qn(n,t),Lo(n,s=>Ws(s,e))}function De(n,e,t){Qn(n,t),Lo(n,s=>Pe(s,e)||Pe(e,s))}function Lo(n,e){n.recursionDepth_++;let t=!0;for(let s=0;s<n.eventLists_.length;s++){const i=n.eventLists_[s];if(i){const r=i.path;e(r)?(pu(n.eventLists_[s]),n.eventLists_[s]=null):t=!1}}t&&(n.eventLists_=[]),n.recursionDepth_--}function pu(n){for(let e=0;e<n.events.length;e++){const t=n.events[e];if(t!==null){n.events[e]=null;const s=t.getEventRunner();Kt&&ge("event: "+t.toString()),Lt(s)}}}const _u="repo_interrupt",mu=25;class gu{constructor(e,t,s,i){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=s,this.appCheckProvider_=i,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new fu,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=xn(),this.transactionQueueTree_=new ri,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function yu(n,e,t){if(n.stats_=Fs(n.repoInfo_),n.forceRestClient_||Ql())n.server_=new An(n.repoInfo_,(s,i,r,o)=>{ir(n,s,i,r,o)},n.authTokenProvider_,n.appCheckProvider_),setTimeout(()=>rr(n,!0),0);else{if(typeof t<"u"&&t!==null){if(typeof t!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{ce(t)}catch(s){throw new Error("Invalid authOverride provided: "+s)}}n.persistentConnection_=new Ge(n.repoInfo_,e,(s,i,r,o)=>{ir(n,s,i,r,o)},s=>{rr(n,s)},s=>{vu(n,s)},n.authTokenProvider_,n.appCheckProvider_,t),n.server_=n.persistentConnection_}n.authTokenProvider_.addTokenChangeListener(s=>{n.server_.refreshAuthToken(s)}),n.appCheckProvider_.addTokenChangeListener(s=>{n.server_.refreshAppCheckToken(s.token)}),n.statsReporter_=tc(n.repoInfo_,()=>new eh(n.stats_,n.server_)),n.infoData_=new Yc,n.infoSyncTree_=new nr({startListening:(s,i,r,o)=>{let a=[];const c=n.infoData_.getNode(s._path);return c.isEmpty()||(a=pn(n.infoSyncTree_,s._path,c),setTimeout(()=>{o("ok")},0)),a},stopListening:()=>{}}),li(n,"connected",!1),n.serverSyncTree_=new nr({startListening:(s,i,r,o)=>(n.server_.listen(s,r,i,(a,c)=>{const l=o(a,c);De(n.eventQueue_,s._path,l)}),[]),stopListening:(s,i)=>{n.server_.unlisten(s,i)}})}function Mo(n){const t=n.infoData_.getNode(new G(".info/serverTimeOffset")).val()||0;return new Date().getTime()+t}function Xn(n){return eu({timestamp:Mo(n)})}function ir(n,e,t,s,i){n.dataUpdateCount++;const r=new G(e);t=n.interceptServerDataCallback_?n.interceptServerDataCallback_(e,t):t;let o=[];if(i)if(s){const c=wn(t,l=>ie(l));o=Kh(n.serverSyncTree_,r,c,i)}else{const c=ie(t);o=Co(n.serverSyncTree_,r,c,i)}else if(s){const c=wn(t,l=>ie(l));o=jh(n.serverSyncTree_,r,c)}else{const c=ie(t);o=pn(n.serverSyncTree_,r,c)}let a=r;o.length>0&&(a=xt(n,r)),De(n.eventQueue_,a,o)}function rr(n,e){li(n,"connected",e),e===!1&&wu(n)}function vu(n,e){ye(e,(t,s)=>{li(n,t,s)})}function li(n,e,t){const s=new G("/.info/"+e),i=ie(t);n.infoData_.updateSnapshot(s,i);const r=pn(n.infoSyncTree_,s,i);De(n.eventQueue_,s,r)}function ci(n){return n.nextWriteId_++}function Eu(n,e,t){const s=Yh(n.serverSyncTree_,e);return s!=null?Promise.resolve(s):n.server_.get(e).then(i=>{const r=ie(i).withIndex(e._queryParams.getIndex());Ns(n.serverSyncTree_,e,t,!0);let o;if(e._queryParams.loadsAllData())o=pn(n.serverSyncTree_,e._path,r);else{const a=cn(n.serverSyncTree_,e);o=Co(n.serverSyncTree_,e._path,r,a)}return De(n.eventQueue_,e._path,o),$n(n.serverSyncTree_,e,t,null,!0),r},i=>(mn(n,"get for query "+ce(e)+" failed: "+i),Promise.reject(new Error(i))))}function Cu(n,e,t,s,i){mn(n,"set",{path:e.toString(),value:t,priority:s});const r=Xn(n),o=ie(t,s),a=Js(n.serverSyncTree_,e),c=So(o,a,r),l=ci(n),f=Eo(n.serverSyncTree_,e,c,l,!0);Qn(n.eventQueue_,f),n.server_.put(e.toString(),o.val(!0),(d,g)=>{const b=d==="ok";b||Se("set at "+e+" failed: "+d);const R=Qe(n.serverSyncTree_,l,!b);De(n.eventQueue_,e,R),it(n,i,d,g)});const p=ui(n,e);xt(n,p),De(n.eventQueue_,p,[])}function bu(n,e,t,s){mn(n,"update",{path:e.toString(),value:t});let i=!0;const r=Xn(n),o={};if(ye(t,(a,c)=>{i=!1,o[a]=To(te(e,a),ie(c),n.serverSyncTree_,r)}),i)ge("update() called with empty data.  Don't do anything."),it(n,s,"ok",void 0);else{const a=ci(n),c=zh(n.serverSyncTree_,e,o,a);Qn(n.eventQueue_,c),n.server_.merge(e.toString(),t,(l,f)=>{const p=l==="ok";p||Se("update at "+e+" failed: "+l);const d=Qe(n.serverSyncTree_,a,!p),g=d.length>0?xt(n,e):e;De(n.eventQueue_,g,d),it(n,s,l,f)}),ye(t,l=>{const f=ui(n,te(e,l));xt(n,f)}),De(n.eventQueue_,e,[])}}function wu(n){mn(n,"onDisconnectEvents");const e=Xn(n),t=xn();ws(n.onDisconnect_,U(),(i,r)=>{const o=To(i,r,n.serverSyncTree_,e);Mt(t,i,o)});let s=[];ws(t,U(),(i,r)=>{s=s.concat(pn(n.serverSyncTree_,i,r));const o=ui(n,i);xt(n,o)}),n.onDisconnect_=xn(),De(n.eventQueue_,U(),s)}function Iu(n,e,t){n.server_.onDisconnectCancel(e.toString(),(s,i)=>{s==="ok"&&bs(n.onDisconnect_,e),it(n,t,s,i)})}function or(n,e,t,s){const i=ie(t);n.server_.onDisconnectPut(e.toString(),i.val(!0),(r,o)=>{r==="ok"&&Mt(n.onDisconnect_,e,i),it(n,s,r,o)})}function Tu(n,e,t,s,i){const r=ie(t,s);n.server_.onDisconnectPut(e.toString(),r.val(!0),(o,a)=>{o==="ok"&&Mt(n.onDisconnect_,e,r),it(n,i,o,a)})}function Su(n,e,t,s){if(fs(t)){ge("onDisconnect().update() called with empty data.  Don't do anything."),it(n,s,"ok",void 0);return}n.server_.onDisconnectMerge(e.toString(),t,(i,r)=>{i==="ok"&&ye(t,(o,a)=>{const c=ie(a);Mt(n.onDisconnect_,te(e,o),c)}),it(n,s,i,r)})}function ku(n,e,t){let s;x(e._path)===".info"?s=Ns(n.infoSyncTree_,e,t):s=Ns(n.serverSyncTree_,e,t),Oo(n.eventQueue_,e._path,s)}function Ru(n,e,t){let s;x(e._path)===".info"?s=$n(n.infoSyncTree_,e,t):s=$n(n.serverSyncTree_,e,t),Oo(n.eventQueue_,e._path,s)}function Nu(n){n.persistentConnection_&&n.persistentConnection_.interrupt(_u)}function mn(n,...e){let t="";n.persistentConnection_&&(t=n.persistentConnection_.id+":"),ge(t,...e)}function it(n,e,t,s){e&&Lt(()=>{if(t==="ok")e(null);else{const i=(t||"error").toUpperCase();let r=i;s&&(r+=": "+s);const o=new Error(r);o.code=i,e(o)}})}function Fo(n,e,t){return Js(n.serverSyncTree_,e,t)||T.EMPTY_NODE}function hi(n,e=n.transactionQueueTree_){if(e||Jn(n,e),Bt(e)){const t=$o(n,e);m(t.length>0,"Sending zero length transaction queue"),t.every(i=>i.status===0)&&Au(n,_n(e),t)}else Ro(e)&&Kn(e,t=>{hi(n,t)})}function Au(n,e,t){const s=t.map(l=>l.currentWriteId),i=Fo(n,e,s);let r=i;const o=i.hash();for(let l=0;l<t.length;l++){const f=t[l];m(f.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),f.status=1,f.retryCount++;const p=Te(e,f.path);r=r.updateChild(p,f.currentOutputSnapshotRaw)}const a=r.val(!0),c=e;n.server_.put(c.toString(),a,l=>{mn(n,"transaction put response",{path:c.toString(),status:l});let f=[];if(l==="ok"){const p=[];for(let d=0;d<t.length;d++)t[d].status=2,f=f.concat(Qe(n.serverSyncTree_,t[d].currentWriteId)),t[d].onComplete&&p.push(()=>t[d].onComplete(null,!0,t[d].currentOutputSnapshotResolved)),t[d].unwatcher();Jn(n,oi(n.transactionQueueTree_,e)),hi(n,n.transactionQueueTree_),De(n.eventQueue_,e,f);for(let d=0;d<p.length;d++)Lt(p[d])}else{if(l==="datastale")for(let p=0;p<t.length;p++)t[p].status===3?t[p].status=4:t[p].status=0;else{Se("transaction at "+c.toString()+" failed: "+l);for(let p=0;p<t.length;p++)t[p].status=4,t[p].abortReason=l}xt(n,e)}},o)}function xt(n,e){const t=Bo(n,e),s=_n(t),i=$o(n,t);return xu(n,i,s),s}function xu(n,e,t){if(e.length===0)return;const s=[];let i=[];const o=e.filter(a=>a.status===0).map(a=>a.currentWriteId);for(let a=0;a<e.length;a++){const c=e[a],l=Te(t,c.path);let f=!1,p;if(m(l!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),c.status===4)f=!0,p=c.abortReason,i=i.concat(Qe(n.serverSyncTree_,c.currentWriteId,!0));else if(c.status===0)if(c.retryCount>=mu)f=!0,p="maxretry",i=i.concat(Qe(n.serverSyncTree_,c.currentWriteId,!0));else{const d=Fo(n,c.path,o);c.currentInputSnapshot=d;const g=e[a].update(d.val());if(g!==void 0){Yn("transaction failed: Data returned ",g,c.path);let b=ie(g);typeof g=="object"&&g!=null&&Ue(g,".priority")||(b=b.updatePriority(d.getPriority()));const V=c.currentWriteId,he=Xn(n),Ee=So(b,d,he);c.currentOutputSnapshotRaw=b,c.currentOutputSnapshotResolved=Ee,c.currentWriteId=ci(n),o.splice(o.indexOf(V),1),i=i.concat(Eo(n.serverSyncTree_,c.path,Ee,c.currentWriteId,c.applyLocally)),i=i.concat(Qe(n.serverSyncTree_,V,!0))}else f=!0,p="nodata",i=i.concat(Qe(n.serverSyncTree_,c.currentWriteId,!0))}De(n.eventQueue_,t,i),i=[],f&&(e[a].status=2,(function(d){setTimeout(d,Math.floor(0))})(e[a].unwatcher),e[a].onComplete&&(p==="nodata"?s.push(()=>e[a].onComplete(null,!1,e[a].currentInputSnapshot)):s.push(()=>e[a].onComplete(new Error(p),!1,null))))}Jn(n,n.transactionQueueTree_);for(let a=0;a<s.length;a++)Lt(s[a]);hi(n,n.transactionQueueTree_)}function Bo(n,e){let t,s=n.transactionQueueTree_;for(t=x(e);t!==null&&Bt(s)===void 0;)s=oi(s,t),e=K(e),t=x(e);return s}function $o(n,e){const t=[];return Wo(n,e,t),t.sort((s,i)=>s.order-i.order),t}function Wo(n,e,t){const s=Bt(e);if(s)for(let i=0;i<s.length;i++)t.push(s[i]);Kn(e,i=>{Wo(n,i,t)})}function Jn(n,e){const t=Bt(e);if(t){let s=0;for(let i=0;i<t.length;i++)t[i].status!==2&&(t[s]=t[i],s++);t.length=s,ko(e,t.length>0?t:void 0)}Kn(e,s=>{Jn(n,s)})}function ui(n,e){const t=_n(Bo(n,e)),s=oi(n.transactionQueueTree_,e);return iu(s,i=>{us(n,i)}),us(n,s),No(s,i=>{us(n,i)}),t}function us(n,e){const t=Bt(e);if(t){const s=[];let i=[],r=-1;for(let o=0;o<t.length;o++)t[o].status===3||(t[o].status===1?(m(r===o-1,"All SENT items should be at beginning of queue."),r=o,t[o].status=3,t[o].abortReason="set"):(m(t[o].status===0,"Unexpected transaction status in abort"),t[o].unwatcher(),i=i.concat(Qe(n.serverSyncTree_,t[o].currentWriteId,!0)),t[o].onComplete&&s.push(t[o].onComplete.bind(null,new Error("set"),!1,null))));r===-1?ko(e,void 0):t.length=r+1,De(n.eventQueue_,_n(e),i);for(let o=0;o<s.length;o++)Lt(s[o])}}function Pu(n){let e="";const t=n.split("/");for(let s=0;s<t.length;s++)if(t[s].length>0){let i=t[s];try{i=decodeURIComponent(i.replace(/\+/g," "))}catch{}e+="/"+i}return e}function Du(n){const e={};n.charAt(0)==="?"&&(n=n.substring(1));for(const t of n.split("&")){if(t.length===0)continue;const s=t.split("=");s.length===2?e[decodeURIComponent(s[0])]=decodeURIComponent(s[1]):Se(`Invalid query segment '${t}' in query '${n}'`)}return e}const ar=function(n,e){const t=Ou(n),s=t.namespace;t.domain==="firebase.com"&&Ke(t.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!s||s==="undefined")&&t.domain!=="localhost"&&Ke("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),t.secure||Ul();const i=t.scheme==="ws"||t.scheme==="wss";return{repoInfo:new Hr(t.host,t.secure,s,i,e,"",s!==t.subdomain),path:new G(t.pathString)}},Ou=function(n){let e="",t="",s="",i="",r="",o=!0,a="https",c=443;if(typeof n=="string"){let l=n.indexOf("//");l>=0&&(a=n.substring(0,l-1),n=n.substring(l+2));let f=n.indexOf("/");f===-1&&(f=n.length);let p=n.indexOf("?");p===-1&&(p=n.length),e=n.substring(0,Math.min(f,p)),f<p&&(i=Pu(n.substring(f,p)));const d=Du(n.substring(Math.min(n.length,p)));l=e.indexOf(":"),l>=0?(o=a==="https"||a==="wss",c=parseInt(e.substring(l+1),10)):l=e.length;const g=e.slice(0,l);if(g.toLowerCase()==="localhost")t="localhost";else if(g.split(".").length<=2)t=g;else{const b=e.indexOf(".");s=e.substring(0,b).toLowerCase(),t=e.substring(b+1),r=s}"ns"in d&&(r=d.ns)}return{host:e,port:c,domain:t,subdomain:s,secure:o,scheme:a,pathString:i,namespace:r}};const lr="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",Lu=(function(){let n=0;const e=[];return function(t){const s=t===n;n=t;let i;const r=new Array(8);for(i=7;i>=0;i--)r[i]=lr.charAt(t%64),t=Math.floor(t/64);m(t===0,"Cannot push at time == 0");let o=r.join("");if(s){for(i=11;i>=0&&e[i]===63;i--)e[i]=0;e[i]++}else for(i=0;i<12;i++)e[i]=Math.floor(Math.random()*64);for(i=0;i<12;i++)o+=lr.charAt(e[i]);return m(o.length===20,"nextPushId: Length should be 20."),o}})();class Uo{constructor(e,t,s,i){this.eventType=e,this.eventRegistration=t,this.snapshot=s,this.prevName=i}getPath(){const e=this.snapshot.ref;return this.eventType==="value"?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+ce(this.snapshot.exportVal())}}class Ho{constructor(e,t,s){this.eventRegistration=e,this.error=t,this.path=s}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}class Vo{constructor(e,t){this.snapshotCallback=e,this.cancelCallback=t}onValue(e,t){this.snapshotCallback.call(null,e,t)}onCancel(e){return m(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||this.snapshotCallback.userCallback!==void 0&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}}class Mu{constructor(e,t){this._repo=e,this._path=t}cancel(){const e=new We;return Iu(this._repo,this._path,e.wrapCallback(()=>{})),e.promise}remove(){Ct("OnDisconnect.remove",this._path);const e=new We;return or(this._repo,this._path,null,e.wrapCallback(()=>{})),e.promise}set(e){Ct("OnDisconnect.set",this._path),Wn("OnDisconnect.set",e,this._path,!1);const t=new We;return or(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}setWithPriority(e,t){Ct("OnDisconnect.setWithPriority",this._path),Wn("OnDisconnect.setWithPriority",e,this._path,!1),hu("OnDisconnect.setWithPriority",t);const s=new We;return Tu(this._repo,this._path,e,t,s.wrapCallback(()=>{})),s.promise}update(e){Ct("OnDisconnect.update",this._path),Po("OnDisconnect.update",e,this._path);const t=new We;return Su(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}}class di{constructor(e,t,s,i){this._repo=e,this._path=t,this._queryParams=s,this._orderByCalled=i}get key(){return P(this._path)?null:$s(this._path)}get ref(){return new He(this._repo,this._path)}get _queryIdentifier(){const e=Gi(this._queryParams),t=Ls(e);return t==="{}"?"default":t}get _queryObject(){return Gi(this._queryParams)}isEqual(e){if(e=rt(e),!(e instanceof di))return!1;const t=this._repo===e._repo,s=Ws(this._path,e._path),i=this._queryIdentifier===e._queryIdentifier;return t&&s&&i}toJSON(){return this.toString()}toString(){return this._repo.toString()+Ic(this._path)}}class He extends di{constructor(e,t){super(e,t,new zs,!1)}get parent(){const e=Xr(this._path);return e===null?null:new He(this._repo,e)}get root(){let e=this;for(;e.parent!==null;)e=e.parent;return e}}class Pt{constructor(e,t,s){this._node=e,this.ref=t,this._index=s}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){const t=new G(e),s=Dt(this.ref,e);return new Pt(this._node.getChild(t),s,ne)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return this._node.isLeafNode()?!1:!!this._node.forEachChild(this._index,(s,i)=>e(new Pt(i,Dt(this.ref,s),ne)))}hasChild(e){const t=new G(e);return!this._node.getChild(t).isEmpty()}hasChildren(){return this._node.isLeafNode()?!1:!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function $(n,e){return n=rt(n),n._checkNotDeleted("ref"),e!==void 0?Dt(n._root,e):n._root}function Dt(n,e){return n=rt(n),x(n._path)===null?uu("child","path",e):Do("child","path",e),new He(n._repo,te(n._path,e))}function Fu(n){return n=rt(n),new Mu(n._repo,n._path)}function yt(n,e){n=rt(n),Ct("push",n._path),Wn("push",e,n._path,!0);const t=Mo(n._repo),s=Lu(t),i=Dt(n,s),r=Dt(n,s);let o;return o=Promise.resolve(r),i.then=o.then.bind(o),i.catch=o.then.bind(o,void 0),i}function cr(n,e){n=rt(n),Ct("set",n._path),Wn("set",e,n._path,!1);const t=new We;return Cu(n._repo,n._path,e,null,t.wrapCallback(()=>{})),t.promise}function Re(n,e){Po("update",e,n._path);const t=new We;return bu(n._repo,n._path,e,t.wrapCallback(()=>{})),t.promise}function lt(n){n=rt(n);const e=new Vo(()=>{}),t=new Zn(e);return Eu(n._repo,n,t).then(s=>new Pt(s,new He(n._repo,n._path),n._queryParams.getIndex()))}class Zn{constructor(e){this.callbackContext=e}respondsTo(e){return e==="value"}createEvent(e,t){const s=t._queryParams.getIndex();return new Uo("value",this,new Pt(e.snapshotNode,new He(t._repo,t._path),s))}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new Ho(this,e,t):null}matches(e){return e instanceof Zn?!e.callbackContext||!this.callbackContext?!0:e.callbackContext.matches(this.callbackContext):!1}hasAnyCallback(){return this.callbackContext!==null}}class fi{constructor(e,t){this.eventType=e,this.callbackContext=t}respondsTo(e){let t=e==="children_added"?"child_added":e;return t=t==="children_removed"?"child_removed":t,this.eventType===t}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new Ho(this,e,t):null}createEvent(e,t){m(e.childName!=null,"Child events should have a childName.");const s=Dt(new He(t._repo,t._path),e.childName),i=t._queryParams.getIndex();return new Uo(e.type,this,new Pt(e.snapshotNode,s,i),e.prevName)}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,e.prevName)}matches(e){return e instanceof fi?this.eventType===e.eventType&&(!this.callbackContext||!e.callbackContext||this.callbackContext.matches(e.callbackContext)):!1}hasAnyCallback(){return!!this.callbackContext}}function zo(n,e,t,s,i){const r=new Vo(t,void 0),o=e==="value"?new Zn(r):new fi(e,r);return ku(n._repo,n,o),()=>Ru(n._repo,n,o)}function pi(n,e,t,s){return zo(n,"value",e)}function Bu(n,e,t,s){return zo(n,"child_added",e)}Mh(He);Uh(He);const $u="FIREBASE_DATABASE_EMULATOR_HOST",xs={};let Wu=!1;function Uu(n,e,t,s){const i=e.lastIndexOf(":"),r=e.substring(0,i),o=Ds(r);n.repoInfo_=new Hr(e,o,n.repoInfo_.namespace,n.repoInfo_.webSocketOnly,n.repoInfo_.nodeAdmin,n.repoInfo_.persistenceKey,n.repoInfo_.includeNamespaceInQueryParams,!0,t),s&&(n.authTokenProvider_=s)}function Hu(n,e,t,s,i){let r=s||n.options.databaseURL;r===void 0&&(n.options.projectId||Ke("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),ge("Using default host for project ",n.options.projectId),r=`${n.options.projectId}-default-rtdb.firebaseio.com`);let o=ar(r,i),a=o.repoInfo,c;typeof process<"u"&&Ri&&(c=Ri[$u]),c?(r=`http://${c}?ns=${a.namespace}`,o=ar(r,i),a=o.repoInfo):o.repoInfo.secure;const l=new Jl(n.name,n.options,e);du("Invalid Firebase Database URL",o),P(o.path)||Ke("Database URL must point to the root of a Firebase Database (not including a child path).");const f=zu(a,n,l,new Xl(n,t));return new ju(f,n)}function Vu(n,e){const t=xs[e];(!t||t[n.key]!==n)&&Ke(`Database ${e}(${n.repoInfo_}) has already been deleted.`),Nu(n),delete t[n.key]}function zu(n,e,t,s){let i=xs[e.name];i||(i={},xs[e.name]=i);let r=i[n.toURLString()];return r&&Ke("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),r=new gu(n,Wu,t,s),i[n.toURLString()]=r,r}class ju{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(yu(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new He(this._repo,U())),this._rootInternal}_delete(){return this._rootInternal!==null&&(Vu(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){this._rootInternal===null&&Ke("Cannot call "+e+" on a deleted database.")}}function Gu(n=bl(),e){const t=gl(n,"database").getImmediate({identifier:e});if(!t._instanceStarted){const s=na("database");s&&qu(t,...s)}return t}function qu(n,e,t,s={}){n=rt(n),n._checkNotDeleted("useEmulator");const i=`${e}:${t}`,r=n._repoInternal;if(n._instanceStarted){if(i===n._repoInternal.repoInfo_.host&&In(s,r.repoInfo_.emulatorOptions))return;Ke("connectDatabaseEmulator() cannot initialize or alter the emulator configuration after the database instance has started.")}let o;if(r.repoInfo_.nodeAdmin)s.mockUserToken&&Ke('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),o=new En(En.OWNER);else if(s.mockUserToken){const a=typeof s.mockUserToken=="string"?s.mockUserToken:ia(s.mockUserToken,n.app.options.projectId);o=new En(a)}Ds(e)&&(sa(e),aa("Database",!0)),Uu(r,i,s,o)}function Ku(n){Ll(Cl),Sn(new en("database",(e,{instanceIdentifier:t})=>{const s=e.getProvider("app").getImmediate(),i=e.getProvider("auth-internal"),r=e.getProvider("app-check-internal");return Hu(s,i,r,t)},"PUBLIC").setMultipleInstances(!0)),bt(Ni,Ai,n),bt(Ni,Ai,"esm2020")}Ge.prototype.simpleListen=function(n,e){this.sendRequest("q",{p:n},e)};Ge.prototype.echo=function(n,e){this.sendRequest("echo",{d:n},e)};Ku();const Yu={apiKey:"AIzaSyA-IzF3xNHwyeg6nJ3aUdgUfGPi9ZRC3Oo",authDomain:"lol-auction.css-web.firebaseapp.com",databaseURL:"https://lol-auction-web-default-rtdb.europe-west1.firebasedatabase.app",projectId:"lol-auction.css-web",storageBucket:"lol-auction.css-web.firebasestorage.app",messagingSenderId:"451886053867",appId:"1:451886053867:web:201c85f96bd114485501ae"},Qu=Tr(Yu),W=Gu(Qu);let hr=0;const pe={initServerTimeOffset(){const n=$(W,".info/serverTimeOffset");pi(n,e=>{hr=e.val()||0})},getServerTime(){return Date.now()+hr},getRemainingSeconds(n){const e=this.getServerTime(),t=Math.ceil((n-e)/1e3);return t<=0?0:t},shuffle(n){const e=[...n];for(let t=e.length-1;t>0;t--){const s=Math.floor(Math.random()*(t+1));[e[t],e[s]]=[e[s],e[t]]}return e}},Ye={async nextPlayer(n){const t=(await lt($(W,`rooms/${n}`))).val(),s=t.live,i=t.teams;if(Object.values(i).every(a=>(a.members?.length||0)>=4)){await Re($(W,`rooms/${n}/live`),{status:"idle"});const a=yt($(W,`rooms/${n}/logs`)).key;return await Re($(W,`rooms/${n}/logs/${a}`),{msg:" <strong>   !  .</strong>",timestamp:pe.getServerTime()}),alert("     !")}let o=s.playerOrder.find(a=>t.players[a].status==="waiting");if(!o){const a=s.playerOrder.filter(c=>t.players[c].status==="passed");if(a.length>0){const c={};a.forEach(f=>{c[`rooms/${n}/players/${f}/status`]="waiting"});const l=yt($(W,`rooms/${n}/logs`)).key;c[`rooms/${n}/logs/${l}`]={msg:" <strong>       .</strong>",timestamp:pe.getServerTime()},await Re($(W),c),o=a[0]}else return await Re($(W,`rooms/${n}/live`),{status:"idle"}),alert("    . ( )")}o&&(await Re($(W,`rooms/${n}/live`),{status:"bidding",activePlayerId:o,highestBid:0,highestBidderId:null,endTime:pe.getServerTime()+15e3}),await Re($(W,`rooms/${n}/players/${o}`),{status:"bidding"}))},async placeBid(n,e,t){const i=(await lt($(W,`rooms/${n}`))).val(),r=i.live;if(r.status!=="bidding")return;const a=(r.highestBid||0)+t;await this._processBid(n,e,a,i)},async placeTargetBid(n,e,t){const i=(await lt($(W,`rooms/${n}`))).val();i.live.status==="bidding"&&await this._processBid(n,e,t,i)},async _processBid(n,e,t,s){const i=s.live,r=i.highestBid||0,o=s.players[i.activePlayerId],a=s.teams[e],c=a.points,l=a.members?.length||0;if(i.highestBidderId===e&&t>=r)return alert("  .    .");if(l>=4)return alert("   ( 5).");if(t<0)return alert("0     .");if(t<r){if(i.highestBidderId!==e)return alert(` (${r}P)   .`)}else if(t<=r&&i.highestBidderId!==e)return alert(` (${r}P)   .`);const f=4-l-1,p=c-t;if(p<f)return alert(`  (${f})  (${f}P)  .
( : ${c}P,   : ${p}P)`);const d={};d[`rooms/${n}/live/highestBid`]=t,d[`rooms/${n}/live/highestBidderId`]=e,d[`rooms/${n}/live/endTime`]=pe.getServerTime()+15e3;const g=yt($(W,`rooms/${n}/logs`)).key,b=t<r?"":"";d[`rooms/${n}/logs/${g}`]={msg:`<strong>${s.teams[e].leaderName}</strong> <strong>${o.name}</strong> <span class="amt" style="font-size:1.1em">${t}P</span> ${b}!`,timestamp:pe.getServerTime()},await Re($(W),d)},async pauseAuction(n,e){const s=(await lt($(W,`rooms/${n}`))).val(),i=s.live,r=s.teams[e];if(i.status!=="bidding")return alert("     .");if(r.pauseCount<=0)return alert("   .");const o=i.endTime-pe.getServerTime(),a={};a[`rooms/${n}/live/status`]="paused",a[`rooms/${n}/live/remainingAuctionTime`]=o,a[`rooms/${n}/live/pauseLimitTime`]=pe.getServerTime()+12e4,a[`rooms/${n}/live/pausedBy`]=e,a[`rooms/${n}/teams/${e}/pauseCount`]=r.pauseCount-1;const c=yt($(W,`rooms/${n}/logs`)).key;a[`rooms/${n}/logs/${c}`]={msg:` <strong>${r.leaderName}</strong>  . (2 )`,timestamp:pe.getServerTime()},await Re($(W),a)},async resumeAuction(n,e){const s=(await lt($(W,`rooms/${n}/live`))).val();if(s.status!=="paused")return;if(e&&e!=="team_1"&&s.pausedBy!==e)return alert("     .");const i={};i[`rooms/${n}/live/status`]="resuming",i[`rooms/${n}/live/nextAuctionTime`]=pe.getServerTime()+5e3,i[`rooms/${n}/live/pausedBy`]=null,i[`rooms/${n}/live/pauseLimitTime`]=null;const r=yt($(W,`rooms/${n}/logs`)).key;i[`rooms/${n}/logs/${r}`]={msg:"  . 5   .",timestamp:pe.getServerTime()},await Re($(W),i)},async startBidding(n){await Re($(W,`rooms/${n}/live`),{status:"bidding",endTime:pe.getServerTime()+15e3})},async finalize(n){const t=(await lt($(W,`rooms/${n}`))).val(),s=t.live,i=t.players[s.activePlayerId];if(s.status==="cooldown")return;const r={};let o="";if(s.highestBidderId){r[`rooms/${n}/players/${s.activePlayerId}/status`]="sold",r[`rooms/${n}/players/${s.activePlayerId}/soldPrice`]=s.highestBid;const c=t.teams[s.highestBidderId];r[`rooms/${n}/teams/${s.highestBidderId}/points`]=c.points-s.highestBid;const l=c.members||[];r[`rooms/${n}/teams/${s.highestBidderId}/members`]=[...l,s.activePlayerId],o=` <strong>${i.name}</strong> -> <strong>${c.leaderName}</strong> ! (<span class="amt">${s.highestBid}P</span>)`}else r[`rooms/${n}/players/${s.activePlayerId}/status`]="passed",o=` <strong>${i.name}</strong> .`;const a=yt($(W,`rooms/${n}/logs`)).key;r[`rooms/${n}/logs/${a}`]={msg:o,timestamp:pe.getServerTime()},r[`rooms/${n}/live/status`]="cooldown",r[`rooms/${n}/live/nextAuctionTime`]=pe.getServerTime()+5e3,await Re($(W),r)}},vn={async createRoom(n,e,t){await cr($(W,`rooms/${n}`),{info:{createdAt:Date.now(),status:"waiting"},teams:e,live:{status:"idle",activePlayerId:null,highestBid:0,highestBidderId:null,initialPoints:t,playerOrder:[],leaderOrder:Object.keys(e)},players:{}})},async registerPlayers(n,e){const t={};t[`rooms/${n}/players`]=e,t[`rooms/${n}/live/playerOrder`]=[],await Re($(W),t)},async startAuctionProcess(n){const t=(await lt($(W,`rooms/${n}`))).val(),s=Object.keys(t.players||{}),i=Object.keys(t.teams||{});if(s.length===0)return alert(" (CSV)  .");const r=i.length*4;if(s.length<r)return alert(` .  ${r} . ( ${s.length})`);const o=t.teams,a=Object.values(o).filter(c=>!c.online).map(c=>c.leaderName);if(a.length>0)return alert(`    :
${a.join(", ")}

      .`);await Re($(W,`rooms/${n}/live`),{playerOrder:pe.shuffle(s),leaderOrder:pe.shuffle(i),status:"idle"}),this.triggerNextAuction(n)},async triggerNextAuction(n){await Re($(W,`rooms/${n}/live`),{status:"cooldown",nextAuctionTime:Date.now()+3e3})},connectToRoom(n,e){if(e==="viewer")return;const t=$(W,".info/connected"),s=$(W,`rooms/${n}/teams/${e}/online`);pi(t,i=>{i.val()===!0&&(cr(s,!0),Fu(s).set(!1))})}},Gt=n=>{if(!n)return"#fff";const e=n.trim();return e.startsWith("")?"#808080":e.startsWith("")?"#544546":e.startsWith("")?"#935b55":e.startsWith("")?"#808080":e.startsWith("")?"#b8860b":e.startsWith("")?"#0a8d5e":e.startsWith("")?"#006400":e.startsWith("")?"#5c6eb4":e.startsWith("")?"#9400d3":e.startsWith("")?"#dd534a":e.startsWith("")?"#1583af":"#fff"},vt={renderPlayerList(n,e){const t=document.getElementById("player-list");if(!t)return;const i=(e.length>0?e:Object.keys(n)).map(r=>{const o=n[r];if(!o)return"";const a=Gt(o.currentTier);return`<div class="player-card ${o.status}" data-id="${o.id}">
                <strong>${o.name}</strong> <small style="color:${a}">${o.currentTier}</small> <small>(${o.mainPos})</small>
            </div>`}).join("");t.innerHTML=`<div class="panel-header">PLAYERS ( )</div><div class="scroll-area">${i}</div>`},renderStage(n,e,t){const s=document.getElementById("auction-status-message"),i=document.getElementById("player-info-area");if(!s||!i)return;const r=Object.values(t).every(f=>(f.members?.length||0)>=4);let o="";if(r)o='<span style="color:#c8aa6e"> .</span>';else if(n.status==="resuming")o='<span style="color:#3fb950"> ! 5  .</span>';else if(n.status==="cooldown")n.highestBidderId?o=`<span style="color:#c8aa6e">${t[n.highestBidderId]?.leaderName}</span>  <span style="color:#fff">${n.highestBid}P</span> !`:n.activePlayerId&&e[n.activePlayerId]?.status==="passed"?o='<span style="color:#ff4655">.</span>':o="  .  !";else if(n.status==="paused")o='<span style="color:#ffff00">  .</span>';else if(n.status==="bidding"){const f=n.highestBidderId?t[n.highestBidderId]:null;o=` : <span style="color:#ff4655">${n.highestBid||0}P</span> <span style="font-size:0.8em; color:#c8aa6e">(${f?f.leaderName:" "})</span>`}else o="  ";if(s.innerHTML=o,r){i.innerHTML=`
                <div style="padding: 40px 0; text-align: center;">
                    <p style="font-size: 18px; color: #888; line-height: 1.6;">
                           .<br>
                         <span style="color: #c8aa6e; font-weight: bold;"> </span>     .
                    </p>
                </div>
            `;return}if(n.status==="cooldown"){let f="",p="   ...";n.highestBidderId?f=`<span style="color:#c8aa6e">${t[n.highestBidderId]?.leaderName}</span>  <span style="color:#fff">${n.highestBid}P</span> !`:n.activePlayerId&&e[n.activePlayerId]?.status==="passed"?f='<span style="color:#ff4655">.</span>':(f="  .",p=" !"),i.innerHTML=`
                <div style="padding: 40px 0; text-align: center;">
                    <h2 style="font-size: 32px; margin-bottom: 20px;">${f}</h2>
                    <p style="font-size: 18px; color: #888;">${p}</p>
                </div>
            `;return}if(!n.activePlayerId||!e[n.activePlayerId]){i.innerHTML='<div style="padding: 50px; color: #888;">   .</div>';return}const a=e[n.activePlayerId],c=Gt(a.highTier),l=Gt(a.currentTier);i.innerHTML=`
            <span class="p-name">${a.name}</span>
            <span class="p-nick">(${a.nickname})</span>
            <div class="tier-badge">
                <span style="color:#aaa; font-size:0.8em;">:</span> <span style="color:${c}; font-weight:bold;">${a.highTier}</span>
                <span style="color:#444; margin:0 8px;">|</span>
                <span style="color:#aaa; font-size:0.8em;">:</span> <span style="color:${l}; font-weight:bold;">${a.currentTier}</span>
            </div>
            <div class="p-info-grid">
                <div><strong> :</strong> ${a.mainPos}</div>
                <div><strong> :</strong> ${a.subPos}</div>
                <div class="full"><strong>Most:</strong> ${a.most?a.most.join(", "):"-"}</div>
            </div>
        `},renderTeams(n,e){const t=document.getElementById("team-list");if(!t)return;const s=Object.values(n).map(i=>{const r=i.online?'<span class="online-dot"></span>':'<span class="offline-dot"></span>';return`
            <div class="team-card ${e===i.id?"active":""}" data-id="${i.id}">
                <div class="t-header">${r} ${i.leaderName} ${e===i.id?"()":""}</div>
                <div class="t-points">${i.points.toLocaleString()} P</div>
                <div class="t-members">: ${i.members?.length||0} / 4</div>
                <div class="t-pause"> : ${i.pauseCount}</div>
            </div>
        `}).join("");t.innerHTML=`<div class="panel-header">TEAMS</div><div class="scroll-area">${s}</div>`},renderStats(n){const e=document.getElementById("auction-stats");if(!e)return;const t=Object.values(n);e.innerHTML=`
            <span> : ${t.filter(s=>s.status==="waiting").length}</span>
            <span>: ${t.filter(s=>s.status==="sold").length}</span>
            <span>: ${t.filter(s=>s.status==="passed").length}</span>
        `},renderLog(n){const e=document.getElementById("auction-logs");if(!e)return;const t=document.createElement("div");t.className="log-item";const s=new Date(n.timestamp).toLocaleTimeString("ko-KR",{hour:"2-digit",minute:"2-digit",second:"2-digit"});t.innerHTML=`<span style="color:#555; font-size:12px; margin-right:5px;">[${s}]</span> ${n.msg}`,e.prepend(t)},getTooltipHtml(n){const e=Gt(n.highTier),t=Gt(n.currentTier);return`
            <div style="font-size: 16px; font-weight: bold; margin-bottom: 8px; color: #fff;">
                ${n.name} <span style="font-size: 13px; color: #888; font-weight: normal;">(${n.nickname})</span>
            </div>
            <div style="font-size: 13px; line-height: 1.6; color: #ccc;">
                <div><span style="color:#888;">:</span> <span style="color:${e}; font-weight:bold;">${n.highTier}</span></div>
                <div><span style="color:#888;">:</span> <span style="color:${t}; font-weight:bold;">${n.currentTier}</span></div>
                <div style="margin-top: 4px;"><span style="color:#888;"> / :</span> ${n.mainPos} / ${n.subPos||"-"}</div>
                <div><span style="color:#888;">Most:</span> ${n.most?n.most.join(", "):"-"}</div>
            </div>
        `}};function Xu(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Cn={exports:{}};var Ju=Cn.exports,ur;function Zu(){return ur||(ur=1,(function(n,e){((t,s)=>{n.exports=s()})(Ju,function t(){var s=typeof self<"u"?self:typeof window<"u"?window:s!==void 0?s:{},i,r=!s.document&&!!s.postMessage,o=s.IS_PAPA_WORKER||!1,a={},c=0,l={};function f(h){this._handle=null,this._finished=!1,this._completed=!1,this._halted=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,this.isFirstChunk=!0,this._completeResults={data:[],errors:[],meta:{}},(function(u){var _=$t(u);_.chunkSize=parseInt(_.chunkSize),u.step||u.chunk||(_.chunkSize=null),this._handle=new R(_),(this._handle.streamer=this)._config=_}).call(this,h),this.parseChunk=function(u,_){var C=parseInt(this._config.skipFirstNLines)||0;if(this.isFirstChunk&&0<C){let w=this._config.newline;w||(E=this._config.quoteChar||'"',w=this._handle.guessLineEndings(u,E)),u=[...u.split(w).slice(C)].join(w)}this.isFirstChunk&&y(this._config.beforeFirstChunk)&&(E=this._config.beforeFirstChunk(u))!==void 0&&(u=E),this.isFirstChunk=!1,this._halted=!1;var C=this._partialLine+u,E=(this._partialLine="",this._handle.parse(C,this._baseIndex,!this._finished));if(!this._handle.paused()&&!this._handle.aborted()){if(u=E.meta.cursor,C=(this._finished||(this._partialLine=C.substring(u-this._baseIndex),this._baseIndex=u),E&&E.data&&(this._rowCount+=E.data.length),this._finished||this._config.preview&&this._rowCount>=this._config.preview),o)s.postMessage({results:E,workerId:l.WORKER_ID,finished:C});else if(y(this._config.chunk)&&!_){if(this._config.chunk(E,this._handle),this._handle.paused()||this._handle.aborted())return void(this._halted=!0);this._completeResults=E=void 0}return this._config.step||this._config.chunk||(this._completeResults.data=this._completeResults.data.concat(E.data),this._completeResults.errors=this._completeResults.errors.concat(E.errors),this._completeResults.meta=E.meta),this._completed||!C||!y(this._config.complete)||E&&E.meta.aborted||(this._config.complete(this._completeResults,this._input),this._completed=!0),C||E&&E.meta.paused||this._nextChunk(),E}this._halted=!0},this._sendError=function(u){y(this._config.error)?this._config.error(u):o&&this._config.error&&s.postMessage({workerId:l.WORKER_ID,error:u,finished:!1})}}function p(h){var u;(h=h||{}).chunkSize||(h.chunkSize=l.RemoteChunkSize),f.call(this,h),this._nextChunk=r?function(){this._readChunk(),this._chunkLoaded()}:function(){this._readChunk()},this.stream=function(_){this._input=_,this._nextChunk()},this._readChunk=function(){if(this._finished)this._chunkLoaded();else{if(u=new XMLHttpRequest,this._config.withCredentials&&(u.withCredentials=this._config.withCredentials),r||(u.onload=v(this._chunkLoaded,this),u.onerror=v(this._chunkError,this)),u.open(this._config.downloadRequestBody?"POST":"GET",this._input,!r),this._config.downloadRequestHeaders){var _,C=this._config.downloadRequestHeaders;for(_ in C)u.setRequestHeader(_,C[_])}var E;this._config.chunkSize&&(E=this._start+this._config.chunkSize-1,u.setRequestHeader("Range","bytes="+this._start+"-"+E));try{u.send(this._config.downloadRequestBody)}catch(w){this._chunkError(w.message)}r&&u.status===0&&this._chunkError()}},this._chunkLoaded=function(){u.readyState===4&&(u.status<200||400<=u.status?this._chunkError():(this._start+=this._config.chunkSize||u.responseText.length,this._finished=!this._config.chunkSize||this._start>=(_=>(_=_.getResponseHeader("Content-Range"))!==null?parseInt(_.substring(_.lastIndexOf("/")+1)):-1)(u),this.parseChunk(u.responseText)))},this._chunkError=function(_){_=u.statusText||_,this._sendError(new Error(_))}}function d(h){(h=h||{}).chunkSize||(h.chunkSize=l.LocalChunkSize),f.call(this,h);var u,_,C=typeof FileReader<"u";this.stream=function(E){this._input=E,_=E.slice||E.webkitSlice||E.mozSlice,C?((u=new FileReader).onload=v(this._chunkLoaded,this),u.onerror=v(this._chunkError,this)):u=new FileReaderSync,this._nextChunk()},this._nextChunk=function(){this._finished||this._config.preview&&!(this._rowCount<this._config.preview)||this._readChunk()},this._readChunk=function(){var E=this._input,w=(this._config.chunkSize&&(w=Math.min(this._start+this._config.chunkSize,this._input.size),E=_.call(E,this._start,w)),u.readAsText(E,this._config.encoding));C||this._chunkLoaded({target:{result:w}})},this._chunkLoaded=function(E){this._start+=this._config.chunkSize,this._finished=!this._config.chunkSize||this._start>=this._input.size,this.parseChunk(E.target.result)},this._chunkError=function(){this._sendError(u.error)}}function g(h){var u;f.call(this,h=h||{}),this.stream=function(_){return u=_,this._nextChunk()},this._nextChunk=function(){var _,C;if(!this._finished)return _=this._config.chunkSize,u=_?(C=u.substring(0,_),u.substring(_)):(C=u,""),this._finished=!u,this.parseChunk(C)}}function b(h){f.call(this,h=h||{});var u=[],_=!0,C=!1;this.pause=function(){f.prototype.pause.apply(this,arguments),this._input.pause()},this.resume=function(){f.prototype.resume.apply(this,arguments),this._input.resume()},this.stream=function(E){this._input=E,this._input.on("data",this._streamData),this._input.on("end",this._streamEnd),this._input.on("error",this._streamError)},this._checkIsFinished=function(){C&&u.length===1&&(this._finished=!0)},this._nextChunk=function(){this._checkIsFinished(),u.length?this.parseChunk(u.shift()):_=!0},this._streamData=v(function(E){try{u.push(typeof E=="string"?E:E.toString(this._config.encoding)),_&&(_=!1,this._checkIsFinished(),this.parseChunk(u.shift()))}catch(w){this._streamError(w)}},this),this._streamError=v(function(E){this._streamCleanUp(),this._sendError(E)},this),this._streamEnd=v(function(){this._streamCleanUp(),C=!0,this._streamData("")},this),this._streamCleanUp=v(function(){this._input.removeListener("data",this._streamData),this._input.removeListener("end",this._streamEnd),this._input.removeListener("error",this._streamError)},this)}function R(h){var u,_,C,E,w=Math.pow(2,53),N=-w,B=/^\s*-?(\d+\.?|\.\d+|\d+\.\d+)([eE][-+]?\d+)?\s*$/,z=/^((\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z)))$/,k=this,X=0,S=0,Ce=!1,A=!1,M=[],I={data:[],errors:[],meta:{}};function ae(F){return h.skipEmptyLines==="greedy"?F.join("").trim()==="":F.length===1&&F[0].length===0}function re(){if(I&&C&&(Ae("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+l.DefaultDelimiter+"'"),C=!1),h.skipEmptyLines&&(I.data=I.data.filter(function(J){return!ae(J)})),ve()){let J=function(ue,Z){y(h.transformHeader)&&(ue=h.transformHeader(ue,Z)),M.push(ue)};var O=J;if(I)if(Array.isArray(I.data[0])){for(var F=0;ve()&&F<I.data.length;F++)I.data[F].forEach(J);I.data.splice(0,1)}else I.data.forEach(J)}function H(J,ue){for(var Z=h.header?{}:[],q=0;q<J.length;q++){var L=q,be=J[q],be=((j,ee)=>(le=>(h.dynamicTypingFunction&&h.dynamicTyping[le]===void 0&&(h.dynamicTyping[le]=h.dynamicTypingFunction(le)),(h.dynamicTyping[le]||h.dynamicTyping)===!0))(j)?ee==="true"||ee==="TRUE"||ee!=="false"&&ee!=="FALSE"&&((le=>{if(B.test(le)&&(le=parseFloat(le),N<le&&le<w))return 1})(ee)?parseFloat(ee):z.test(ee)?new Date(ee):ee===""?null:ee):ee)(L=h.header?q>=M.length?"__parsed_extra":M[q]:L,be=h.transform?h.transform(be,L):be);L==="__parsed_extra"?(Z[L]=Z[L]||[],Z[L].push(be)):Z[L]=be}return h.header&&(q>M.length?Ae("FieldMismatch","TooManyFields","Too many fields: expected "+M.length+" fields but parsed "+q,S+ue):q<M.length&&Ae("FieldMismatch","TooFewFields","Too few fields: expected "+M.length+" fields but parsed "+q,S+ue)),Z}var se;I&&(h.header||h.dynamicTyping||h.transform)&&(se=1,!I.data.length||Array.isArray(I.data[0])?(I.data=I.data.map(H),se=I.data.length):I.data=H(I.data,0),h.header&&I.meta&&(I.meta.fields=M),S+=se)}function ve(){return h.header&&M.length===0}function Ae(F,H,se,O){F={type:F,code:H,message:se},O!==void 0&&(F.row=O),I.errors.push(F)}y(h.step)&&(E=h.step,h.step=function(F){I=F,ve()?re():(re(),I.data.length!==0&&(X+=F.data.length,h.preview&&X>h.preview?_.abort():(I.data=I.data[0],E(I,k))))}),this.parse=function(F,H,se){var O=h.quoteChar||'"',O=(h.newline||(h.newline=this.guessLineEndings(F,O)),C=!1,h.delimiter?y(h.delimiter)&&(h.delimiter=h.delimiter(F),I.meta.delimiter=h.delimiter):((O=((J,ue,Z,q,L)=>{var be,j,ee,le;L=L||[",","	","|",";",l.RECORD_SEP,l.UNIT_SEP];for(var _t=0;_t<L.length;_t++){for(var Fe,Wt=L[_t],we=0,Be=0,de=0,ke=(ee=void 0,new he({comments:q,delimiter:Wt,newline:ue,preview:10}).parse(J)),ze=0;ze<ke.data.length;ze++)Z&&ae(ke.data[ze])?de++:(Fe=ke.data[ze].length,Be+=Fe,ee===void 0?ee=Fe:0<Fe&&(we+=Math.abs(Fe-ee),ee=Fe));0<ke.data.length&&(Be/=ke.data.length-de),(j===void 0||we<=j)&&(le===void 0||le<Be)&&1.99<Be&&(j=we,be=Wt,le=Be)}return{successful:!!(h.delimiter=be),bestDelimiter:be}})(F,h.newline,h.skipEmptyLines,h.comments,h.delimitersToGuess)).successful?h.delimiter=O.bestDelimiter:(C=!0,h.delimiter=l.DefaultDelimiter),I.meta.delimiter=h.delimiter),$t(h));return h.preview&&h.header&&O.preview++,u=F,_=new he(O),I=_.parse(u,H,se),re(),Ce?{meta:{paused:!0}}:I||{meta:{paused:!1}}},this.paused=function(){return Ce},this.pause=function(){Ce=!0,_.abort(),u=y(h.chunk)?"":u.substring(_.getCharIndex())},this.resume=function(){k.streamer._halted?(Ce=!1,k.streamer.parseChunk(u,!0)):setTimeout(k.resume,3)},this.aborted=function(){return A},this.abort=function(){A=!0,_.abort(),I.meta.aborted=!0,y(h.complete)&&h.complete(I),u=""},this.guessLineEndings=function(J,O){J=J.substring(0,1048576);var O=new RegExp(V(O)+"([^]*?)"+V(O),"gm"),se=(J=J.replace(O,"")).split("\r"),O=J.split(`
`),J=1<O.length&&O[0].length<se[0].length;if(se.length===1||J)return`
`;for(var ue=0,Z=0;Z<se.length;Z++)se[Z][0]===`
`&&ue++;return ue>=se.length/2?`\r
`:"\r"}}function V(h){return h.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function he(h){var u=(h=h||{}).delimiter,_=h.newline,C=h.comments,E=h.step,w=h.preview,N=h.fastMode,B=null,z=!1,k=h.quoteChar==null?'"':h.quoteChar,X=k;if(h.escapeChar!==void 0&&(X=h.escapeChar),(typeof u!="string"||-1<l.BAD_DELIMITERS.indexOf(u))&&(u=","),C===u)throw new Error("Comment character same as delimiter");C===!0?C="#":(typeof C!="string"||-1<l.BAD_DELIMITERS.indexOf(C))&&(C=!1),_!==`
`&&_!=="\r"&&_!==`\r
`&&(_=`
`);var S=0,Ce=!1;this.parse=function(A,M,I){if(typeof A!="string")throw new Error("Input must be a string");var ae=A.length,re=u.length,ve=_.length,Ae=C.length,F=y(E),H=[],se=[],O=[],J=S=0;if(!A)return we();if(N||N!==!1&&A.indexOf(k)===-1){for(var ue=A.split(_),Z=0;Z<ue.length;Z++){if(O=ue[Z],S+=O.length,Z!==ue.length-1)S+=_.length;else if(I)return we();if(!C||O.substring(0,Ae)!==C){if(F){if(H=[],le(O.split(u)),Be(),Ce)return we()}else le(O.split(u));if(w&&w<=Z)return H=H.slice(0,w),we(!0)}}return we()}for(var q=A.indexOf(u,S),L=A.indexOf(_,S),be=new RegExp(V(X)+V(k),"g"),j=A.indexOf(k,S);;)if(A[S]===k)for(j=S,S++;;){if((j=A.indexOf(k,j+1))===-1)return I||se.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:H.length,index:S}),Fe();if(j===ae-1)return Fe(A.substring(S,j).replace(be,k));if(k===X&&A[j+1]===X)j++;else if(k===X||j===0||A[j-1]!==X){q!==-1&&q<j+1&&(q=A.indexOf(u,j+1));var ee=_t((L=L!==-1&&L<j+1?A.indexOf(_,j+1):L)===-1?q:Math.min(q,L));if(A.substr(j+1+ee,re)===u){O.push(A.substring(S,j).replace(be,k)),A[S=j+1+ee+re]!==k&&(j=A.indexOf(k,S)),q=A.indexOf(u,S),L=A.indexOf(_,S);break}if(ee=_t(L),A.substring(j+1+ee,j+1+ee+ve)===_){if(O.push(A.substring(S,j).replace(be,k)),Wt(j+1+ee+ve),q=A.indexOf(u,S),j=A.indexOf(k,S),F&&(Be(),Ce))return we();if(w&&H.length>=w)return we(!0);break}se.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:H.length,index:S}),j++}}else if(C&&O.length===0&&A.substring(S,S+Ae)===C){if(L===-1)return we();S=L+ve,L=A.indexOf(_,S),q=A.indexOf(u,S)}else if(q!==-1&&(q<L||L===-1))O.push(A.substring(S,q)),S=q+re,q=A.indexOf(u,S);else{if(L===-1)break;if(O.push(A.substring(S,L)),Wt(L+ve),F&&(Be(),Ce))return we();if(w&&H.length>=w)return we(!0)}return Fe();function le(de){H.push(de),J=S}function _t(de){var ke=0;return ke=de!==-1&&(de=A.substring(j+1,de))&&de.trim()===""?de.length:ke}function Fe(de){return I||(de===void 0&&(de=A.substring(S)),O.push(de),S=ae,le(O),F&&Be()),we()}function Wt(de){S=de,le(O),O=[],L=A.indexOf(_,S)}function we(de){if(h.header&&!M&&H.length&&!z){var ke=H[0],ze=Object.create(null),es=new Set(ke);let _i=!1;for(let mt=0;mt<ke.length;mt++){let $e=ke[mt];if(ze[$e=y(h.transformHeader)?h.transformHeader($e,mt):$e]){let Ut,mi=ze[$e];for(;Ut=$e+"_"+mi,mi++,es.has(Ut););es.add(Ut),ke[mt]=Ut,ze[$e]++,_i=!0,(B=B===null?{}:B)[Ut]=$e}else ze[$e]=1,ke[mt]=$e;es.add($e)}_i&&console.warn("Duplicate headers found and renamed."),z=!0}return{data:H,errors:se,meta:{delimiter:u,linebreak:_,aborted:Ce,truncated:!!de,cursor:J+(M||0),renamedHeaders:B}}}function Be(){E(we()),H=[],se=[]}},this.abort=function(){Ce=!0},this.getCharIndex=function(){return S}}function Ee(h){var u=h.data,_=a[u.workerId],C=!1;if(u.error)_.userError(u.error,u.file);else if(u.results&&u.results.data){var E={abort:function(){C=!0,oe(u.workerId,{data:[],errors:[],meta:{aborted:!0}})},pause:Ve,resume:Ve};if(y(_.userStep)){for(var w=0;w<u.results.data.length&&(_.userStep({data:u.results.data[w],errors:u.results.errors,meta:u.results.meta},E),!C);w++);delete u.results}else y(_.userChunk)&&(_.userChunk(u.results,E,u.file),delete u.results)}u.finished&&!C&&oe(u.workerId,u.results)}function oe(h,u){var _=a[h];y(_.userComplete)&&_.userComplete(u),_.terminate(),delete a[h]}function Ve(){throw new Error("Not implemented.")}function $t(h){if(typeof h!="object"||h===null)return h;var u,_=Array.isArray(h)?[]:{};for(u in h)_[u]=$t(h[u]);return _}function v(h,u){return function(){h.apply(u,arguments)}}function y(h){return typeof h=="function"}return l.parse=function(h,u){var _=(u=u||{}).dynamicTyping||!1;if(y(_)&&(u.dynamicTypingFunction=_,_={}),u.dynamicTyping=_,u.transform=!!y(u.transform)&&u.transform,!u.worker||!l.WORKERS_SUPPORTED)return _=null,l.NODE_STREAM_INPUT,typeof h=="string"?(h=(C=>C.charCodeAt(0)!==65279?C:C.slice(1))(h),_=new(u.download?p:g)(u)):h.readable===!0&&y(h.read)&&y(h.on)?_=new b(u):(s.File&&h instanceof File||h instanceof Object)&&(_=new d(u)),_.stream(h);(_=(()=>{var C;return!!l.WORKERS_SUPPORTED&&(C=(()=>{var E=s.URL||s.webkitURL||null,w=t.toString();return l.BLOB_URL||(l.BLOB_URL=E.createObjectURL(new Blob(["var global = (function() { if (typeof self !== 'undefined') { return self; } if (typeof window !== 'undefined') { return window; } if (typeof global !== 'undefined') { return global; } return {}; })(); global.IS_PAPA_WORKER=true; ","(",w,")();"],{type:"text/javascript"})))})(),(C=new s.Worker(C)).onmessage=Ee,C.id=c++,a[C.id]=C)})()).userStep=u.step,_.userChunk=u.chunk,_.userComplete=u.complete,_.userError=u.error,u.step=y(u.step),u.chunk=y(u.chunk),u.complete=y(u.complete),u.error=y(u.error),delete u.worker,_.postMessage({input:h,config:u,workerId:_.id})},l.unparse=function(h,u){var _=!1,C=!0,E=",",w=`\r
`,N='"',B=N+N,z=!1,k=null,X=!1,S=((()=>{if(typeof u=="object"){if(typeof u.delimiter!="string"||l.BAD_DELIMITERS.filter(function(M){return u.delimiter.indexOf(M)!==-1}).length||(E=u.delimiter),typeof u.quotes!="boolean"&&typeof u.quotes!="function"&&!Array.isArray(u.quotes)||(_=u.quotes),typeof u.skipEmptyLines!="boolean"&&typeof u.skipEmptyLines!="string"||(z=u.skipEmptyLines),typeof u.newline=="string"&&(w=u.newline),typeof u.quoteChar=="string"&&(N=u.quoteChar),typeof u.header=="boolean"&&(C=u.header),Array.isArray(u.columns)){if(u.columns.length===0)throw new Error("Option columns is empty");k=u.columns}u.escapeChar!==void 0&&(B=u.escapeChar+N),u.escapeFormulae instanceof RegExp?X=u.escapeFormulae:typeof u.escapeFormulae=="boolean"&&u.escapeFormulae&&(X=/^[=+\-@\t\r].*$/)}})(),new RegExp(V(N),"g"));if(typeof h=="string"&&(h=JSON.parse(h)),Array.isArray(h)){if(!h.length||Array.isArray(h[0]))return Ce(null,h,z);if(typeof h[0]=="object")return Ce(k||Object.keys(h[0]),h,z)}else if(typeof h=="object")return typeof h.data=="string"&&(h.data=JSON.parse(h.data)),Array.isArray(h.data)&&(h.fields||(h.fields=h.meta&&h.meta.fields||k),h.fields||(h.fields=Array.isArray(h.data[0])?h.fields:typeof h.data[0]=="object"?Object.keys(h.data[0]):[]),Array.isArray(h.data[0])||typeof h.data[0]=="object"||(h.data=[h.data])),Ce(h.fields||[],h.data||[],z);throw new Error("Unable to serialize unrecognized input");function Ce(M,I,ae){var re="",ve=(typeof M=="string"&&(M=JSON.parse(M)),typeof I=="string"&&(I=JSON.parse(I)),Array.isArray(M)&&0<M.length),Ae=!Array.isArray(I[0]);if(ve&&C){for(var F=0;F<M.length;F++)0<F&&(re+=E),re+=A(M[F],F);0<I.length&&(re+=w)}for(var H=0;H<I.length;H++){var se=(ve?M:I[H]).length,O=!1,J=ve?Object.keys(I[H]).length===0:I[H].length===0;if(ae&&!ve&&(O=ae==="greedy"?I[H].join("").trim()==="":I[H].length===1&&I[H][0].length===0),ae==="greedy"&&ve){for(var ue=[],Z=0;Z<se;Z++){var q=Ae?M[Z]:Z;ue.push(I[H][q])}O=ue.join("").trim()===""}if(!O){for(var L=0;L<se;L++){0<L&&!J&&(re+=E);var be=ve&&Ae?M[L]:L;re+=A(I[H][be],L)}H<I.length-1&&(!ae||0<se&&!J)&&(re+=w)}}return re}function A(M,I){var ae,re;return M==null?"":M.constructor===Date?JSON.stringify(M).slice(1,25):(re=!1,X&&typeof M=="string"&&X.test(M)&&(M="'"+M,re=!0),ae=M.toString().replace(S,B),(re=re||_===!0||typeof _=="function"&&_(M,I)||Array.isArray(_)&&_[I]||((ve,Ae)=>{for(var F=0;F<Ae.length;F++)if(-1<ve.indexOf(Ae[F]))return!0;return!1})(ae,l.BAD_DELIMITERS)||-1<ae.indexOf(E)||ae.charAt(0)===" "||ae.charAt(ae.length-1)===" ")?N+ae+N:ae)}},l.RECORD_SEP="",l.UNIT_SEP="",l.BYTE_ORDER_MARK="\uFEFF",l.BAD_DELIMITERS=["\r",`
`,'"',l.BYTE_ORDER_MARK],l.WORKERS_SUPPORTED=!r&&!!s.Worker,l.NODE_STREAM_INPUT=1,l.LocalChunkSize=10485760,l.RemoteChunkSize=5242880,l.DefaultDelimiter=",",l.Parser=he,l.ParserHandle=R,l.NetworkStreamer=p,l.FileStreamer=d,l.StringStreamer=g,l.ReadableStreamStreamer=b,s.jQuery&&((i=s.jQuery).fn.parse=function(h){var u=h.config||{},_=[];return this.each(function(w){if(!(i(this).prop("tagName").toUpperCase()==="INPUT"&&i(this).attr("type").toLowerCase()==="file"&&s.FileReader)||!this.files||this.files.length===0)return!0;for(var N=0;N<this.files.length;N++)_.push({file:this.files[N],inputElem:this,instanceConfig:i.extend({},u)})}),C(),this;function C(){if(_.length===0)y(h.complete)&&h.complete();else{var w,N,B,z,k=_[0];if(y(h.before)){var X=h.before(k.file,k.inputElem);if(typeof X=="object"){if(X.action==="abort")return w="AbortError",N=k.file,B=k.inputElem,z=X.reason,void(y(h.error)&&h.error({name:w},N,B,z));if(X.action==="skip")return void E();typeof X.config=="object"&&(k.instanceConfig=i.extend(k.instanceConfig,X.config))}else if(X==="skip")return void E()}var S=k.instanceConfig.complete;k.instanceConfig.complete=function(Ce){y(S)&&S(Ce,k.file,k.inputElem),E()},l.parse(k.file,k.instanceConfig)}}function E(){_.splice(0,1),C()}}),o&&(s.onmessage=function(h){h=h.data,l.WORKER_ID===void 0&&h&&(l.WORKER_ID=h.workerId),typeof h.input=="string"?s.postMessage({workerId:l.WORKER_ID,results:l.parse(h.input,h.config),finished:!0}):(s.File&&h.input instanceof File||h.input instanceof Object)&&(h=l.parse(h.input,h.config))&&s.postMessage({workerId:l.WORKER_ID,results:h,finished:!0})}),(p.prototype=Object.create(f.prototype)).constructor=p,(d.prototype=Object.create(f.prototype)).constructor=d,(g.prototype=Object.create(g.prototype)).constructor=g,(b.prototype=Object.create(f.prototype)).constructor=b,l})})(Cn)),Cn.exports}var ed=Zu();const td=Xu(ed),dr={parsePlayers(n){return new Promise(e=>{td.parse(n,{header:!1,skipEmptyLines:!0,complete:t=>{const s={};t.data.forEach((i,r)=>{if(i.length<5)return;const o=`p_${r}`;s[o]={id:o,name:i[0]?.trim(),nickname:i[1]?.trim(),highTier:i[2]?.trim(),currentTier:i[3]?.trim(),mainPos:i[4]?.trim(),subPos:i[5]?.trim(),most:[i[6],i[7],i[8]].filter(a=>a&&a.trim()!==""),status:"waiting"}}),e(s)}})})},exportResults(n,e){let t="";const s=["","","","","","","1","2","3",""];Object.values(n).forEach((a,c)=>{t+=`"${c+1} ${a.leaderName}", " : ${a.points}"
`,t+=s.join(",")+`
`,a.members&&a.members.length>0?a.members.forEach(l=>{const f=e[l];if(f){const p=f.most||[],d=[f.name,f.nickname,f.highTier,f.currentTier,f.mainPos,f.subPos,p[0]||"",p[1]||"",p[2]||"",f.soldPrice||0];t+=d.map(g=>`"${g}"`).join(",")+`
`}}):t+=`  
`,t+=`
`});const i=new Blob(["\uFEFF"+t],{type:"text/csv;charset=utf-8;"}),r=URL.createObjectURL(i),o=document.createElement("a");o.href=r,o.download="auction_result.csv",o.click()}},nd=`1.  
LOL Auction      .

-   :    (Google Analytics)
-   :    ( ,   )
  *     '()'    () ,        .
  *              .    (,  )  .

2.   
- Google Analytics:       
- Firebase:       

3. (Cookie) 
  Google Analytics         .        .

4. 3  
      3  .
- Google Analytics ( )
- Firebase (  )

5.  
         ,      .`,sd=`1 ()
  LOL Auction( "")               .

2 ( )
      ,         .

3 (Riot Games  )
LOL Auction isnt endorsed by Riot Games and doesnt reflect the views or opinions of Riot Games or anyone officially involved in producing or managing League of Legends. League of Legends and Riot Games are trademarks or registered trademarks of Riot Games, Inc. League of Legends  Riot Games, Inc.

4 ( )
1.        .
2.           .
3.         .
4.    ()     ,          .

5 ( )
1.   " (As Is)" ,       .
2.              .
3.  (Firebase, GitHub Pages )          .

6 (   )
  ,            .`,id=`
<h3> LOL Auction </h3>
<p><strong>1.    </strong></p>
<ul>
    <li> : (1) AUCTION SETUP        .</li>
    <li>:        .</li>
    <li> :       .</li>
</ul>

<p><strong>2.   </strong></p>
<ul>
    <li> : (1) CSV       .</li>
    <li>CSV : CSV     , , , , , , 1, 2, 3   .</li>
</ul>

<p><strong>3.  </strong></p>
<ul>
    <li>       .</li>
    <li>     .</li>
    <li>    ,       .</li>
    <li>    ,        .</li>
    <li>       .</li>
    <li>      .</li>
    <li>         . (  x 1) </li>
</ul>

<p><strong>4.   </strong></p>
<ul>
    <li>     2,   2  .</li>
    <li>  4 (  5   )   .</li>
    <li>           .</li>
</ul>

<hr style="border: 0; border-top: 1px solid #333; margin: 20px 0;">
<p><strong>   </strong></p>
<p>          .</p>
<p><a href="mailto:ewq15651@gmail.com" style="color: #c8aa6e;">ewq15651@gmail.com</a></p>
`,rd=`
<h3> </h3>
<ul class="update-list">
    <li>
        <span class="version">v1.3.1</span> <span class="date">2026.02.27</span>
        <p>-    /   </p>
        <p>-       UI </p>
    </li>
    <li>
        <span class="version">v1.3.0</span> <span class="date">2026.02.27</span>
        <p>-     (  )</p>
        <p>-        </p>
        <p>-    Footer </p>
        <p>-     </p>
    </li>
    <li>
        <span class="version">v1.2.0</span> <span class="date">2026.02.26</span>
        <p>-        </p>
        <p>-         </p>
        <p>-        </p>
    </li>
    <li>
        <span class="version">v1.1.0</span> <span class="date">2026.02.25</span>
        <p>-   </p>
        <p>-    </p>
        <p>- UI   (  )</p>
    </li>
    <li>
        <span class="version">v1.0.0</span> <span class="date">2026.02.24</span>
        <p>-   </p>
        <p>-    </p>
    </li>
    <li>
        <span class="version">v0.0.0</span> <span class="date">2025.10.16</span>
        <p>-  </p>
        <p>-    </p>
        <p>- CSV      </p>
    </li>
</ul>
`,jo=new URLSearchParams(window.location.search),Ie=jo.get("id"),xe=jo.get("role")||"viewer";let fe=null;pe.initServerTimeOffset();window.addEventListener("DOMContentLoaded",()=>{const n=document.getElementById("landing-screen"),e=document.getElementById("setup-screen"),t=document.getElementById("modal-step-1"),s=document.getElementById("modal-step-2"),i=document.querySelector(".auction-container"),r=document.getElementById("leader-input-list"),o=document.getElementById("generated-links-area");if(window.innerWidth<=768){const v=document.getElementById("mobile-warning");v&&(v.style.display="flex")}document.getElementById("btn-close-warning")?.addEventListener("click",()=>{const v=document.getElementById("mobile-warning");v&&(v.style.display="none")}),Ie?(n&&(n.style.display="none"),e&&(e.style.display="none"),i.style.display="grid"):(n&&(n.style.display="flex"),e&&(e.style.display="none"),i.style.display="none"),document.getElementById("site-logo")?.addEventListener("click",()=>{n&&(n.style.display="flex"),e&&(e.style.display="none"),i&&(i.style.display="none");const v=window.location.origin+window.location.pathname;window.history.pushState({path:v},"",v)});const a=document.getElementById("help-modal"),c=document.getElementById("help-content");document.getElementById("btn-open-help")?.addEventListener("click",()=>{a&&c&&(c.innerHTML=id,a.style.display="flex")}),document.getElementById("btn-close-help")?.addEventListener("click",()=>{a&&(a.style.display="none")});const l=document.getElementById("update-modal"),f=document.getElementById("update-content");document.getElementById("btn-open-update")?.addEventListener("click",()=>{l&&f&&(f.innerHTML=rd,l.style.display="flex")}),document.getElementById("btn-close-update")?.addEventListener("click",()=>{l&&(l.style.display="none")}),document.getElementById("btn-go-setup")?.addEventListener("click",()=>{n&&(n.style.display="none"),e&&(e.style.display="flex")});const p=()=>{r.querySelectorAll(".leader-row").forEach((y,h)=>{const u=h+1,_=y.querySelector(".leader-name-input");_.placeholder=u===1?" 1  ()":` ${u} `})};if(document.getElementById("btn-add-leader")?.addEventListener("click",()=>{const v=document.createElement("div");v.className="leader-row",v.innerHTML=`
            <input type="text" class="leader-name-input">
            <input type="number" class="leader-point-input" value="1000" placeholder="P">
            <button type="button" class="btn-remove-leader">-</button>
        `,v.querySelector(".btn-remove-leader")?.addEventListener("click",()=>{v.remove(),p()}),r.appendChild(v),p()}),document.getElementById("btn-generate-links")?.addEventListener("click",async()=>{const v=r.querySelectorAll(".leader-row"),y=[];if(v.forEach(w=>{const N=w.querySelector(".leader-name-input"),B=w.querySelector(".leader-point-input"),z=N.value.trim();z&&y.push({name:z,points:parseInt(B.value)||1e3})}),y.length<2)return alert(" 2  .");const h="ROOM_"+Math.random().toString(36).substring(2,7).toUpperCase(),u=window.location.origin+window.location.pathname,_={};let C="";const E=`${u}?id=${h}&role=viewer`;C+=`
            <div class="link-label">  </div>
            <div class="link-row">
                <input type="text" value="${E}" readonly>
                <button class="btn-copy" data-link="${E}"></button>
            </div>
            <hr style="border: 0; border-top: 1px solid #333; margin: 10px 0;">
        `,y.forEach((w,N)=>{const B=`team_${N+1}`;_[B]={id:B,leaderName:w.name,points:w.points,members:[],pauseCount:2};const z=`${u}?id=${h}&role=${B}`;C+=`
                <div class="link-label">${N===0?" () ":""}${w.name} (${w.points}P)</div>
                <div class="link-row">
                    <input type="text" value="${z}" readonly>
                    <button class="btn-copy" data-link="${z}"></button>
                </div>`}),await vn.createRoom(h,_,y[0].points),o.innerHTML=C,t.classList.add("dimmed"),s.style.display="block",s.querySelectorAll(".btn-copy").forEach(w=>{w.addEventListener("click",N=>{const B=N.target;navigator.clipboard.writeText(B.getAttribute("data-link")||""),B.innerText="!",setTimeout(()=>B.innerText="",1e3)})})}),document.getElementById("btn-close-result")?.addEventListener("click",()=>{s.style.display="none",t.classList.remove("dimmed")}),document.getElementById("btn-enter-as-admin")?.addEventListener("click",()=>{const v=s.querySelectorAll("input")[1]?.value;v&&window.open(v,"_blank")}),Ie){if(e.style.display="none",i.style.display="grid",xe!=="viewer"&&vn.connectToRoom(Ie,xe),xe==="viewer"){const v=document.getElementById("bidding-controls");v&&(v.style.display="none");const y=document.getElementById("admin-controls");y&&(y.style.display="none");const h=document.getElementById("control-panel-container");h&&(h.style.display="none");const u=document.getElementById("auction-logs");u&&(u.style.borderRight="none")}Bu($(W,`rooms/${Ie}/logs`),v=>{vt.renderLog(v.val())}),pi($(W,`rooms/${Ie}`),v=>{const y=v.val();if(!y)return;fe=y,vt.renderPlayerList(y.players||{},y.live.playerOrder||[]),vt.renderStage(y.live,y.players||{},y.teams||{}),vt.renderTeams(y.teams||{},xe),vt.renderStats(y.players||{});const h=document.getElementById("admin-controls"),u=document.getElementById("btn-upload-csv"),_=document.getElementById("btn-start-auction"),C=document.getElementById("btn-download-result"),E=document.getElementById("btn-resume-auction"),w=document.getElementById("btn-pause");xe==="team_1"&&h&&(h.style.display="block",Object.values(y.teams).every(B=>(B.members?.length||0)>=4)?(h.style.display="block",u&&(u.style.display="none"),_&&(_.style.display="none"),C&&(C.style.display="inline-block")):y.live.status!=="idle"?h.style.display="none":(h.style.display="block",u&&(u.style.display="inline-block"),_&&(_.style.display="inline-block"),C&&(C.style.display="none"))),y.live.status==="paused"?(w&&(w.style.display="none"),E&&(xe===y.live.pausedBy?E.style.display="inline-block":E.style.display="none")):(w&&(w.style.display="inline-block"),E&&(E.style.display="none"))}),setInterval(()=>{if(!fe)return;const v=fe.live,y=document.getElementById("timer");if(!y)return;const h=pe.getServerTime();if(v.status==="idle")Object.values(fe.teams).every(_=>(_.members?.length||0)>=4)?(y.innerText="END",y.style.color="#c8aa6e"):(y.innerText="Ready",y.style.color="#fff");else if(v.status==="paused"){const u=Math.ceil((v.pauseLimitTime-h)/1e3);y.innerText=u>0?`PAUSE ${u}s`:"PAUSE 0s",y.style.color="#ffff00"}else if(v.status==="resuming"){const u=Math.ceil((v.nextAuctionTime-h)/1e3);y.innerText=u>0?`RESUME ${u}s`:"GO!",y.style.color="#3fb950"}else{const u=v.status==="bidding"?v.endTime:v.nextAuctionTime,_=Math.ceil((u-h)/1e3);_<=0?(y.innerText="0",y.style.color="#ff4655"):(y.innerText=_.toString(),y.style.color=v.status==="bidding"&&_<=5?"#ff4655":"#fff")}},100),xe==="team_1"&&setInterval(()=>{if(!fe)return;const v=fe.live,y=pe.getServerTime();v.status==="cooldown"&&y>v.nextAuctionTime&&Ye.nextPlayer(Ie),v.status==="bidding"&&y>v.endTime&&Ye.finalize(Ie),v.status==="paused"&&y>v.pauseLimitTime&&Ye.resumeAuction(Ie),v.status==="resuming"&&y>v.nextAuctionTime&&Ye.startBidding(Ie)},1e3)}document.getElementById("btn-start-auction")?.addEventListener("click",()=>{xe==="team_1"&&vn.startAuctionProcess(Ie)}),document.querySelectorAll(".btn-bid").forEach(v=>{v.addEventListener("click",y=>{const h=parseInt(y.target.dataset.amount||"0");Ye.placeBid(Ie,xe,h)})});const d=document.getElementById("custom-bid-input"),g=document.getElementById("btn-custom-bid"),b=()=>{const v=parseInt(d.value);if(isNaN(v)||v<0)return alert("  .");Ye.placeTargetBid(Ie,xe,v),d.value=""};g?.addEventListener("click",b),d?.addEventListener("keypress",v=>{v.key==="Enter"&&b()}),document.getElementById("btn-pause")?.addEventListener("click",()=>{Ye.pauseAuction(Ie,xe)}),document.getElementById("btn-resume-auction")?.addEventListener("click",()=>{Ye.resumeAuction(Ie,xe)}),document.getElementById("btn-download-result")?.addEventListener("click",()=>{fe&&dr.exportResults(fe.teams,fe.players)}),document.getElementById("btn-upload-csv")?.addEventListener("click",()=>{document.getElementById("csv-upload")?.click()}),document.getElementById("csv-upload")?.addEventListener("change",async v=>{const y=v.target.files?.[0];if(y)try{const h=await dr.parsePlayers(y);await vn.registerPlayers(Ie,h),alert(` ${Object.keys(h).length}  !`)}catch{alert("CSV  ")}}),document.getElementById("btn-close-team-modal")?.addEventListener("click",()=>{document.getElementById("team-detail-modal").style.display="none"}),document.getElementById("btn-close-player-modal")?.addEventListener("click",()=>{document.getElementById("player-info-modal").style.display="none"});const R=document.getElementById("terms-modal"),V=document.getElementById("terms-title"),he=document.getElementById("terms-content");document.getElementById("link-privacy")?.addEventListener("click",v=>{v.preventDefault(),R&&V&&he&&(V.innerText="",he.innerText=nd,R.style.display="flex")}),document.getElementById("link-terms")?.addEventListener("click",v=>{v.preventDefault(),R&&V&&he&&(V.innerText="",he.innerText=sd,R.style.display="flex")}),document.getElementById("btn-close-terms")?.addEventListener("click",()=>{R&&(R.style.display="none")}),document.getElementById("team-list")?.addEventListener("click",v=>{const y=v.target.closest(".team-card");if(!y||!fe)return;const h=y.getAttribute("data-id");if(!h)return;const u=fe.teams[h],_=fe.players,C=u.members||[],E=document.getElementById("team-detail-modal"),w=document.getElementById("team-modal-title"),N=document.getElementById("team-modal-members");E&&w&&N&&(w.innerText=`${u.leaderName}  `,N.innerHTML=C.length>0?C.map(B=>{const z=_[B];return`<div class="player-card sold">
                        <div style="display:flex; justify-content:space-between; align-items:center;">
                            <strong>${z.name}</strong> 
                            <small style="background:#333; padding:2px 6px; border-radius:4px;">${z.currentTier}</small>
                        </div>
                        <div style="font-size:12px; color:#aaa; margin-top:6px; line-height:1.4;">
                            <div>: ${z.mainPos} ${z.subPos?`/ ${z.subPos}`:""}</div>
                            <div>Most: ${z.most?z.most.join(", "):"-"}</div>
                        </div>
                    </div>`}).join(""):'<p style="text-align:center; color:#888;">   .</p>',E.style.display="flex")});const Ee=document.getElementById("player-list"),oe=document.getElementById("player-hover-tooltip"),Ve=(v,y)=>{const h=v.closest(".player-card");if(!h||!fe||!oe)return;const u=h.getAttribute("data-id");if(!u)return;const _=fe.players[u];oe.innerHTML=vt.getTooltipHtml(_);const C=250,E=oe.offsetHeight||150;let w=y.clientX+15,N=y.clientY+15;w+C>window.innerWidth&&(w=y.clientX-C-15),N+E>window.innerHeight&&(N=y.clientY-E-15),oe.style.left=`${w}px`,oe.style.top=`${N}px`,oe.style.display="block"},$t=()=>{oe&&(oe.style.display="none")};Ee?.addEventListener("mouseover",v=>{Ve(v.target,v)}),Ee?.addEventListener("mousemove",v=>{Ve(v.target,v)}),Ee?.addEventListener("mouseout",()=>{$t()}),Ee?.addEventListener("click",v=>{const y=v.target.closest(".player-card");if(!y||!fe)return;const h=y.getAttribute("data-id");if(!h)return;const u=fe.players[h],_=fe.live.status!=="idle",C=document.getElementById("player-info-modal"),E=document.getElementById("player-modal-name"),w=document.getElementById("player-modal-detail");if(C&&E&&w){E.innerText=`${u.name} (${u.nickname})`;let N="",B="#fff";if(u.status==="sold"){const k=fe.teams;let X="  ";for(const S in k)if(k[S].members&&k[S].members.includes(h)){X=k[S].leaderName;break}N=` - ${X} `,B="#c8aa6e"}else u.status==="passed"?(N="",B="#ff4655"):u.status==="bidding"?(N="    ",B="#00bcff"):(N="  ",B="#888");let z=`
                <div style="margin-bottom:15px; text-align:center; font-size:16px; font-weight:bold; color:${B}; border:1px solid ${B}; padding:8px; border-radius:4px;">
                    ${N}
                </div>
                <div style="margin-bottom:10px;"><strong> :</strong> ${u.highTier}</div>
                <div style="margin-bottom:10px;"><strong> :</strong> ${u.currentTier}</div>
                <div style="margin-bottom:10px;"><strong> :</strong> ${u.mainPos}</div>
            `;_?z+=`
                    <div style="margin-bottom:10px;"><strong> :</strong> ${u.subPos}</div>
                    <div><strong>Most:</strong> ${u.most.join(", ")}</div>
                `:z+='<div style="color:#888; margin-top:20px; text-align:center;">     .</div>',w.innerHTML=z,C.style.display="flex"}})});
